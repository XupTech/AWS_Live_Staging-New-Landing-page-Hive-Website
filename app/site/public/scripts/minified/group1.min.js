!function(){"use strict";var mod=angular.module("slugifier",[]),charmap={" ":" ","¡":"!","¢":"c","£":"lb","¥":"yen","¦":"|","§":"SS","¨":'"',"©":"(c)","ª":"a","«":"<<","¬":"not","­":"-","®":"(R)","°":"^0","±":"+/-","²":"^2","³":"^3","´":"'","µ":"u","¶":"P","·":".","¸":",","¹":"^1","º":"o","»":">>","¼":" 1/4 ","½":" 1/2 ","¾":" 3/4 ","¿":"?","À":"`A","Á":"'A","Â":"^A","Ã":"~A","Ä":'"A',"Å":"A","Æ":"AE","Ç":"C","È":"`E","É":"'E","Ê":"^E","Ë":'"E',"Ì":"`I","Í":"'I","Î":"^I","Ï":'"I',"Ð":"D","Ñ":"~N","Ò":"`O","Ó":"'O","Ô":"^O","Õ":"~O","Ö":'"O',"×":"x","Ø":"O","Ù":"`U","Ú":"'U","Û":"^U","Ü":'"U',"Ý":"'Y","Þ":"Th","ß":"ss","à":"`a","á":"'a","â":"^a","ã":"~a","ä":'"a',"å":"a","æ":"ae","ç":"c","è":"`e","é":"'e","ê":"^e","ë":'"e',"ì":"`i","í":"'i","î":"^i","ï":'"i',"ð":"d","ñ":"~n","ò":"`o","ó":"'o","ô":"^o","õ":"~o","ö":'"o',"÷":":","ø":"o","ù":"`u","ú":"'u","û":"^u","ü":'"u',"ý":"'y","þ":"th","ÿ":'"y',"Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"'C","ć":"'c","Ĉ":"^C","ĉ":"^c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"^G","ĝ":"^g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"^H","ĥ":"^h","Ħ":"H","ħ":"h","Ĩ":"~I","ĩ":"~i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"^J","ĵ":"^j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"'N","ń":"'n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"'n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":'"O',"ő":'"o',"Œ":"OE","œ":"oe","Ŕ":"'R","ŕ":"'r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"'S","ś":"'s","Ŝ":"^S","ŝ":"^s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"~U","ũ":"~u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":'"U',"ű":'"u',"Ų":"U","ų":"u","Ŵ":"^W","ŵ":"^w","Ŷ":"^Y","ŷ":"^y","Ÿ":'"Y',"Ź":"'Z","ź":"'z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s"};mod.factory("Slug",function(){return{slugify:function(s){if(!s)return"";for(var ch,cp,ascii=[],i=0;i<s.length;i++)(cp=s.charCodeAt(i))<384&&(ch=String.fromCharCode(cp),ascii.push(charmap[ch]||ch));return s=ascii.join(""),(s=s.replace(/[^\w\s-]/g,"").trim().toLowerCase()).replace(/[-\s]+/g,"-")}}}),mod.directive("slug",["Slug",function(Slug){return{restrict:"E",scope:{to:"="},transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(scope,elem,attrs){if(!attrs.from)throw"must set attribute 'from'";scope.$parent.$watch(attrs.from,function(val){scope.to=Slug.slugify(val)})}}}]),mod.filter("slugify",["Slug",function(Slug){return function(input){return Slug.slugify(input)}}])}(),function(window,angular){"use strict";function $$CookieWriter($document,$log,$browser){var cookiePath=$browser.baseHref(),rawDocument=$document[0];return function(name,value,options){rawDocument.cookie=function(name,value,options){var path,expires;expires=(options=options||{}).expires,path=angular.isDefined(options.path)?options.path:cookiePath,angular.isUndefined(value)&&(expires="Thu, 01 Jan 1970 00:00:00 GMT",value=""),angular.isString(expires)&&(expires=new Date(expires));var str=encodeURIComponent(name)+"="+encodeURIComponent(value);str+=path?";path="+path:"",str+=options.domain?";domain="+options.domain:"",str+=expires?";expires="+expires.toUTCString():"";var cookieLength=(str+=options.secure?";secure":"").length+1;return cookieLength>4096&&$log.warn("Cookie '"+name+"' possibly not set or overflowed because it was too large ("+cookieLength+" > 4096 bytes)!"),str}(name,value,options)}}angular.module("ngCookies",["ng"]).provider("$cookies",[function(){function calcOptions(options){return options?angular.extend({},defaults,options):defaults}var defaults=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function($$cookieReader,$$cookieWriter){return{get:function(key){return $$cookieReader()[key]},getObject:function(key){var value=this.get(key);return value?angular.fromJson(value):value},getAll:function(){return $$cookieReader()},put:function(key,value,options){$$cookieWriter(key,value,calcOptions(options))},putObject:function(key,value,options){this.put(key,angular.toJson(value),options)},remove:function(key,options){$$cookieWriter(key,void 0,calcOptions(options))}}}]}]),angular.module("ngCookies").factory("$cookieStore",["$cookies",function($cookies){return{get:function(key){return $cookies.getObject(key)},put:function(key,value){$cookies.putObject(key,value)},remove:function(key){$cookies.remove(key)}}}]),$$CookieWriter.$inject=["$document","$log","$browser"],angular.module("ngCookies").provider("$$cookieWriter",function(){this.$get=$$CookieWriter})}(window,window.angular),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("angular")):"function"==typeof define&&define.amd?define(["exports","angular"],factory):factory(global["@uirouter/angularjs"]={},global.angular)}(this,function(exports,ng_from_import){"use strict";function curry(fn){function curried(args){return args.length>=func_args_length?fn.apply(null,args):function(){return curried(args.concat([].slice.apply(arguments)))}}var initial_args=[].slice.apply(arguments,[1]),func_args_length=fn.length;return curried(initial_args)}function compose(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}}function pipe(){for(var funcs=[],_i=0;_i<arguments.length;_i++)funcs[_i]=arguments[_i];return compose.apply(null,[].slice.call(arguments).reverse())}function and(fn1,fn2){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fn1.apply(null,args)&&fn2.apply(null,args)}}function or(fn1,fn2){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fn1.apply(null,args)||fn2.apply(null,args)}}function invoke(fnName,args){return function(obj){return obj[fnName].apply(obj,args)}}function pattern(struct){return function(x){for(var i=0;i<struct.length;i++)if(struct[i][0](x))return struct[i][1](x)}}function isInjectable(val$$1){if(isArray(val$$1)&&val$$1.length){var head=val$$1.slice(0,-1),tail=val$$1.slice(-1);return!(head.filter(not(isString)).length||tail.filter(not(isFunction)).length)}return isFunction(val$$1)}function identity(x){return x}function noop(){}function createProxyFunctions(source,target,bind,fnNames,latebind){void 0===latebind&&(latebind=!1);var bindFunction=function(fnName){return source()[fnName].bind(bind())};return(fnNames=fnNames||Object.keys(source())).reduce(function(acc,name){return acc[name]=latebind?function(fnName){return function(){return target[fnName]=bindFunction(fnName),target[fnName].apply(null,arguments)}}(name):bindFunction(name),acc},target)}function _inArray(array,obj){return-1!==array.indexOf(obj)}function _removeFrom(array,obj){var idx=array.indexOf(obj);return idx>=0&&array.splice(idx,1),array}function _pushTo(arr,val$$1){return arr.push(val$$1),val$$1}function defaults(opts){for(var defaultsList=[],_i=1;_i<arguments.length;_i++)defaultsList[_i-1]=arguments[_i];var defaultVals=extend.apply(void 0,[{}].concat(defaultsList.reverse()));return extend(defaultVals,pick(opts||{},Object.keys(defaultVals)))}function ancestors(first,second){var path=[];for(var n in first.path){if(first.path[n]!==second.path[n])break;path.push(first.path[n])}return path}function pick(obj,propNames){var objCopy={};for(var _prop in obj)-1!==propNames.indexOf(_prop)&&(objCopy[_prop]=obj[_prop]);return objCopy}function omit(obj,propNames){return Object.keys(obj).filter(not(inArray(propNames))).reduce(function(acc,key){return acc[key]=obj[key],acc},{})}function pluck(collection,propName){return map(collection,prop(propName))}function filter(collection,callback){var arr=isArray(collection),result=arr?[]:{},accept=arr?function(x){return result.push(x)}:function(x,key){return result[key]=x};return forEach(collection,function(item,i){callback(item,i)&&accept(item,i)}),result}function find(collection,callback){var result;return forEach(collection,function(item,i){result||callback(item,i)&&(result=item)}),result}function map(collection,callback,target){return target=target||(isArray(collection)?[]:{}),forEach(collection,function(item,i){return target[i]=callback(item,i)}),target}function pushR(arr,obj){return arr.push(obj),arr}function assertFn(predicateOrMap,errMsg){return void 0===errMsg&&(errMsg="assert failure"),function(obj){var result=predicateOrMap(obj);if(!result)throw new Error(isFunction(errMsg)?errMsg(obj):errMsg);return result}}function arrayTuples(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];if(0===args.length)return[];for(var maxArrayLen=args.reduce(function(min,arr){return Math.min(arr.length,min)},9007199254740991),result=[],i=0;i<maxArrayLen;i++)!function(i){switch(args.length){case 1:result.push([args[0][i]]);break;case 2:result.push([args[0][i],args[1][i]]);break;case 3:result.push([args[0][i],args[1][i],args[2][i]]);break;case 4:result.push([args[0][i],args[1][i],args[2][i],args[3][i]]);break;default:result.push(args.map(function(array){return array[i]}))}}(i);return result}function applyPairs(memo,keyValTuple){var key,value;if(isArray(keyValTuple)&&(key=keyValTuple[0],value=keyValTuple[1]),!isString(key))throw new Error("invalid parameters to applyPairs");return memo[key]=value,memo}function tail(arr){return arr.length&&arr[arr.length-1]||void 0}function copy(src,dest){return dest&&Object.keys(dest).forEach(function(key){return delete dest[key]}),dest||(dest={}),extend(dest,src)}function _extend(toObj){for(var i=1;i<arguments.length;i++){var obj=arguments[i];if(obj)for(var keys=Object.keys(obj),j=0;j<keys.length;j++)toObj[keys[j]]=obj[keys[j]]}return toObj}function _equals(o1,o2){if(o1===o2)return!0;if(null===o1||null===o2)return!1;if(o1!=o1&&o2!=o2)return!0;var t1=typeof o1;if(t1!==typeof o2||"object"!==t1)return!1;var tup=[o1,o2];if(all(isArray)(tup))return function(a1,a2){return a1.length===a2.length&&arrayTuples(a1,a2).reduce(function(b,t){return b&&_equals(t[0],t[1])},!0)}(o1,o2);if(all(isDate)(tup))return o1.getTime()===o2.getTime();if(all(isRegExp)(tup))return o1.toString()===o2.toString();if(all(isFunction)(tup))return!0;if([isFunction,isArray,isDate,isRegExp].map(any).reduce(function(b,fn){return b||!!fn(tup)},!1))return!1;var keys={};for(var key in o1){if(!_equals(o1[key],o2[key]))return!1;keys[key]=!0}for(var key in o2)if(!keys[key])return!1;return!0}function maxLength(max,str){return str.length<=max?str:str.substr(0,max-3)+"..."}function padString(length,str){for(;str.length<length;)str+=" ";return str}function kebobString(camelCase){return camelCase.replace(/^([A-Z])/,function($1){return $1.toLowerCase()}).replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function functionToString(fn){var fnStr=fnToString(fn),namedFunctionMatch=fnStr.match(/^(function [^ ]+\([^)]*\))/),toStr=namedFunctionMatch?namedFunctionMatch[1]:fnStr,fnName=fn.name||"";return fnName&&toStr.match(/function \(/)?"function "+fnName+toStr.substr(9):toStr}function fnToString(fn){var _fn=isArray(fn)?fn.slice(-1)[0]:fn;return _fn&&_fn.toString()||"undefined"}function stringify(o){function format(value){if(isObject(value)){if(-1!==seen.indexOf(value))return"[circular ref]";seen.push(value)}return stringifyPattern(value)}var seen=[];return isUndefined(o)?format(o):JSON.stringify(o,function(key,value){return format(value)}).replace(/\\"/g,'"')}function splitOnDelim(delim){var re=new RegExp("("+delim+")","g");return function(str){return str.split(re).filter(identity)}}function joinNeighborsR(acc,x){return isString(tail(acc))&&isString(x)?acc.slice(0,-1).concat(tail(acc)+x):pushR(acc,x)}function uiViewString(uiview){if(!uiview)return"ui-view (defunct)";var state=uiview.creationContext?uiview.creationContext.name||"(root)":"(none)";return"[ui-view#"+uiview.id+" "+uiview.$type+":"+uiview.fqn+" ("+uiview.name+"@"+state+")]"}function normalizedCat(input){return isNumber(input)?exports.Category[input]:exports.Category[exports.Category[input]]}function resolvablesBuilder(state){var getToken=function(p){return p.provide||p.token},literal2Resolvable=pattern([[prop("resolveFn"),function(p){return new Resolvable(getToken(p),p.resolveFn,p.deps,p.policy)}],[prop("useFactory"),function(p){return new Resolvable(getToken(p),p.useFactory,p.deps||p.dependencies,p.policy)}],[prop("useClass"),function(p){return new Resolvable(getToken(p),function(){return new p.useClass},[],p.policy)}],[prop("useValue"),function(p){return new Resolvable(getToken(p),function(){return p.useValue},[],p.policy,p.useValue)}],[prop("useExisting"),function(p){return new Resolvable(getToken(p),identity,[p.useExisting],p.policy)}]]),tuple2Resolvable=pattern([[pipe(prop("val"),isString),function(tuple){return new Resolvable(tuple.token,identity,[tuple.val],tuple.policy)}],[pipe(prop("val"),isArray),function(tuple){return new Resolvable(tuple.token,tail(tuple.val),tuple.val.slice(0,-1),tuple.policy)}],[pipe(prop("val"),isFunction),function(tuple){return new Resolvable(tuple.token,tuple.val,function(fn){var $injector=services.$injector;return fn.$inject||$injector&&$injector.annotate(fn,$injector.strictDi)||"deferred"}(tuple.val),tuple.policy)}]]),item2Resolvable=pattern([[is(Resolvable),function(r){return r}],[function(obj){return!(!obj.token||!obj.resolveFn)},literal2Resolvable],[function(obj){return!(!obj.provide&&!obj.token||!(obj.useValue||obj.useFactory||obj.useExisting||obj.useClass))},literal2Resolvable],[function(obj){return!!(obj&&obj.val&&(isString(obj.val)||isArray(obj.val)||isFunction(obj.val)))},tuple2Resolvable],[val(!0),function(obj){throw new Error("Invalid resolve value: "+stringify(obj))}]]),decl=state.resolve;return(isArray(decl)?decl:function(resolveObj,resolvePolicies){return Object.keys(resolveObj||{}).map(function(token){return{token:token,val:resolveObj[token],deps:void 0,policy:resolvePolicies[token]}})}(decl,state.resolvePolicy||{})).map(item2Resolvable)}function matchState(state,criterion){var toMatch=isString(criterion)?[criterion]:criterion;return!!(isFunction(toMatch)?toMatch:function(_state){for(var globStrings=toMatch,i=0;i<globStrings.length;i++){var glob=new Glob(globStrings[i]);if(glob&&glob.matches(_state.name)||!glob&&globStrings[i]===_state.name)return!0}return!1})(state)}function makeEvent(registry,transitionService,eventType){function hookRegistrationFn(matchObject,callback,options){void 0===options&&(options={});var registeredHook=new RegisteredHook(transitionService,eventType,callback,matchObject,removeHookFn,options);return hooks.push(registeredHook),registeredHook.deregister.bind(registeredHook)}var hooks=(registry._registeredHooks=registry._registeredHooks||{})[eventType.name]=[],removeHookFn=removeFrom(hooks);return registry[eventType.name]=hookRegistrationFn,hookRegistrationFn}function quoteRegExp(str,param){var surroundPattern=["",""],result=str.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!param)return result;switch(param.squash){case!1:surroundPattern=["(",")"+(param.isOptional?"?":"")];break;case!0:result=result.replace(/\/$/,""),surroundPattern=["(?:/(",")|/)?"];break;default:surroundPattern=["("+param.squash+"|",")?"]}return result+surroundPattern[0]+param.type.pattern.source+surroundPattern[1]}function getHandlerFn(handler){if(!(isFunction(handler)||isString(handler)||is(TargetState)(handler)||TargetState.isDef(handler)))throw new Error("'handler' must be a string, function, TargetState, or have a state: 'newtarget' property");return isFunction(handler)?handler:val(handler)}function makeEnterExitRetainHook(hookName){return function(transition,state){return(0,state.$$state()[hookName])(transition,state)}}function lazyLoadState(transition,state){var lazyLoadFn=state.$$state().lazyLoad,promise=lazyLoadFn._promise;if(!promise){promise=lazyLoadFn._promise=services.$q.when(lazyLoadFn(transition,state)).then(function(result){return result&&Array.isArray(result.states)&&result.states.forEach(function(_state){return transition.router.stateRegistry.register(_state)}),result}).then(function(result){return delete state.lazyLoad,delete state.$$state().lazyLoad,delete lazyLoadFn._promise,result},function(err){return delete lazyLoadFn._promise,services.$q.reject(err)})}return promise}function parseUrl$1(url){var orEmptyString=function(x){return x||""},_a=splitHash(url).map(orEmptyString),beforehash=_a[0],hash=_a[1],_b=splitQuery(beforehash).map(orEmptyString);return{path:_b[0],search:_b[1],hash:hash,url:url}}function locationPluginFactory(name,isHtml5,serviceClass,configurationClass){return function(uiRouter){var service=uiRouter.locationService=new serviceClass(uiRouter),configuration=uiRouter.locationConfig=new configurationClass(uiRouter,isHtml5);return{name:name,service:service,configuration:configuration,dispose:function(router){router.dispose(service),router.dispose(configuration)}}}}function servicesPlugin(router){return services.$injector=$injector,services.$q=$q,{name:"vanilla.services",$q:$q,$injector:$injector,dispose:function(){return null}}}function getNg1ViewConfigFactory(){var templateFactory=null;return function(path,view){return templateFactory=templateFactory||services.$injector.get("$templateFactory"),[new Ng1ViewConfig(path,view,templateFactory)]}}function ng1ViewsBuilder(state){if(!state.parent)return{};var compKeys=["component","bindings","componentProvider"],nonCompKeys=["templateProvider","templateUrl","template","notify","async"].concat(["controller","controllerProvider","controllerAs","resolveAs"]),allViewKeys=compKeys.concat(nonCompKeys);if(isDefined(state.views)&&hasAnyKey(allViewKeys,state))throw new Error("State '"+state.name+"' has a 'views' object. It cannot also have \"view properties\" at the state level.  Move the following properties into a view (in the 'views' object):  "+allViewKeys.filter(function(key){return isDefined(state[key])}).join(", "));var views={},viewsObject=state.views||{$default:pick(state,allViewKeys)};return forEach(viewsObject,function(config,name){if(name=name||"$default",isString(config)&&(config={component:config}),config=extend({},config),hasAnyKey(compKeys,config)&&hasAnyKey(nonCompKeys,config))throw new Error("Cannot combine: "+compKeys.join("|")+" with: "+nonCompKeys.join("|")+" in stateview: '"+name+"@"+state.name+"'");config.resolveAs=config.resolveAs||"$resolve",config.$type="ng1",config.$context=state,config.$name=name;var normalized=ViewService.normalizeUIViewTarget(config.$context,config.$name);config.$uiViewName=normalized.uiViewName,config.$uiViewContextAnchor=normalized.uiViewContextAnchor,views[name]=config}),views}function $uiRouterProvider($locationProvider){function $get($location,$browser,$window,$sniffer,$rootScope,$http,$templateCache){return ng1LocationService._runtimeServices($rootScope,$location,$sniffer,$browser,$window),delete router.router,delete router.$get,router}(router=this.router=new UIRouter).stateProvider=new StateProvider(router.stateRegistry,router.stateService),router.stateRegistry.decorator("views",ng1ViewsBuilder),router.stateRegistry.decorator("onExit",getStateHookBuilder("onExit")),router.stateRegistry.decorator("onRetain",getStateHookBuilder("onRetain")),router.stateRegistry.decorator("onEnter",getStateHookBuilder("onEnter")),router.viewService._pluginapi._viewConfigFactory("ng1",getNg1ViewConfigFactory());var ng1LocationService=router.locationService=router.locationConfig=new Ng1LocationServices($locationProvider);return Ng1LocationServices.monkeyPatchPathParameterType(router),router.router=router,router.$get=$get,$get.$inject=["$location","$browser","$window","$sniffer","$rootScope","$http","$templateCache"],router}function runBlock($injector$$1,$q$$1,$uiRouter){if(services.$injector=$injector$$1,services.$q=$q$$1,!$injector$$1.hasOwnProperty("strictDi"))try{$injector$$1.invoke(function(checkStrictDi){})}catch(error){$injector$$1.strictDi=!!/strict mode/.exec(error&&error.toString())}$uiRouter.stateRegistry.get().map(function(x){return x.$$state().resolvables}).reduce(unnestR,[]).filter(function(x){return"deferred"===x.deps}).forEach(function(resolvable){return resolvable.deps=$injector$$1.annotate(resolvable.resolveFn,$injector$$1.strictDi)})}function watchDigests($rootScope){$rootScope.$watch(function(){trace.approximateDigests++})}function parseStateRef(ref){var parsed,paramsOnly=ref.match(/^\s*({[^}]*})\s*$/);if(paramsOnly&&(ref="("+paramsOnly[1]+")"),!(parsed=ref.replace(/\n/g," ").match(/^\s*([^(]*?)\s*(\((.*)\))?\s*$/))||4!==parsed.length)throw new Error("Invalid state ref '"+ref+"'");return{state:parsed[1]||null,paramExpr:parsed[3]||null}}function stateContext(el){var $uiView=el.parent().inheritedData("$uiView"),path=parse("$cfg.path")($uiView);return path?tail(path).state.name:void 0}function processedDef($state,$element,def){var uiState=def.uiState||$state.current.name,uiStateOpts=extend(function(el,$state){return{relative:stateContext(el)||$state.$current,inherit:!0,source:"sref"}}($element,$state),def.uiStateOpts||{}),href=$state.href(uiState,def.uiStateParams,uiStateOpts);return{uiState:uiState,uiStateParams:def.uiStateParams,uiStateOpts:uiStateOpts,href:href}}function getTypeInfo(el){var isSvg="[object SVGAnimatedString]"===Object.prototype.toString.call(el.prop("href")),isForm="FORM"===el[0].nodeName;return{attr:isForm?"action":isSvg?"xlink:href":"href",isAnchor:"A"===el.prop("tagName").toUpperCase(),clickable:!isForm}}function clickHook(el,$state,$timeout,type,getDef){return function(e){var button=e.which||e.button,target=getDef();if(!(button>1||e.ctrlKey||e.metaKey||e.shiftKey||el.attr("target"))){var transition_1=$timeout(function(){el.attr("disabled")||$state.go(target.uiState,target.uiStateParams,target.uiStateOpts)});e.preventDefault();var ignorePreventDefaultCount_1=type.isAnchor&&!target.href?1:0;e.preventDefault=function(){ignorePreventDefaultCount_1--<=0&&$timeout.cancel(transition_1)}}}}function bindEvents(element,scope,hookFn,uiStateOpts){var events;uiStateOpts&&(events=uiStateOpts.events),isArray(events)||(events=["click"]);for(var on=element.on?"on":"bind",_i=0,events_1=events;_i<events_1.length;_i++){var event_1=events_1[_i];element[on](event_1,hookFn)}scope.$on("$destroy",function(){for(var off=element.off?"off":"unbind",_i=0,events_2=events;_i<events_2.length;_i++){var event_2=events_2[_i];element[off](event_2,hookFn)}})}function $IsStateFilter($state){var isFilter=function(state,params,options){return $state.is(state,params,options)};return isFilter.$stateful=!0,isFilter}function $IncludedByStateFilter($state){var includesFilter=function(state,params,options){return $state.includes(state,params,options)};return includesFilter.$stateful=!0,includesFilter}function $ViewDirectiveFill($compile,$controller,$transitions,$view,$q$$1,$timeout){var getControllerAs=parse("viewDecl.controllerAs"),getResolveAs=parse("viewDecl.resolveAs");return{restrict:"ECA",priority:-400,compile:function(tElement){var initial=tElement.html();return tElement.empty(),function(scope,$element){var data=$element.data("$uiView");if(!data)return $element.html(initial),void $compile($element.contents())(scope);var cfg=data.$cfg||{viewDecl:{},getTemplate:noop},resolveCtx=cfg.path&&new ResolveContext(cfg.path);$element.html(cfg.getTemplate($element,resolveCtx)||initial),trace.traceUIViewFill(data.$uiView,$element.html());var link=$compile($element.contents()),controller=cfg.controller,controllerAs=getControllerAs(cfg),resolveAs=getResolveAs(cfg),locals=resolveCtx&&getLocals(resolveCtx);if(scope[resolveAs]=locals,controller){var controllerInstance=$controller(controller,extend({},locals,{$scope:scope,$element:$element}));controllerAs&&(scope[controllerAs]=controllerInstance,scope[controllerAs][resolveAs]=locals),$element.data("$ngControllerController",controllerInstance),$element.children().data("$ngControllerController",controllerInstance),registerControllerCallbacks($q$$1,$transitions,controllerInstance,scope,cfg)}if(isString(cfg.component))var kebobName=kebobString(cfg.component),tagRegexp_1=new RegExp("^(x-|data-)?"+kebobName+"$","i"),deregisterWatch_1=scope.$watch(function(){var directiveEl=[].slice.call($element[0].children).filter(function(el){return el&&el.tagName&&tagRegexp_1.exec(el.tagName)});return directiveEl&&ng.element(directiveEl).data("$"+cfg.component+"Controller")},function(ctrlInstance){ctrlInstance&&(registerControllerCallbacks($q$$1,$transitions,ctrlInstance,scope,cfg),deregisterWatch_1())});link(scope)}}}}function registerControllerCallbacks($q$$1,$transitions,controllerInstance,$scope,cfg){!isFunction(controllerInstance.$onInit)||cfg.viewDecl.component&&hasComponentImpl||controllerInstance.$onInit();var viewState=tail(cfg.path).state.self,hookOptions={bind:controllerInstance};if(isFunction(controllerInstance.uiOnParamsChanged)){var viewCreationTrans_1=new ResolveContext(cfg.path).getResolvable("$transition$").data;$scope.$on("$destroy",$transitions.onSuccess({},function($transition$){if($transition$!==viewCreationTrans_1&&-1===$transition$.exiting().indexOf(viewState)){var toParams=$transition$.params("to"),fromParams=$transition$.params("from"),getNodeSchema=function(node){return node.paramSchema},toSchema=$transition$.treeChanges("to").map(getNodeSchema).reduce(unnestR,[]),fromSchema=$transition$.treeChanges("from").map(getNodeSchema).reduce(unnestR,[]),changedToParams=toSchema.filter(function(param){var idx=fromSchema.indexOf(param);return-1===idx||!fromSchema[idx].type.equals(toParams[param.id],fromParams[param.id])});if(changedToParams.length){var changedKeys_1=changedToParams.map(function(x){return x.id}),newValues=filter(toParams,function(val$$1,key){return-1!==changedKeys_1.indexOf(key)});controllerInstance.uiOnParamsChanged(newValues,$transition$)}}},hookOptions))}if(isFunction(controllerInstance.uiCanExit)){var id_1=_uiCanExitId++,prevTruthyAnswer_1=function(trans){return!!trans&&(trans._uiCanExitIds&&!0===trans._uiCanExitIds[id_1]||prevTruthyAnswer_1(trans.redirectedFrom()))},criteria={exiting:viewState.name};$scope.$on("$destroy",$transitions.onBefore(criteria,function(trans){var promise,ids=trans._uiCanExitIds=trans._uiCanExitIds||{};return prevTruthyAnswer_1(trans)||(promise=$q$$1.when(controllerInstance.uiCanExit(trans))).then(function(val$$1){return ids[id_1]=!1!==val$$1}),promise},hookOptions))}}var ng_from_global=angular,ng=ng_from_import&&ng_from_import.module?ng_from_import:ng_from_global,prop=function(name){return function(obj){return obj&&obj[name]}},propEq=curry(function(name,_val,obj){return obj&&obj[name]===_val}),parse=function(name){return pipe.apply(null,name.split(".").map(prop))},not=function(fn){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return!fn.apply(null,args)}},all=function(fn1){return function(arr){return arr.reduce(function(b,x){return b&&!!fn1(x)},!0)}},any=function(fn1){return function(arr){return arr.reduce(function(b,x){return b||!!fn1(x)},!1)}},is=function(ctor){return function(obj){return null!=obj&&obj.constructor===ctor||obj instanceof ctor}},eq=function(value){return function(other){return value===other}},val=function(v){return function(){return v}},toStr=Object.prototype.toString,tis=function(t){return function(x){return typeof x===t}},isUndefined=tis("undefined"),isDefined=not(isUndefined),isNull=function(o){return null===o},isNullOrUndefined=or(isNull,isUndefined),isFunction=tis("function"),isNumber=tis("number"),isString=tis("string"),isObject=function(x){return null!==x&&"object"==typeof x},isArray=Array.isArray,isDate=function(x){return"[object Date]"===toStr.call(x)},isRegExp=function(x){return"[object RegExp]"===toStr.call(x)},isPromise=and(isObject,pipe(prop("then"),isFunction)),makeStub=function(service,methods){return methods.reduce(function(acc,key){return acc[key]=function(fnname){return function(){throw new Error("No implementation for "+fnname+". The framework specific code did not implement this method.")}}(service+"."+key+"()"),acc},{})},services={$q:void 0,$injector:void 0},root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0,angular$1=root.angular||{},fromJson=angular$1.fromJson||JSON.parse.bind(JSON),toJson=angular$1.toJson||JSON.stringify.bind(JSON),forEach=angular$1.forEach||function(obj,cb,_this){if(isArray(obj))return obj.forEach(cb,_this);Object.keys(obj).forEach(function(key){return cb(obj[key],key)})},extend=Object.assign||_extend,equals=angular$1.equals||_equals,inherit=function(parent,extra){return extend(Object.create(parent),extra)},inArray=curry(_inArray),removeFrom=curry(_removeFrom),pushTo=curry(_pushTo),deregAll=function(functions){return functions.slice().forEach(function(fn){"function"==typeof fn&&fn(),removeFrom(functions,fn)})},mergeR=function(memo,item){return extend(memo,item)},mapObj=map,values=function(obj){return Object.keys(obj).map(function(key){return obj[key]})},allTrueR=function(memo,elem){return memo&&elem},anyTrueR=function(memo,elem){return memo||elem},unnestR=function(memo,elem){return memo.concat(elem)},flattenR=function(memo,elem){return isArray(elem)?memo.concat(elem.reduce(flattenR,[])):pushR(memo,elem)},uniqR=function(acc,token){return inArray(acc,token)?acc:pushR(acc,token)},unnest=function(arr){return arr.reduce(unnestR,[])},flatten=function(arr){return arr.reduce(flattenR,[])},assertPredicate=assertFn,assertMap=assertFn,pairs=function(obj){return Object.keys(obj).map(function(key){return[key,obj[key]]})},silenceUncaughtInPromise=function(promise){return promise.catch(function(e){return 0})&&promise},silentRejection=function(error){return silenceUncaughtInPromise(services.$q.reject(error))},Glob=function(){function Glob(text){this.text=text,this.glob=text.split(".");var regexpString=this.text.split(".").map(function(seg){return"**"===seg?"(?:|(?:\\.[^.]*)*)":"*"===seg?"\\.[^.]*":"\\."+seg}).join("");this.regexp=new RegExp("^"+regexpString+"$")}return Glob.is=function(text){return!!/[!,*]+/.exec(text)},Glob.fromString=function(text){return Glob.is(text)?new Glob(text):null},Glob.prototype.matches=function(name){return this.regexp.test("."+name)},Glob}(),Queue=function(){function Queue(_items,_limit){void 0===_items&&(_items=[]),void 0===_limit&&(_limit=null),this._items=_items,this._limit=_limit,this._evictListeners=[],this.onEvict=pushTo(this._evictListeners)}return Queue.prototype.enqueue=function(item){var items=this._items;return items.push(item),this._limit&&items.length>this._limit&&this.evict(),item},Queue.prototype.evict=function(){var item=this._items.shift();return this._evictListeners.forEach(function(fn){return fn(item)}),item},Queue.prototype.dequeue=function(){if(this.size())return this._items.splice(0,1)[0]},Queue.prototype.clear=function(){var current=this._items;return this._items=[],current},Queue.prototype.size=function(){return this._items.length},Queue.prototype.remove=function(item){var idx=this._items.indexOf(item);return idx>-1&&this._items.splice(idx,1)[0]},Queue.prototype.peekTail=function(){return this._items[this._items.length-1]},Queue.prototype.peekHead=function(){if(this.size())return this._items[0]},Queue}();!function(RejectType){RejectType[RejectType.SUPERSEDED=2]="SUPERSEDED",RejectType[RejectType.ABORTED=3]="ABORTED",RejectType[RejectType.INVALID=4]="INVALID",RejectType[RejectType.IGNORED=5]="IGNORED",RejectType[RejectType.ERROR=6]="ERROR"}(exports.RejectType||(exports.RejectType={}));var id=0,Rejection=function(){function Rejection(type,message,detail){this.$id=id++,this.type=type,this.message=message,this.detail=detail}return Rejection.isRejectionPromise=function(obj){return obj&&"function"==typeof obj.then&&is(Rejection)(obj._transitionRejection)},Rejection.superseded=function(detail,options){var rejection=new Rejection(exports.RejectType.SUPERSEDED,"The transition has been superseded by a different transition",detail);return options&&options.redirected&&(rejection.redirected=!0),rejection},Rejection.redirected=function(detail){return Rejection.superseded(detail,{redirected:!0})},Rejection.invalid=function(detail){return new Rejection(exports.RejectType.INVALID,"This transition is invalid",detail)},Rejection.ignored=function(detail){return new Rejection(exports.RejectType.IGNORED,"The transition was ignored",detail)},Rejection.aborted=function(detail){return new Rejection(exports.RejectType.ABORTED,"The transition has been aborted",detail)},Rejection.errored=function(detail){return new Rejection(exports.RejectType.ERROR,"The transition errored",detail)},Rejection.normalize=function(detail){return is(Rejection)(detail)?detail:Rejection.errored(detail)},Rejection.prototype.toString=function(){var detail=function(d){return d&&d.toString!==Object.prototype.toString?d.toString():stringify(d)}(this.detail);return"Transition Rejection($id: "+this.$id+" type: "+this.type+", message: "+this.message+", detail: "+detail+")"},Rejection.prototype.toPromise=function(){return extend(silentRejection(this),{_transitionRejection:this})},Rejection}(),isRejection=Rejection.isRejectionPromise,stringifyPattern=pattern([[isUndefined,val("undefined")],[isNull,val("null")],[isPromise,val("[Promise]")],[isRejection,function(x){return x._transitionRejection.toString()}],[function(obj){return isObject(obj)&&!isArray(obj)&&obj.constructor!==Object&&isFunction(obj.toString)},function(x){return x.toString()}],[isInjectable,functionToString],[val(!0),identity]]),beforeAfterSubstr=function(char){return function(str){if(!str)return["",""];var idx=str.indexOf(char);return-1===idx?[str,""]:[str.substr(0,idx),str.substr(idx+1)]}},hostRegex=new RegExp("^(?:[a-z]+:)?//[^/]+/"),stripLastPathElement=function(str){return str.replace(/\/[^/]*$/,"")},splitHash=beforeAfterSubstr("#"),splitQuery=beforeAfterSubstr("?"),splitEqual=beforeAfterSubstr("="),trimHashVal=function(str){return str?str.replace(/^#/,""):""},consoleLog=Function.prototype.bind.call(console.log,console),consoletable=isFunction(console.table)?console.table.bind(console):consoleLog.bind(console);!function(Category){Category[Category.RESOLVE=0]="RESOLVE",Category[Category.TRANSITION=1]="TRANSITION",Category[Category.HOOK=2]="HOOK",Category[Category.UIVIEW=3]="UIVIEW",Category[Category.VIEWCONFIG=4]="VIEWCONFIG"}(exports.Category||(exports.Category={}));var _tid=parse("$id"),_rid=parse("router.$id"),transLbl=function(trans){return"Transition #"+_tid(trans)+"-"+_rid(trans)},Trace=function(){function Trace(){this._enabled={},this.approximateDigests=0}return Trace.prototype._set=function(enabled,categories){var _this=this;categories.length||(categories=Object.keys(exports.Category).map(function(k){return parseInt(k,10)}).filter(function(k){return!isNaN(k)}).map(function(key){return exports.Category[key]})),categories.map(normalizedCat).forEach(function(category){return _this._enabled[category]=enabled})},Trace.prototype.enable=function(){for(var categories=[],_i=0;_i<arguments.length;_i++)categories[_i]=arguments[_i];this._set(!0,categories)},Trace.prototype.disable=function(){for(var categories=[],_i=0;_i<arguments.length;_i++)categories[_i]=arguments[_i];this._set(!1,categories)},Trace.prototype.enabled=function(category){return!!this._enabled[normalizedCat(category)]},Trace.prototype.traceTransitionStart=function(trans){this.enabled(exports.Category.TRANSITION)&&console.log(transLbl(trans)+": Started  -> "+stringify(trans))},Trace.prototype.traceTransitionIgnored=function(trans){this.enabled(exports.Category.TRANSITION)&&console.log(transLbl(trans)+": Ignored  <> "+stringify(trans))},Trace.prototype.traceHookInvocation=function(step,trans,options){if(this.enabled(exports.Category.HOOK)){var event=parse("traceData.hookType")(options)||"internal",context=parse("traceData.context.state.name")(options)||parse("traceData.context")(options)||"unknown",name=functionToString(step.registeredHook.callback);console.log(transLbl(trans)+":   Hook -> "+event+" context: "+context+", "+maxLength(200,name))}},Trace.prototype.traceHookResult=function(hookResult,trans,transitionOptions){this.enabled(exports.Category.HOOK)&&console.log(transLbl(trans)+":   <- Hook returned: "+maxLength(200,stringify(hookResult)))},Trace.prototype.traceResolvePath=function(path,when,trans){this.enabled(exports.Category.RESOLVE)&&console.log(transLbl(trans)+":         Resolving "+path+" ("+when+")")},Trace.prototype.traceResolvableResolved=function(resolvable,trans){this.enabled(exports.Category.RESOLVE)&&console.log(transLbl(trans)+":               <- Resolved  "+resolvable+" to: "+maxLength(200,stringify(resolvable.data)))},Trace.prototype.traceError=function(reason,trans){this.enabled(exports.Category.TRANSITION)&&console.log(transLbl(trans)+": <- Rejected "+stringify(trans)+", reason: "+reason)},Trace.prototype.traceSuccess=function(finalState,trans){this.enabled(exports.Category.TRANSITION)&&console.log(transLbl(trans)+": <- Success  "+stringify(trans)+", final state: "+finalState.name)},Trace.prototype.traceUIViewEvent=function(event,viewData,extra){void 0===extra&&(extra=""),this.enabled(exports.Category.UIVIEW)&&console.log("ui-view: "+padString(30,event)+" "+uiViewString(viewData)+extra)},Trace.prototype.traceUIViewConfigUpdated=function(viewData,context){this.enabled(exports.Category.UIVIEW)&&this.traceUIViewEvent("Updating",viewData," with ViewConfig from context='"+context+"'")},Trace.prototype.traceUIViewFill=function(viewData,html){this.enabled(exports.Category.UIVIEW)&&this.traceUIViewEvent("Fill",viewData," with: "+maxLength(200,html))},Trace.prototype.traceViewSync=function(pairs){if(this.enabled(exports.Category.VIEWCONFIG)){var uivheader="uiview component fqn",mapping=pairs.map(function(_a){var _b,uiView=_a.uiView,viewConfig=_a.viewConfig,uiv=uiView&&uiView.fqn,cfg=viewConfig&&viewConfig.viewDecl.$context.name+": ("+viewConfig.viewDecl.$name+")";return _b={},_b[uivheader]=uiv,_b["view config state (view name)"]=cfg,_b}).sort(function(a,b){return(a[uivheader]||"").localeCompare(b[uivheader]||"")});consoletable(mapping)}},Trace.prototype.traceViewServiceEvent=function(event,viewConfig){this.enabled(exports.Category.VIEWCONFIG)&&console.log("VIEWCONFIG: "+event+" "+function(viewConfig){var view=viewConfig.viewDecl,state=view.$context.name||"(root)";return"[View#"+viewConfig.$id+" from '"+state+"' state]: target ui-view: '"+view.$uiViewName+"@"+view.$uiViewContextAnchor+"'"}(viewConfig))},Trace.prototype.traceViewServiceUIViewEvent=function(event,viewData){this.enabled(exports.Category.VIEWCONFIG)&&console.log("VIEWCONFIG: "+event+" "+uiViewString(viewData))},Trace}(),trace=new Trace,ParamType=function(){function ParamType(def){this.pattern=/.*/,this.inherit=!0,extend(this,def)}return ParamType.prototype.is=function(val,key){return!0},ParamType.prototype.encode=function(val,key){return val},ParamType.prototype.decode=function(val,key){return val},ParamType.prototype.equals=function(a,b){return a==b},ParamType.prototype.$subPattern=function(){var sub=this.pattern.toString();return sub.substr(1,sub.length-2)},ParamType.prototype.toString=function(){return"{ParamType:"+this.name+"}"},ParamType.prototype.$normalize=function(val){return this.is(val)?val:this.decode(val)},ParamType.prototype.$asArray=function(mode,isSearch){if(!mode)return this;if("auto"===mode&&!isSearch)throw new Error("'auto' array mode is for query parameters only");return new function(type,mode){function arrayWrap(val){return isArray(val)?val:isDefined(val)?[val]:[]}function arrayHandler(callback,allTruthyMode){return function(val){if(isArray(val)&&0===val.length)return val;var result=map(arrayWrap(val),callback);return!0===allTruthyMode?0===filter(result,function(x){return!x}).length:function(val){switch(val.length){case 0:return;case 1:return"auto"===mode?val[0]:val;default:return val}}(result)}}var _this=this;["encode","decode","equals","$normalize"].forEach(function(name){var paramTypeFn=type[name].bind(type),wrapperFn="equals"===name?function(callback){return function(val1,val2){var left=arrayWrap(val1),right=arrayWrap(val2);if(left.length!==right.length)return!1;for(var i=0;i<left.length;i++)if(!callback(left[i],right[i]))return!1;return!0}}:arrayHandler;_this[name]=wrapperFn(paramTypeFn)}),extend(this,{dynamic:type.dynamic,name:type.name,pattern:type.pattern,inherit:type.inherit,raw:type.raw,is:arrayHandler(type.is.bind(type),!0),$arrayMode:mode})}(this,mode)},ParamType}(),hasOwn=Object.prototype.hasOwnProperty,isShorthand=function(cfg){return 0===["value","type","squash","array","dynamic"].filter(hasOwn.bind(cfg||{})).length};!function(DefType){DefType[DefType.PATH=0]="PATH",DefType[DefType.SEARCH=1]="SEARCH",DefType[DefType.CONFIG=2]="CONFIG"}(exports.DefType||(exports.DefType={}));var Param=function(){function Param(id,type,location,urlConfig,state){var config=function(paramName,location,state){var noReloadOnSearch=!1===state.reloadOnSearch&&location===exports.DefType.SEARCH||void 0,dynamic=find([state.dynamic,noReloadOnSearch],isDefined),defaultConfig=isDefined(dynamic)?{dynamic:dynamic}:{},paramConfig=function(cfg){function getStaticDefaultValue(){return cfg.value}cfg=isShorthand(cfg)?{value:cfg}:cfg,getStaticDefaultValue.__cacheable=!0;var $$fn=isInjectable(cfg.value)?cfg.value:getStaticDefaultValue;return extend(cfg,{$$fn:$$fn})}(state&&state.params&&state.params[paramName]);return extend(defaultConfig,paramConfig)}(id,location,state);type=function(cfg,urlType,location,id,paramTypes){if(cfg.type&&urlType&&"string"!==urlType.name)throw new Error("Param '"+id+"' has two type configurations.");if(cfg.type&&urlType&&"string"===urlType.name&&paramTypes.type(cfg.type))return paramTypes.type(cfg.type);if(urlType)return urlType;if(!cfg.type){var type=location===exports.DefType.CONFIG?"any":location===exports.DefType.PATH?"path":location===exports.DefType.SEARCH?"query":"string";return paramTypes.type(type)}return cfg.type instanceof ParamType?cfg.type:paramTypes.type(cfg.type)}(config,type,location,id,urlConfig.paramTypes);var arrayMode=function(){var arrayDefaults={array:location===exports.DefType.SEARCH&&"auto"},arrayParamNomenclature=id.match(/\[\]$/)?{array:!0}:{};return extend(arrayDefaults,arrayParamNomenclature,config).array}();type=arrayMode?type.$asArray(arrayMode,location===exports.DefType.SEARCH):type;var isOptional=void 0!==config.value||location===exports.DefType.SEARCH,dynamic=isDefined(config.dynamic)?!!config.dynamic:!!type.dynamic,raw=isDefined(config.raw)?!!config.raw:!!type.raw,squash=function(config,isOptional,defaultPolicy){var squash=config.squash;if(!isOptional||!1===squash)return!1;if(!isDefined(squash)||null==squash)return defaultPolicy;if(!0===squash||isString(squash))return squash;throw new Error("Invalid squash policy: '"+squash+"'. Valid policies: false, true, or arbitrary string")}(config,isOptional,urlConfig.defaultSquashPolicy()),replace=function(config,arrayMode,isOptional,squash){var defaultPolicy=[{from:"",to:isOptional||arrayMode?void 0:""},{from:null,to:isOptional||arrayMode?void 0:""}],replace=isArray(config.replace)?config.replace:[];isString(squash)&&replace.push({from:squash,to:void 0});var configuredKeys=map(replace,prop("from"));return filter(defaultPolicy,function(item){return-1===configuredKeys.indexOf(item.from)}).concat(replace)}(config,arrayMode,isOptional,squash),inherit$$1=isDefined(config.inherit)?!!config.inherit:!!type.inherit;extend(this,{id:id,type:type,location:location,isOptional:isOptional,dynamic:dynamic,raw:raw,squash:squash,replace:replace,inherit:inherit$$1,array:arrayMode,config:config})}return Param.values=function(params,values$$1){void 0===values$$1&&(values$$1={});for(var paramValues={},_i=0,params_1=params;_i<params_1.length;_i++){var param=params_1[_i];paramValues[param.id]=param.value(values$$1[param.id])}return paramValues},Param.changed=function(params,values1,values2){return void 0===values1&&(values1={}),void 0===values2&&(values2={}),params.filter(function(param){return!param.type.equals(values1[param.id],values2[param.id])})},Param.equals=function(params,values1,values2){return void 0===values1&&(values1={}),void 0===values2&&(values2={}),0===Param.changed(params,values1,values2).length},Param.validates=function(params,values$$1){return void 0===values$$1&&(values$$1={}),params.map(function(param){return param.validates(values$$1[param.id])}).reduce(allTrueR,!0)},Param.prototype.isDefaultValue=function(value){return this.isOptional&&this.type.equals(this.value(),value)},Param.prototype.value=function(value){var _this=this;return value=function(val$$1){for(var _i=0,_a=_this.replace;_i<_a.length;_i++){var tuple=_a[_i];if(tuple.from===val$$1)return tuple.to}return val$$1}(value),isUndefined(value)?function(){if(_this._defaultValueCache)return _this._defaultValueCache.defaultValue;if(!services.$injector)throw new Error("Injectable functions cannot be called at configuration time");var defaultValue=services.$injector.invoke(_this.config.$$fn);if(null!==defaultValue&&void 0!==defaultValue&&!_this.type.is(defaultValue))throw new Error("Default value ("+defaultValue+") for parameter '"+_this.id+"' is not an instance of ParamType ("+_this.type.name+")");return _this.config.$$fn.__cacheable&&(_this._defaultValueCache={defaultValue:defaultValue}),defaultValue}():this.type.$normalize(value)},Param.prototype.isSearch=function(){return this.location===exports.DefType.SEARCH},Param.prototype.validates=function(value){if((isUndefined(value)||null===value)&&this.isOptional)return!0;var normalized=this.type.$normalize(value);if(!this.type.is(normalized))return!1;var encoded=this.type.encode(normalized);return!(isString(encoded)&&!this.type.pattern.exec(encoded))},Param.prototype.toString=function(){return"{Param:"+this.id+" "+this.type+" squash: '"+this.squash+"' optional: "+this.isOptional+"}"},Param}(),ParamTypes=function(){function ParamTypes(){this.enqueue=!0,this.typeQueue=[],this.defaultTypes=pick(ParamTypes.prototype,["hash","string","query","path","int","bool","date","json","any"]);this.types=inherit(map(this.defaultTypes,function(definition,name){return new ParamType(extend({name:name},definition))}),{})}return ParamTypes.prototype.dispose=function(){this.types={}},ParamTypes.prototype.type=function(name,definition,definitionFn){if(!isDefined(definition))return this.types[name];if(this.types.hasOwnProperty(name))throw new Error("A type named '"+name+"' has already been defined.");return this.types[name]=new ParamType(extend({name:name},definition)),definitionFn&&(this.typeQueue.push({name:name,def:definitionFn}),this.enqueue||this._flushTypeQueue()),this},ParamTypes.prototype._flushTypeQueue=function(){for(;this.typeQueue.length;){var type=this.typeQueue.shift();if(type.pattern)throw new Error("You cannot override a type's .pattern at runtime.");extend(this.types[type.name],services.$injector.invoke(type.def))}},ParamTypes}();!function(){var makeDefaultType=function(def){var valToString=function(val$$1){return null!=val$$1?val$$1.toString():val$$1},defaultTypeBase={encode:valToString,decode:valToString,is:is(String),pattern:/.*/,equals:function(a,b){return a==b}};return extend({},defaultTypeBase,def)};extend(ParamTypes.prototype,{string:makeDefaultType({}),path:makeDefaultType({pattern:/[^/]*/}),query:makeDefaultType({}),hash:makeDefaultType({inherit:!1}),int:makeDefaultType({decode:function(val$$1){return parseInt(val$$1,10)},is:function(val$$1){return!isNullOrUndefined(val$$1)&&this.decode(val$$1.toString())===val$$1},pattern:/-?\d+/}),bool:makeDefaultType({encode:function(val$$1){return val$$1&&1||0},decode:function(val$$1){return 0!==parseInt(val$$1,10)},is:is(Boolean),pattern:/0|1/}),date:makeDefaultType({encode:function(val$$1){return this.is(val$$1)?[val$$1.getFullYear(),("0"+(val$$1.getMonth()+1)).slice(-2),("0"+val$$1.getDate()).slice(-2)].join("-"):void 0},decode:function(val$$1){if(this.is(val$$1))return val$$1;var match=this.capture.exec(val$$1);return match?new Date(match[1],match[2]-1,match[3]):void 0},is:function(val$$1){return val$$1 instanceof Date&&!isNaN(val$$1.valueOf())},equals:function(l,r){return["getFullYear","getMonth","getDate"].reduce(function(acc,fn){return acc&&l[fn]()===r[fn]()},!0)},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/}),json:makeDefaultType({encode:toJson,decode:fromJson,is:is(Object),equals:equals,pattern:/[^/]*/}),any:makeDefaultType({encode:identity,decode:identity,is:function(){return!0},equals:equals})})}();var StateParams=function(){function StateParams(params){void 0===params&&(params={}),extend(this,params)}return StateParams.prototype.$inherit=function(newParams,$current,$to){var parentParams,parents=ancestors($current,$to),inherited={},inheritList=[];for(var i in parents)if(parents[i]&&parents[i].params&&(parentParams=Object.keys(parents[i].params)).length)for(var j in parentParams)inheritList.indexOf(parentParams[j])>=0||(inheritList.push(parentParams[j]),inherited[parentParams[j]]=this[parentParams[j]]);return extend({},inherited,newParams)},StateParams}(),PathNode=function(){function PathNode(stateOrNode){if(stateOrNode instanceof PathNode){var node=stateOrNode;this.state=node.state,this.paramSchema=node.paramSchema.slice(),this.paramValues=extend({},node.paramValues),this.resolvables=node.resolvables.slice(),this.views=node.views&&node.views.slice()}else{var state=stateOrNode;this.state=state,this.paramSchema=state.parameters({inherit:!1}),this.paramValues={},this.resolvables=state.resolvables.map(function(res){return res.clone()})}}return PathNode.prototype.clone=function(){return new PathNode(this)},PathNode.prototype.applyRawParams=function(params){return this.paramValues=this.paramSchema.reduce(function(memo,pDef){return applyPairs(memo,function(paramDef){return[paramDef.id,paramDef.value(params[paramDef.id])]}(pDef))},{}),this},PathNode.prototype.parameter=function(name){return find(this.paramSchema,propEq("id",name))},PathNode.prototype.equals=function(node,paramsFn){var diff=this.diff(node,paramsFn);return diff&&0===diff.length},PathNode.prototype.diff=function(node,paramsFn){if(this.state!==node.state)return!1;var params=paramsFn?paramsFn(this):this.paramSchema;return Param.changed(params,this.paramValues,node.paramValues)},PathNode.clone=function(node){return node.clone()},PathNode}(),TargetState=function(){function TargetState(_stateRegistry,_identifier,_params,_options){this._stateRegistry=_stateRegistry,this._identifier=_identifier,this._identifier=_identifier,this._params=extend({},_params||{}),this._options=extend({},_options||{}),this._definition=_stateRegistry.matcher.find(_identifier,this._options.relative)}return TargetState.prototype.name=function(){return this._definition&&this._definition.name||this._identifier},TargetState.prototype.identifier=function(){return this._identifier},TargetState.prototype.params=function(){return this._params},TargetState.prototype.$state=function(){return this._definition},TargetState.prototype.state=function(){return this._definition&&this._definition.self},TargetState.prototype.options=function(){return this._options},TargetState.prototype.exists=function(){return!(!this._definition||!this._definition.self)},TargetState.prototype.valid=function(){return!this.error()},TargetState.prototype.error=function(){var base=this.options().relative;if(!this._definition&&base){var stateName=base.name?base.name:base;return"Could not resolve '"+this.name()+"' from state '"+stateName+"'"}return this._definition?this._definition.self?void 0:"State '"+this.name()+"' has an invalid definition":"No such state '"+this.name()+"'"},TargetState.prototype.toString=function(){return"'"+this.name()+"'"+stringify(this.params())},TargetState.prototype.withState=function(state){return new TargetState(this._stateRegistry,state,this._params,this._options)},TargetState.prototype.withParams=function(params,replace){void 0===replace&&(replace=!1);var newParams=replace?params:extend({},this._params,params);return new TargetState(this._stateRegistry,this._identifier,newParams,this._options)},TargetState.prototype.withOptions=function(options,replace){void 0===replace&&(replace=!1);var newOpts=replace?options:extend({},this._options,options);return new TargetState(this._stateRegistry,this._identifier,this._params,newOpts)},TargetState.isDef=function(obj){return obj&&obj.state&&(isString(obj.state)||isString(obj.state.name))},TargetState}(),PathUtils=function(){function PathUtils(){}return PathUtils.makeTargetState=function(registry,path){var state=tail(path).state;return new TargetState(registry,state,path.map(prop("paramValues")).reduce(mergeR,{}),{})},PathUtils.buildPath=function(targetState){var toParams=targetState.params();return targetState.$state().path.map(function(state){return new PathNode(state).applyRawParams(toParams)})},PathUtils.buildToPath=function(fromPath,targetState){var toPath=PathUtils.buildPath(targetState);return targetState.options().inherit?PathUtils.inheritParams(fromPath,toPath,Object.keys(targetState.params())):toPath},PathUtils.applyViewConfigs=function($view,path,states){path.filter(function(node){return inArray(states,node.state)}).forEach(function(node){var viewDecls=values(node.state.views||{}),subPath=PathUtils.subPath(path,function(n){return n===node}),viewConfigs=viewDecls.map(function(view){return $view.createViewConfig(subPath,view)});node.views=viewConfigs.reduce(unnestR,[])})},PathUtils.inheritParams=function(fromPath,toPath,toKeys){void 0===toKeys&&(toKeys=[]);var noInherit=fromPath.map(function(node){return node.paramSchema}).reduce(unnestR,[]).filter(function(param){return!param.inherit}).map(prop("id"));return toPath.map(function(toNode){var toParamVals=extend({},toNode&&toNode.paramValues),incomingParamVals=pick(toParamVals,toKeys);toParamVals=omit(toParamVals,toKeys);var fromParamVals=omit(function(path,state){var node=find(path,propEq("state",state));return extend({},node&&node.paramValues)}(fromPath,toNode.state)||{},noInherit),ownParamVals=extend(toParamVals,fromParamVals,incomingParamVals);return new PathNode(toNode.state).applyRawParams(ownParamVals)})},PathUtils.treeChanges=function(fromPath,toPath,reloadState){for(var max=Math.min(fromPath.length,toPath.length),keep=0;keep<max&&fromPath[keep].state!==reloadState&&function(node1,node2){return node1.equals(node2,PathUtils.nonDynamicParams)}(fromPath[keep],toPath[keep]);)keep++;var from,retained,exiting,entering,to;retained=(from=fromPath).slice(0,keep),exiting=from.slice(keep);var retainedWithToParams=retained.map(function(retainedNode,idx){var cloned=retainedNode.clone();return cloned.paramValues=toPath[idx].paramValues,cloned});return entering=toPath.slice(keep),to=retainedWithToParams.concat(entering),{from:from,to:to,retained:retained,retainedWithToParams:retainedWithToParams,exiting:exiting,entering:entering}},PathUtils.matching=function(pathA,pathB,paramsFn){var done=!1;return arrayTuples(pathA,pathB).reduce(function(matching,_a){var nodeA=_a[0],nodeB=_a[1];return(done=done||!nodeA.equals(nodeB,paramsFn))?matching:matching.concat(nodeA)},[])},PathUtils.equals=function(pathA,pathB,paramsFn){return pathA.length===pathB.length&&PathUtils.matching(pathA,pathB,paramsFn).length===pathA.length},PathUtils.subPath=function(path,predicate){var node=find(path,predicate),elementIdx=path.indexOf(node);return-1===elementIdx?void 0:path.slice(0,elementIdx+1)},PathUtils.nonDynamicParams=function(node){return node.state.parameters({inherit:!1}).filter(function(param){return!param.dynamic})},PathUtils.paramValues=function(path){return path.reduce(function(acc,node){return extend(acc,node.paramValues)},{})},PathUtils}(),resolvePolicies={when:{LAZY:"LAZY",EAGER:"EAGER"},async:{WAIT:"WAIT",NOWAIT:"NOWAIT",RXWAIT:"RXWAIT"}},defaultResolvePolicy={when:"LAZY",async:"WAIT"},Resolvable=function(){function Resolvable(arg1,resolveFn,deps,policy,data){if(this.resolved=!1,this.promise=void 0,arg1 instanceof Resolvable)extend(this,arg1);else if(isFunction(resolveFn)){if(isNullOrUndefined(arg1))throw new Error("new Resolvable(): token argument is required");if(!isFunction(resolveFn))throw new Error("new Resolvable(): resolveFn argument must be a function");this.token=arg1,this.policy=policy,this.resolveFn=resolveFn,this.deps=deps||[],this.data=data,this.resolved=void 0!==data,this.promise=this.resolved?services.$q.when(this.data):void 0}else if(isObject(arg1)&&arg1.token&&(arg1.hasOwnProperty("resolveFn")||arg1.hasOwnProperty("data"))){var literal=arg1;return new Resolvable(literal.token,literal.resolveFn,literal.deps,literal.policy,literal.data)}}return Resolvable.prototype.getPolicy=function(state){var thisPolicy=this.policy||{},statePolicy=state&&state.resolvePolicy||{};return{when:thisPolicy.when||statePolicy.when||defaultResolvePolicy.when,async:thisPolicy.async||statePolicy.async||defaultResolvePolicy.async}},Resolvable.prototype.resolve=function(resolveContext,trans){var _this=this,$q=services.$q,node=resolveContext.findNode(this),state=node&&node.state,maybeWaitForRx="RXWAIT"===this.getPolicy(state).async?function(observable$){var cached=observable$.cache(1);return cached.take(1).toPromise().then(function(){return cached})}:identity;return this.promise=$q.when().then(function(){return $q.all(resolveContext.getDependencies(_this).map(function(resolvable){return resolvable.get(resolveContext,trans)}))}).then(function(resolvedDeps){return _this.resolveFn.apply(null,resolvedDeps)}).then(maybeWaitForRx).then(function(resolvedValue){return _this.data=resolvedValue,_this.resolved=!0,_this.resolveFn=null,trace.traceResolvableResolved(_this,trans),_this.data})},Resolvable.prototype.get=function(resolveContext,trans){return this.promise||this.resolve(resolveContext,trans)},Resolvable.prototype.toString=function(){return"Resolvable(token: "+stringify(this.token)+", requires: ["+this.deps.map(stringify)+"])"},Resolvable.prototype.clone=function(){return new Resolvable(this)},Resolvable.fromData=function(token,data){return new Resolvable(token,function(){return data},null,null,data)},Resolvable}(),whens=resolvePolicies.when,ALL_WHENS=[whens.EAGER,whens.LAZY],EAGER_WHENS=[whens.EAGER],NATIVE_INJECTOR_TOKEN="Native Injector",ResolveContext=function(){function ResolveContext(_path){this._path=_path}return ResolveContext.prototype.getTokens=function(){return this._path.reduce(function(acc,node){return acc.concat(node.resolvables.map(function(r){return r.token}))},[]).reduce(uniqR,[])},ResolveContext.prototype.getResolvable=function(token){return tail(this._path.map(function(node){return node.resolvables}).reduce(unnestR,[]).filter(function(r){return r.token===token}))},ResolveContext.prototype.getPolicy=function(resolvable){var node=this.findNode(resolvable);return resolvable.getPolicy(node.state)},ResolveContext.prototype.subContext=function(state){return new ResolveContext(PathUtils.subPath(this._path,function(node){return node.state===state}))},ResolveContext.prototype.addResolvables=function(newResolvables,state){var node=find(this._path,propEq("state",state)),keys=newResolvables.map(function(r){return r.token});node.resolvables=node.resolvables.filter(function(r){return-1===keys.indexOf(r.token)}).concat(newResolvables)},ResolveContext.prototype.resolvePath=function(when,trans){var _this=this;void 0===when&&(when="LAZY");var matchedWhens=(inArray(ALL_WHENS,when)?when:"LAZY")===resolvePolicies.when.EAGER?EAGER_WHENS:ALL_WHENS;trace.traceResolvePath(this._path,when,trans);var matchesPolicy=function(acceptedVals,whenOrAsync){return function(resolvable){return inArray(acceptedVals,_this.getPolicy(resolvable)[whenOrAsync])}},promises=this._path.reduce(function(acc,node){var nodeResolvables=node.resolvables.filter(matchesPolicy(matchedWhens,"when")),nowait=nodeResolvables.filter(matchesPolicy(["NOWAIT"],"async")),wait=nodeResolvables.filter(not(matchesPolicy(["NOWAIT"],"async"))),subContext=_this.subContext(node.state),getResult=function(r){return r.get(subContext,trans).then(function(value){return{token:r.token,value:value}})};return nowait.forEach(getResult),acc.concat(wait.map(getResult))},[]);return services.$q.all(promises)},ResolveContext.prototype.injector=function(){return this._injector||(this._injector=new UIInjectorImpl(this))},ResolveContext.prototype.findNode=function(resolvable){return find(this._path,function(node){return inArray(node.resolvables,resolvable)})},ResolveContext.prototype.getDependencies=function(resolvable){var _this=this,node=this.findNode(resolvable),availableResolvables=(PathUtils.subPath(this._path,function(x){return x===node})||this._path).reduce(function(acc,_node){return acc.concat(_node.resolvables)},[]).filter(function(res){return res!==resolvable});return resolvable.deps.map(function(token){var matching=availableResolvables.filter(function(r){return r.token===token});if(matching.length)return tail(matching);var fromInjector=_this.injector().getNative(token);if(isUndefined(fromInjector))throw new Error("Could not find Dependency Injection token: "+stringify(token));return new Resolvable(token,function(){return fromInjector},[],fromInjector)})},ResolveContext}(),UIInjectorImpl=function(){function UIInjectorImpl(context){this.context=context,this.native=this.get(NATIVE_INJECTOR_TOKEN)||services.$injector}return UIInjectorImpl.prototype.get=function(token){var resolvable=this.context.getResolvable(token);if(resolvable){if("NOWAIT"===this.context.getPolicy(resolvable).async)return resolvable.get(this.context);if(!resolvable.resolved)throw new Error("Resolvable async .get() not complete:"+stringify(resolvable.token));return resolvable.data}return this.getNative(token)},UIInjectorImpl.prototype.getAsync=function(token){var resolvable=this.context.getResolvable(token);return resolvable?resolvable.get(this.context):services.$q.when(this.native.get(token))},UIInjectorImpl.prototype.getNative=function(token){return this.native&&this.native.get(token)},UIInjectorImpl}(),getUrlBuilder=function($urlMatcherFactoryProvider,root$$1){return function(stateObject){var state=stateObject.self;state&&state.url&&state.name&&state.name.match(/\.\*\*$/)&&(state.url+="{remainder:any}");var parent=stateObject.parent,parsed=function(url){if(!isString(url))return!1;var root$$1="^"===url.charAt(0);return{val:root$$1?url.substring(1):url,root:root$$1}}(state.url),url=parsed?$urlMatcherFactoryProvider.compile(parsed.val,{state:state}):state.url;if(!url)return null;if(!$urlMatcherFactoryProvider.isMatcher(url))throw new Error("Invalid url '"+url+"' in state '"+stateObject+"'");return parsed&&parsed.root?url:(parent&&parent.navigable||root$$1()).url.append(url)}},getNavigableBuilder=function(isRoot){return function(state){return!isRoot(state)&&state.url?state:state.parent?state.parent.navigable:null}},getParamsBuilder=function(paramFactory){return function(state){var urlParams=state.url&&state.url.parameters({inherit:!1})||[],nonUrlParams=values(mapObj(omit(state.params||{},urlParams.map(prop("id"))),function(config,id){return paramFactory.fromConfig(id,null,state.self)}));return urlParams.concat(nonUrlParams).map(function(p){return[p.id,p]}).reduce(applyPairs,{})}},StateBuilder=function(){function StateBuilder(matcher,urlMatcherFactory){this.matcher=matcher;var self=this,root$$1=function(){return matcher.find("")},isRoot=function(state){return""===state.name};this.builders={name:[function(state){return state.name}],self:[function(state){return state.self.$$state=function(){return state},state.self}],parent:[function(state){return isRoot(state)?null:matcher.find(self.parentName(state))||root$$1()}],data:[function(state){return state.parent&&state.parent.data&&(state.data=state.self.data=inherit(state.parent.data,state.data)),state.data}],url:[getUrlBuilder(urlMatcherFactory,root$$1)],navigable:[getNavigableBuilder(isRoot)],params:[getParamsBuilder(urlMatcherFactory.paramFactory)],views:[],path:[function(state){return state.parent?state.parent.path.concat(state):[state]}],includes:[function(state){var includes=state.parent?extend({},state.parent.includes):{};return includes[state.name]=!0,includes}],resolvables:[resolvablesBuilder]}}return StateBuilder.prototype.builder=function(name,fn){var builders=this.builders,array=builders[name]||[];return isString(name)&&!isDefined(fn)?array.length>1?array:array[0]:isString(name)&&isFunction(fn)?(builders[name]=array,builders[name].push(fn),function(){return builders[name].splice(builders[name].indexOf(fn,1))&&null}):void 0},StateBuilder.prototype.build=function(state){var matcher=this.matcher,builders=this.builders,parent=this.parentName(state);if(parent&&!matcher.find(parent,void 0,!1))return null;for(var key in builders)if(builders.hasOwnProperty(key)){var chain=builders[key].reduce(function(parentFn,step){return function(_state){return step(_state,parentFn)}},noop);state[key]=chain(state)}return state},StateBuilder.prototype.parentName=function(state){var name=state.name||"",segments=name.split(".");if("**"===segments.pop()&&segments.pop(),segments.length){if(state.parent)throw new Error("States that specify the 'parent:' property should not have a '.' in their name ("+name+")");return segments.join(".")}return state.parent?isString(state.parent)?state.parent:state.parent.name:""},StateBuilder.prototype.name=function(state){var name=state.name;if(-1!==name.indexOf(".")||!state.parent)return name;var parentName=isString(state.parent)?state.parent:state.parent.name;return parentName?parentName+"."+name:name},StateBuilder}(),StateObject=function(){function StateObject(config){return StateObject.create(config||{})}return StateObject.create=function(stateDecl){stateDecl=StateObject.isStateClass(stateDecl)?new stateDecl:stateDecl;var state=inherit(inherit(stateDecl,StateObject.prototype));return stateDecl.$$state=function(){return state},state.self=stateDecl,state.__stateObjectCache={nameGlob:Glob.fromString(state.name)},state},StateObject.prototype.is=function(ref){return this===ref||this.self===ref||this.fqn()===ref},StateObject.prototype.fqn=function(){if(!(this.parent&&this.parent instanceof this.constructor))return this.name;var name=this.parent.fqn();return name?name+"."+this.name:this.name},StateObject.prototype.root=function(){return this.parent&&this.parent.root()||this},StateObject.prototype.parameters=function(opts){return((opts=defaults(opts,{inherit:!0,matchingKeys:null})).inherit&&this.parent&&this.parent.parameters()||[]).concat(values(this.params)).filter(function(param){return!opts.matchingKeys||opts.matchingKeys.hasOwnProperty(param.id)})},StateObject.prototype.parameter=function(id,opts){return void 0===opts&&(opts={}),this.url&&this.url.parameter(id,opts)||find(values(this.params),propEq("id",id))||opts.inherit&&this.parent&&this.parent.parameter(id)},StateObject.prototype.toString=function(){return this.fqn()},StateObject.isStateClass=function(stateDecl){return isFunction(stateDecl)&&!0===stateDecl.__uiRouterState},StateObject.isState=function(obj){return isObject(obj.__stateObjectCache)},StateObject}(),StateMatcher=function(){function StateMatcher(_states){this._states=_states}return StateMatcher.prototype.isRelative=function(stateName){return 0===(stateName=stateName||"").indexOf(".")||0===stateName.indexOf("^")},StateMatcher.prototype.find=function(stateOrName,base,matchGlob){if(void 0===matchGlob&&(matchGlob=!0),stateOrName||""===stateOrName){var isStr=isString(stateOrName),name=isStr?stateOrName:stateOrName.name;this.isRelative(name)&&(name=this.resolvePath(name,base));var state=this._states[name];if(state&&(isStr||!(isStr||state!==stateOrName&&state.self!==stateOrName)))return state;if(isStr&&matchGlob){var matches=values(this._states).filter(function(_state){return _state.__stateObjectCache.nameGlob&&_state.__stateObjectCache.nameGlob.matches(name)});return matches.length>1&&console.log("stateMatcher.find: Found multiple matches for "+name+" using glob: ",matches.map(function(match){return match.name})),matches[0]}}},StateMatcher.prototype.resolvePath=function(name,base){if(!base)throw new Error("No reference point given for path '"+name+"'");for(var baseState=this.find(base),splitName=name.split("."),pathLength=splitName.length,i=0,current=baseState;i<pathLength;i++)if(""!==splitName[i]||0!==i){if("^"!==splitName[i])break;if(!current.parent)throw new Error("Path '"+name+"' not valid for state '"+baseState.name+"'");current=current.parent}else current=baseState;var relName=splitName.slice(i).join(".");return current.name+(current.name&&relName?".":"")+relName},StateMatcher}(),StateQueueManager=function(){function StateQueueManager(router,states,builder,listeners){this.router=router,this.states=states,this.builder=builder,this.listeners=listeners,this.queue=[]}return StateQueueManager.prototype.dispose=function(){this.queue=[]},StateQueueManager.prototype.register=function(stateDecl){var queue=this.queue,state=StateObject.create(stateDecl),name=state.name;if(!isString(name))throw new Error("State must have a valid name");if(this.states.hasOwnProperty(name)||inArray(queue.map(prop("name")),name))throw new Error("State '"+name+"' is already defined");return queue.push(state),this.flush(),state},StateQueueManager.prototype.flush=function(){for(var _this=this,queue=this.queue,states=this.states,builder=this.builder,registered=[],orphans=[],previousQueueLength={},getState=function(name){return _this.states.hasOwnProperty(name)&&_this.states[name]},notifyListeners=function(){registered.length&&_this.listeners.forEach(function(listener){return listener("registered",registered.map(function(s){return s.self}))})};queue.length>0;){var state=queue.shift(),name_1=state.name,result=builder.build(state),orphanIdx=orphans.indexOf(state);if(result){var existingState=getState(name_1);if(existingState&&existingState.name===name_1)throw new Error("State '"+name_1+"' is already defined");var existingFutureState=getState(name_1+".**");existingFutureState&&this.router.stateRegistry.deregister(existingFutureState),states[name_1]=state,this.attachRoute(state),orphanIdx>=0&&orphans.splice(orphanIdx,1),registered.push(state)}else{var prev=previousQueueLength[name_1];if(previousQueueLength[name_1]=queue.length,orphanIdx>=0&&prev===queue.length)return queue.push(state),notifyListeners(),states;orphanIdx<0&&orphans.push(state),queue.push(state)}}return notifyListeners(),states},StateQueueManager.prototype.attachRoute=function(state){if(!state.abstract&&state.url){var rulesApi=this.router.urlService.rules;rulesApi.rule(rulesApi.urlRuleFactory.create(state))}},StateQueueManager}(),StateRegistry=function(){function StateRegistry(router){this.router=router,this.states={},this.listeners=[],this.matcher=new StateMatcher(this.states),this.builder=new StateBuilder(this.matcher,router.urlMatcherFactory),this.stateQueue=new StateQueueManager(router,this.states,this.builder,this.listeners),this._registerRoot()}return StateRegistry.prototype._registerRoot=function(){(this._root=this.stateQueue.register({name:"",url:"^",views:null,params:{"#":{value:null,type:"hash",dynamic:!0}},abstract:!0})).navigable=null},StateRegistry.prototype.dispose=function(){var _this=this;this.stateQueue.dispose(),this.listeners=[],this.get().forEach(function(state){return _this.get(state)&&_this.deregister(state)})},StateRegistry.prototype.onStatesChanged=function(listener){return this.listeners.push(listener),function(){removeFrom(this.listeners)(listener)}.bind(this)},StateRegistry.prototype.root=function(){return this._root},StateRegistry.prototype.register=function(stateDefinition){return this.stateQueue.register(stateDefinition)},StateRegistry.prototype._deregisterTree=function(state){var _this=this,all$$1=this.get().map(function(s){return s.$$state()}),getChildren=function(states){var _children=all$$1.filter(function(s){return-1!==states.indexOf(s.parent)});return 0===_children.length?_children:_children.concat(getChildren(_children))},children=getChildren([state]),deregistered=[state].concat(children).reverse();return deregistered.forEach(function(_state){var rulesApi=_this.router.urlService.rules;rulesApi.rules().filter(propEq("state",_state)).forEach(function(rule){return rulesApi.removeRule(rule)}),delete _this.states[_state.name]}),deregistered},StateRegistry.prototype.deregister=function(stateOrName){var _state=this.get(stateOrName);if(!_state)throw new Error("Can't deregister state; not found: "+stateOrName);var deregisteredStates=this._deregisterTree(_state.$$state());return this.listeners.forEach(function(listener){return listener("deregistered",deregisteredStates.map(function(s){return s.self}))}),deregisteredStates},StateRegistry.prototype.get=function(stateOrName,base){var _this=this;if(0===arguments.length)return Object.keys(this.states).map(function(name){return _this.states[name].self});var found=this.matcher.find(stateOrName,base);return found&&found.self||null},StateRegistry.prototype.decorator=function(name,func){return this.builder.builder(name,func)},StateRegistry}();!function(TransitionHookPhase){TransitionHookPhase[TransitionHookPhase.CREATE=0]="CREATE",TransitionHookPhase[TransitionHookPhase.BEFORE=1]="BEFORE",TransitionHookPhase[TransitionHookPhase.RUN=2]="RUN",TransitionHookPhase[TransitionHookPhase.SUCCESS=3]="SUCCESS",TransitionHookPhase[TransitionHookPhase.ERROR=4]="ERROR"}(exports.TransitionHookPhase||(exports.TransitionHookPhase={})),function(TransitionHookScope){TransitionHookScope[TransitionHookScope.TRANSITION=0]="TRANSITION",TransitionHookScope[TransitionHookScope.STATE=1]="STATE"}(exports.TransitionHookScope||(exports.TransitionHookScope={}));var defaultRuleSortFn,defaultOptions={current:noop,transition:null,traceData:{},bind:null},TransitionHook=function(){function TransitionHook(transition,stateContext,registeredHook,options){var _this=this;this.transition=transition,this.stateContext=stateContext,this.registeredHook=registeredHook,this.options=options,this.isSuperseded=function(){return _this.type.hookPhase===exports.TransitionHookPhase.RUN&&!_this.options.transition.isActive()},this.options=defaults(options,defaultOptions),this.type=registeredHook.eventType}return TransitionHook.chain=function(hooks,waitFor){return hooks.reduce(function(prev,nextHook){return prev.then(function(){return nextHook.invokeHook()})},waitFor||services.$q.when())},TransitionHook.invokeHooks=function(hooks,doneCallback){for(var idx=0;idx<hooks.length;idx++){var hookResult=hooks[idx].invokeHook();if(isPromise(hookResult)){var remainingHooks=hooks.slice(idx+1);return TransitionHook.chain(remainingHooks,hookResult).then(doneCallback)}}return doneCallback()},TransitionHook.runAllHooks=function(hooks){hooks.forEach(function(hook){return hook.invokeHook()})},TransitionHook.prototype.logError=function(err){this.transition.router.stateService.defaultErrorHandler()(err)},TransitionHook.prototype.invokeHook=function(){var _this=this,hook=this.registeredHook;if(!hook._deregistered){var notCurrent=this.getNotCurrentRejection();if(notCurrent)return notCurrent;var options=this.options;trace.traceHookInvocation(this,this.transition,options);var handleError=function(err){return hook.eventType.getErrorHandler(_this)(err)},handleResult=function(result){return hook.eventType.getResultHandler(_this)(result)};try{var result=hook.callback.call(options.bind,_this.transition,_this.stateContext);return!this.type.synchronous&&isPromise(result)?result.catch(function(err){return Rejection.normalize(err).toPromise()}).then(handleResult,handleError):handleResult(result)}catch(err){return handleError(Rejection.normalize(err))}finally{hook.invokeLimit&&++hook.invokeCount>=hook.invokeLimit&&hook.deregister()}}},TransitionHook.prototype.handleHookResult=function(result){var _this=this,notCurrent=this.getNotCurrentRejection();if(notCurrent)return notCurrent;if(isPromise(result))return result.then(function(val$$1){return _this.handleHookResult(val$$1)});if(trace.traceHookResult(result,this.transition,this.options),!1===result)return Rejection.aborted("Hook aborted transition").toPromise();return is(TargetState)(result)?Rejection.redirected(result).toPromise():void 0},TransitionHook.prototype.getNotCurrentRejection=function(){var router=this.transition.router;return router._disposed?Rejection.aborted("UIRouter instance #"+router.$id+" has been stopped (disposed)").toPromise():this.transition._aborted?Rejection.aborted().toPromise():this.isSuperseded()?Rejection.superseded(this.options.current()).toPromise():void 0},TransitionHook.prototype.toString=function(){var options=this.options,registeredHook=this.registeredHook;return(parse("traceData.hookType")(options)||"internal")+" context: "+(parse("traceData.context.state.name")(options)||parse("traceData.context")(options)||"unknown")+", "+maxLength(200,fnToString(registeredHook.callback))},TransitionHook.HANDLE_RESULT=function(hook){return function(result){return hook.handleHookResult(result)}},TransitionHook.LOG_REJECTED_RESULT=function(hook){return function(result){isPromise(result)&&result.catch(function(err){return hook.logError(Rejection.normalize(err))})}},TransitionHook.LOG_ERROR=function(hook){return function(error){return hook.logError(error)}},TransitionHook.REJECT_ERROR=function(hook){return function(error){return silentRejection(error)}},TransitionHook.THROW_ERROR=function(hook){return function(error){throw error}},TransitionHook}(),RegisteredHook=function(){function RegisteredHook(tranSvc,eventType,callback,matchCriteria,removeHookFromRegistry,options){void 0===options&&(options={}),this.tranSvc=tranSvc,this.eventType=eventType,this.callback=callback,this.matchCriteria=matchCriteria,this.removeHookFromRegistry=removeHookFromRegistry,this.invokeCount=0,this._deregistered=!1,this.priority=options.priority||0,this.bind=options.bind||null,this.invokeLimit=options.invokeLimit}return RegisteredHook.prototype._matchingNodes=function(nodes,criterion){if(!0===criterion)return nodes;var matching=nodes.filter(function(node){return matchState(node.state,criterion)});return matching.length?matching:null},RegisteredHook.prototype._getDefaultMatchCriteria=function(){return mapObj(this.tranSvc._pluginapi._getPathTypes(),function(){return!0})},RegisteredHook.prototype._getMatchingNodes=function(treeChanges){var _this=this,criteria=extend(this._getDefaultMatchCriteria(),this.matchCriteria);return values(this.tranSvc._pluginapi._getPathTypes()).reduce(function(mn,pathtype){var isStateHook=pathtype.scope===exports.TransitionHookScope.STATE,path=treeChanges[pathtype.name]||[],nodes=isStateHook?path:[tail(path)];return mn[pathtype.name]=_this._matchingNodes(nodes,criteria[pathtype.name]),mn},{})},RegisteredHook.prototype.matches=function(treeChanges){var matches=this._getMatchingNodes(treeChanges);return values(matches).every(identity)?matches:null},RegisteredHook.prototype.deregister=function(){this.removeHookFromRegistry(this),this._deregistered=!0},RegisteredHook}(),HookBuilder=function(){function HookBuilder(transition){this.transition=transition}return HookBuilder.prototype.buildHooksForPhase=function(phase){var _this=this;return this.transition.router.transitionService._pluginapi._getEvents(phase).map(function(type){return _this.buildHooks(type)}).reduce(unnestR,[]).filter(identity)},HookBuilder.prototype.buildHooks=function(hookType){var transition=this.transition,treeChanges=transition.treeChanges(),matchingHooks=this.getMatchingHooks(hookType,treeChanges);if(!matchingHooks)return[];var baseHookOptions={transition:transition,current:transition.options().current};return matchingHooks.map(function(hook){return hook.matches(treeChanges)[hookType.criteriaMatchPath.name].map(function(node){var _options=extend({bind:hook.bind,traceData:{hookType:hookType.name,context:node}},baseHookOptions),state=hookType.criteriaMatchPath.scope===exports.TransitionHookScope.STATE?node.state.self:null,transitionHook=new TransitionHook(transition,state,hook,_options);return{hook:hook,node:node,transitionHook:transitionHook}})}).reduce(unnestR,[]).sort(function(reverseDepthSort){return void 0===reverseDepthSort&&(reverseDepthSort=!1),function(l,r){var factor=reverseDepthSort?-1:1,depthDelta=(l.node.state.path.length-r.node.state.path.length)*factor;return 0!==depthDelta?depthDelta:r.hook.priority-l.hook.priority}}(hookType.reverseSort)).map(function(tuple){return tuple.transitionHook})},HookBuilder.prototype.getMatchingHooks=function(hookType,treeChanges){var isCreate=hookType.hookPhase===exports.TransitionHookPhase.CREATE,$transitions=this.transition.router.transitionService;return(isCreate?[$transitions]:[this.transition,$transitions]).map(function(reg){return reg.getHooks(hookType.name)}).filter(assertPredicate(isArray,"broken event named: "+hookType.name)).reduce(unnestR,[]).filter(function(hook){return hook.matches(treeChanges)})},HookBuilder}(),stateSelf=prop("self"),Transition=function(){function Transition(fromPath,targetState,router){var _this=this;if(this._deferred=services.$q.defer(),this.promise=this._deferred.promise,this._registeredHooks={},this._hookBuilder=new HookBuilder(this),this.isActive=function(){return _this.router.globals.transition===_this},this.router=router,this._targetState=targetState,!targetState.valid())throw new Error(targetState.error());this._options=extend({current:val(this)},targetState.options()),this.$id=router.transitionService._transitionCount++;var toPath=PathUtils.buildToPath(fromPath,targetState);this._treeChanges=PathUtils.treeChanges(fromPath,toPath,this._options.reloadState),this.createTransitionHookRegFns();var onCreateHooks=this._hookBuilder.buildHooksForPhase(exports.TransitionHookPhase.CREATE);TransitionHook.invokeHooks(onCreateHooks,function(){return null}),this.applyViewConfigs(router)}return Transition.prototype.onBefore=function(criteria,callback,options){},Transition.prototype.onStart=function(criteria,callback,options){},Transition.prototype.onExit=function(criteria,callback,options){},Transition.prototype.onRetain=function(criteria,callback,options){},Transition.prototype.onEnter=function(criteria,callback,options){},Transition.prototype.onFinish=function(criteria,callback,options){},Transition.prototype.onSuccess=function(criteria,callback,options){},Transition.prototype.onError=function(criteria,callback,options){},Transition.prototype.createTransitionHookRegFns=function(){var _this=this;this.router.transitionService._pluginapi._getEvents().filter(function(type){return type.hookPhase!==exports.TransitionHookPhase.CREATE}).forEach(function(type){return makeEvent(_this,_this.router.transitionService,type)})},Transition.prototype.getHooks=function(hookName){return this._registeredHooks[hookName]},Transition.prototype.applyViewConfigs=function(router){var enteringStates=this._treeChanges.entering.map(function(node){return node.state});PathUtils.applyViewConfigs(router.transitionService.$view,this._treeChanges.to,enteringStates)},Transition.prototype.$from=function(){return tail(this._treeChanges.from).state},Transition.prototype.$to=function(){return tail(this._treeChanges.to).state},Transition.prototype.from=function(){return this.$from().self},Transition.prototype.to=function(){return this.$to().self},Transition.prototype.targetState=function(){return this._targetState},Transition.prototype.is=function(compare){return compare instanceof Transition?this.is({to:compare.$to().name,from:compare.$from().name}):!(compare.to&&!matchState(this.$to(),compare.to)||compare.from&&!matchState(this.$from(),compare.from))},Transition.prototype.params=function(pathname){return void 0===pathname&&(pathname="to"),Object.freeze(this._treeChanges[pathname].map(prop("paramValues")).reduce(mergeR,{}))},Transition.prototype.paramsChanged=function(){var fromParams=this.params("from"),toParams=this.params("to"),allParamDescriptors=[].concat(this._treeChanges.to).concat(this._treeChanges.from).map(function(pathNode){return pathNode.paramSchema}).reduce(flattenR,[]).reduce(uniqR,[]);return Param.changed(allParamDescriptors,fromParams,toParams).reduce(function(changedValues,descriptor){return changedValues[descriptor.id]=toParams[descriptor.id],changedValues},{})},Transition.prototype.injector=function(state,pathName){void 0===pathName&&(pathName="to");var path=this._treeChanges[pathName];return state&&(path=PathUtils.subPath(path,function(node){return node.state===state||node.state.name===state})),new ResolveContext(path).injector()},Transition.prototype.getResolveTokens=function(pathname){return void 0===pathname&&(pathname="to"),new ResolveContext(this._treeChanges[pathname]).getTokens()},Transition.prototype.addResolvable=function(resolvable,state){void 0===state&&(state=""),resolvable=is(Resolvable)(resolvable)?resolvable:new Resolvable(resolvable);var stateName="string"==typeof state?state:state.name,topath=this._treeChanges.to,targetNode=find(topath,function(node){return node.state.name===stateName});new ResolveContext(topath).addResolvables([resolvable],targetNode.state)},Transition.prototype.redirectedFrom=function(){return this._options.redirectedFrom||null},Transition.prototype.originalTransition=function(){var rf=this.redirectedFrom();return rf&&rf.originalTransition()||this},Transition.prototype.options=function(){return this._options},Transition.prototype.entering=function(){return map(this._treeChanges.entering,prop("state")).map(stateSelf)},Transition.prototype.exiting=function(){return map(this._treeChanges.exiting,prop("state")).map(stateSelf).reverse()},Transition.prototype.retained=function(){return map(this._treeChanges.retained,prop("state")).map(stateSelf)},Transition.prototype.views=function(pathname,state){void 0===pathname&&(pathname="entering");var path=this._treeChanges[pathname];return(path=state?path.filter(propEq("state",state)):path).map(prop("views")).filter(identity).reduce(unnestR,[])},Transition.prototype.treeChanges=function(pathname){return pathname?this._treeChanges[pathname]:this._treeChanges},Transition.prototype.redirect=function(targetState){for(var redirects=1,trans=this;null!=(trans=trans.redirectedFrom());)if(++redirects>20)throw new Error("Too many consecutive Transition redirects (20+)");var redirectOpts={redirectedFrom:this,source:"redirect"};"url"===this.options().source&&!1!==targetState.options().location&&(redirectOpts.location="replace");var newOptions=extend({},this.options(),targetState.options(),redirectOpts);targetState=targetState.withOptions(newOptions,!0);var newTransition=this.router.transitionService.create(this._treeChanges.from,targetState),originalEnteringNodes=this._treeChanges.entering,redirectEnteringNodes=newTransition._treeChanges.entering;return PathUtils.matching(redirectEnteringNodes,originalEnteringNodes,PathUtils.nonDynamicParams).filter(not(function(reloadState){return function(node){return reloadState&&node.state.includes[reloadState.name]}}(targetState.options().reloadState))).forEach(function(node,idx){node.resolvables=originalEnteringNodes[idx].resolvables}),newTransition},Transition.prototype._changedParams=function(){var tc=this._treeChanges;if(!this._options.reload&&!tc.exiting.length&&!tc.entering.length&&tc.to.length===tc.from.length){if(!arrayTuples(tc.to,tc.from).map(function(tuple){return tuple[0].state!==tuple[1].state}).reduce(anyTrueR,!1)){var nodeSchemas=tc.to.map(function(node){return node.paramSchema}),_a=[tc.to,tc.from].map(function(path){return path.map(function(x){return x.paramValues})});return arrayTuples(nodeSchemas,_a[0],_a[1]).map(function(_a){var schema=_a[0],toVals=_a[1],fromVals=_a[2];return Param.changed(schema,toVals,fromVals)}).reduce(unnestR,[])}}},Transition.prototype.dynamic=function(){var changes=this._changedParams();return!!changes&&changes.map(function(x){return x.dynamic}).reduce(anyTrueR,!1)},Transition.prototype.ignored=function(){return!!this._ignoredReason()},Transition.prototype._ignoredReason=function(){var pending=this.router.globals.transition,reloadState=this._options.reloadState,same=function(pathA,pathB){if(pathA.length!==pathB.length)return!1;var matching=PathUtils.matching(pathA,pathB);return pathA.length===matching.filter(function(node){return!reloadState||!node.state.includes[reloadState.name]}).length},newTC=this.treeChanges(),pendTC=pending&&pending.treeChanges();return pendTC&&same(pendTC.to,newTC.to)&&same(pendTC.exiting,newTC.exiting)?"SameAsPending":0===newTC.exiting.length&&0===newTC.entering.length&&same(newTC.from,newTC.to)?"SameAsCurrent":void 0},Transition.prototype.run=function(){var _this=this,runAllHooks=TransitionHook.runAllHooks,getHooksFor=function(phase){return _this._hookBuilder.buildHooksForPhase(phase)},allBeforeHooks=getHooksFor(exports.TransitionHookPhase.BEFORE);return TransitionHook.invokeHooks(allBeforeHooks,function(){var globals=_this.router.globals;return globals.lastStartedTransitionId=_this.$id,globals.transition=_this,globals.transitionHistory.enqueue(_this),trace.traceTransitionStart(_this),services.$q.when(void 0)}).then(function(){var allRunHooks=getHooksFor(exports.TransitionHookPhase.RUN);return TransitionHook.invokeHooks(allRunHooks,function(){return services.$q.when(void 0)})}).then(function(){trace.traceSuccess(_this.$to(),_this),_this.success=!0,_this._deferred.resolve(_this.to()),runAllHooks(getHooksFor(exports.TransitionHookPhase.SUCCESS))},function(reason){trace.traceError(reason,_this),_this.success=!1,_this._deferred.reject(reason),_this._error=reason,runAllHooks(getHooksFor(exports.TransitionHookPhase.ERROR))}),this.promise},Transition.prototype.valid=function(){return!this.error()||void 0!==this.success},Transition.prototype.abort=function(){isUndefined(this.success)&&(this._aborted=!0)},Transition.prototype.error=function(){var state=this.$to();if(state.self.abstract)return Rejection.invalid("Cannot transition to abstract state '"+state.name+"'");var paramDefs=state.parameters(),values$$1=this.params(),invalidParams=paramDefs.filter(function(param){return!param.validates(values$$1[param.id])});if(invalidParams.length){var invalidValues=invalidParams.map(function(param){return"["+param.id+":"+stringify(values$$1[param.id])+"]"}).join(", "),detail="The following parameter values are not valid for state '"+state.name+"': "+invalidValues;return Rejection.invalid(detail)}return!1===this.success?this._error:void 0},Transition.prototype.toString=function(){var fromStateOrName=this.from(),toStateOrName=this.to(),avoidEmptyHash=function(params){return null!==params["#"]&&void 0!==params["#"]?params:omit(params,["#"])};return"Transition#"+this.$id+"( '"+(isObject(fromStateOrName)?fromStateOrName.name:fromStateOrName)+"'"+stringify(avoidEmptyHash(this._treeChanges.from.map(prop("paramValues")).reduce(mergeR,{})))+" -> "+(this.valid()?"":"(X) ")+"'"+(isObject(toStateOrName)?toStateOrName.name:toStateOrName)+"'"+stringify(avoidEmptyHash(this.params()))+" )"},Transition.diToken=Transition,Transition}(),splitOnSlash=splitOnDelim("/"),defaultConfig={state:{params:{}},strict:!0,caseInsensitive:!0},UrlMatcher=function(){function UrlMatcher(pattern$$1,paramTypes,paramFactory,config){var _this=this;this._cache={path:[this]},this._children=[],this._params=[],this._segments=[],this._compiled=[],this.config=config=defaults(config,defaultConfig),this.pattern=pattern$$1;for(var matchArray,details,segment,placeholder=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:\s*((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,searchPlaceholder=/([:]?)([\w\[\].-]+)|\{([\w\[\].-]+)(?:\:\s*((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,patterns=[],last=0,checkParamErrors=function(id){if(!UrlMatcher.nameValidator.test(id))throw new Error("Invalid parameter name '"+id+"' in pattern '"+pattern$$1+"'");if(find(_this._params,propEq("id",id)))throw new Error("Duplicate parameter name '"+id+"' in pattern '"+pattern$$1+"'")},matchDetails=function(m,isSearch){var id=m[2]||m[3],regexp=isSearch?m[4]:m[4]||("*"===m[1]?"[\\s\\S]*":null);return{id:id,regexp:regexp,segment:pattern$$1.substring(last,m.index),type:regexp?paramTypes.type(regexp)||function(str){return inherit(paramTypes.type(isSearch?"query":"path"),{pattern:new RegExp(str,_this.config.caseInsensitive?"i":void 0)})}(regexp):null}};(matchArray=placeholder.exec(pattern$$1))&&!((details=matchDetails(matchArray,!1)).segment.indexOf("?")>=0);)checkParamErrors(details.id),this._params.push(paramFactory.fromPath(details.id,details.type,config.state)),this._segments.push(details.segment),patterns.push([details.segment,tail(this._params)]),last=placeholder.lastIndex;var i=(segment=pattern$$1.substring(last)).indexOf("?");if(i>=0){var search=segment.substring(i);if(segment=segment.substring(0,i),search.length>0)for(last=0;matchArray=searchPlaceholder.exec(search);)checkParamErrors((details=matchDetails(matchArray,!0)).id),this._params.push(paramFactory.fromSearch(details.id,details.type,config.state)),last=placeholder.lastIndex}this._segments.push(segment),this._compiled=patterns.map(function(_pattern){return quoteRegExp.apply(null,_pattern)}).concat(quoteRegExp(segment))}return UrlMatcher.encodeDashes=function(str){return encodeURIComponent(str).replace(/-/g,function(c){return"%5C%"+c.charCodeAt(0).toString(16).toUpperCase()})},UrlMatcher.pathSegmentsAndParams=function(matcher){return arrayTuples(matcher._segments,matcher._params.filter(function(p){return p.location===exports.DefType.PATH}).concat(void 0)).reduce(unnestR,[]).filter(function(x){return""!==x&&isDefined(x)})},UrlMatcher.queryParams=function(matcher){return matcher._params.filter(function(p){return p.location===exports.DefType.SEARCH})},UrlMatcher.compare=function(a,b){var weights=function(matcher){return matcher._cache.weights=matcher._cache.weights||function(matcher){return matcher._cache.segments=matcher._cache.segments||matcher._cache.path.map(UrlMatcher.pathSegmentsAndParams).reduce(unnestR,[]).reduce(joinNeighborsR,[]).map(function(x){return isString(x)?splitOnSlash(x):x}).reduce(unnestR,[])}(matcher).map(function(segment){return"/"===segment?1:isString(segment)?2:segment instanceof Param?3:void 0})},weightsA=weights(a),weightsB=weights(b);!function(l,r,padVal){for(var len=Math.max(l.length,r.length);l.length<len;)l.push(padVal);for(;r.length<len;)r.push(padVal)}(weightsA,weightsB,0);var cmp,i,_pairs=arrayTuples(weightsA,weightsB);for(i=0;i<_pairs.length;i++)if(0!=(cmp=_pairs[i][0]-_pairs[i][1]))return cmp;return 0},UrlMatcher.prototype.append=function(url){return this._children.push(url),url._cache={path:this._cache.path.concat(url),parent:this,pattern:null},url},UrlMatcher.prototype.isRoot=function(){return this._cache.path[0]===this},UrlMatcher.prototype.toString=function(){return this.pattern},UrlMatcher.prototype.exec=function(path,search,hash,options){var _this=this;void 0===search&&(search={}),void 0===options&&(options={});var match=function(obj,_prop,fn){return obj[_prop]=obj[_prop]||fn()}(this._cache,"pattern",function(){return new RegExp(["^",unnest(_this._cache.path.map(prop("_compiled"))).join(""),!1===_this.config.strict?"/?":"","$"].join(""),_this.config.caseInsensitive?"i":void 0)}).exec(path);if(!match)return null;var allParams=this.parameters(),pathParams=allParams.filter(function(param){return!param.isSearch()}),searchParams=allParams.filter(function(param){return param.isSearch()}),nPathSegments=this._cache.path.map(function(urlm){return urlm._segments.length-1}).reduce(function(a,x){return a+x}),values$$1={};if(nPathSegments!==match.length-1)throw new Error("Unbalanced capture group in route '"+this.pattern+"'");for(var i=0;i<nPathSegments;i++){for(var param=pathParams[i],value=match[i+1],j=0;j<param.replace.length;j++)param.replace[j].from===value&&(value=param.replace[j].to);value&&!0===param.array&&(value=function(paramVal){var reverseString=function(str){return str.split("").reverse().join("")};return map(map(reverseString(paramVal).split(/-(?!\\)/),reverseString),function(str){return str.replace(/\\-/g,"-")}).reverse()}(value)),isDefined(value)&&(value=param.type.decode(value)),values$$1[param.id]=param.value(value)}return searchParams.forEach(function(param){for(var value=search[param.id],j=0;j<param.replace.length;j++)param.replace[j].from===value&&(value=param.replace[j].to);isDefined(value)&&(value=param.type.decode(value)),values$$1[param.id]=param.value(value)}),hash&&(values$$1["#"]=hash),values$$1},UrlMatcher.prototype.parameters=function(opts){return void 0===opts&&(opts={}),!1===opts.inherit?this._params:unnest(this._cache.path.map(function(matcher){return matcher._params}))},UrlMatcher.prototype.parameter=function(id,opts){var _this=this;void 0===opts&&(opts={});var parent=this._cache.parent;return function(){for(var _i=0,_a=_this._params;_i<_a.length;_i++){var param=_a[_i];if(param.id===id)return param}}()||!1!==opts.inherit&&parent&&parent.parameter(id,opts)||null},UrlMatcher.prototype.validates=function(params){params=params||{};return this.parameters().filter(function(paramDef){return params.hasOwnProperty(paramDef.id)}).map(function(paramDef){return function(param,val$$1){return!param||param.validates(val$$1)}(paramDef,params[paramDef.id])}).reduce(allTrueR,!0)},UrlMatcher.prototype.format=function(values$$1){function getDetails(param){var value=param.value(values$$1[param.id]),isValid=param.validates(value),isDefaultValue=param.isDefaultValue(value);return{param:param,value:value,isValid:isValid,isDefaultValue:isDefaultValue,squash:!!isDefaultValue&&param.squash,encoded:param.type.encode(value)}}void 0===values$$1&&(values$$1={});var urlMatchers=this._cache.path,pathSegmentsAndParams=urlMatchers.map(UrlMatcher.pathSegmentsAndParams).reduce(unnestR,[]).map(function(x){return isString(x)?x:getDetails(x)}),queryParams=urlMatchers.map(UrlMatcher.queryParams).reduce(unnestR,[]).map(getDetails);if(pathSegmentsAndParams.concat(queryParams).filter(function(param){return!1===param.isValid}).length)return null;var pathString=pathSegmentsAndParams.reduce(function(acc,x){if(isString(x))return acc+x;var squash=x.squash,encoded=x.encoded,param=x.param;return!0===squash?acc.match(/\/$/)?acc.slice(0,-1):acc:isString(squash)?acc+squash:!1!==squash?acc:null==encoded?acc:isArray(encoded)?acc+map(encoded,UrlMatcher.encodeDashes).join("-"):param.raw?acc+encoded:acc+encodeURIComponent(encoded)},""),queryString=queryParams.map(function(paramDetails){var param=paramDetails.param,squash=paramDetails.squash,encoded=paramDetails.encoded,isDefaultValue=paramDetails.isDefaultValue;if(!(null==encoded||isDefaultValue&&!1!==squash)&&(isArray(encoded)||(encoded=[encoded]),0!==encoded.length))return param.raw||(encoded=map(encoded,encodeURIComponent)),encoded.map(function(val$$1){return param.id+"="+val$$1})}).filter(identity).reduce(unnestR,[]).join("&");return pathString+(queryString?"?"+queryString:"")+(values$$1["#"]?"#"+values$$1["#"]:"")},UrlMatcher.nameValidator=/^\w+([-.]+\w+)*(?:\[\])?$/,UrlMatcher}(),__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},ParamFactory=function(){function ParamFactory(router){this.router=router}return ParamFactory.prototype.fromConfig=function(id,type,state){return new Param(id,type,exports.DefType.CONFIG,this.router.urlService.config,state)},ParamFactory.prototype.fromPath=function(id,type,state){return new Param(id,type,exports.DefType.PATH,this.router.urlService.config,state)},ParamFactory.prototype.fromSearch=function(id,type,state){return new Param(id,type,exports.DefType.SEARCH,this.router.urlService.config,state)},ParamFactory}(),UrlMatcherFactory=function(){function UrlMatcherFactory(router){var _this=this;this.router=router,this.paramFactory=new ParamFactory(this.router),this.caseInsensitive=function(value){return _this.router.urlService.config.caseInsensitive(value)},this.defaultSquashPolicy=function(value){return _this.router.urlService.config.defaultSquashPolicy(value)},this.strictMode=function(value){return _this.router.urlService.config.strictMode(value)},this.type=function(name,definition,definitionFn){return _this.router.urlService.config.type(name,definition,definitionFn)||_this},extend(this,{UrlMatcher:UrlMatcher,Param:Param})}return UrlMatcherFactory.prototype.compile=function(pattern$$1,config){var urlConfig=this.router.urlService.config,params=config&&!config.state&&config.params;config=params?__assign({state:{params:params}},config):config;var globalConfig={strict:urlConfig._isStrictMode,caseInsensitive:urlConfig._isCaseInsensitive};return new UrlMatcher(pattern$$1,urlConfig.paramTypes,this.paramFactory,extend(globalConfig,config))},UrlMatcherFactory.prototype.isMatcher=function(object){if(!isObject(object))return!1;var result=!0;return forEach(UrlMatcher.prototype,function(val$$1,name){isFunction(val$$1)&&(result=result&&isDefined(object[name])&&isFunction(object[name]))}),result},UrlMatcherFactory.prototype.$get=function(){var urlConfig=this.router.urlService.config;return urlConfig.paramTypes.enqueue=!1,urlConfig.paramTypes._flushTypeQueue(),this},UrlMatcherFactory}(),UrlRuleFactory=function(){function UrlRuleFactory(router){this.router=router}return UrlRuleFactory.prototype.compile=function(str){return this.router.urlMatcherFactory.compile(str)},UrlRuleFactory.prototype.create=function(what,handler){var _this=this,isState=StateObject.isState,makeRule=pattern([[isString,function(_what){return makeRule(_this.compile(_what))}],[is(UrlMatcher),function(_what){return _this.fromUrlMatcher(_what,handler)}],[isState,function(_what){return _this.fromState(_what,_this.router)}],[is(RegExp),function(_what){return _this.fromRegExp(_what,handler)}],[isFunction,function(_what){return new BaseUrlRule(_what,handler)}]]),rule=makeRule(what);if(!rule)throw new Error("invalid 'what' in when()");return rule},UrlRuleFactory.prototype.fromUrlMatcher=function(urlMatcher,handler){var _handler=handler;isString(handler)&&(handler=this.router.urlMatcherFactory.compile(handler)),is(UrlMatcher)(handler)&&(_handler=function(match){return handler.format(match)});var details={urlMatcher:urlMatcher,matchPriority:function(params){var optional=urlMatcher.parameters().filter(function(param){return param.isOptional});return optional.length?optional.filter(function(param){return params[param.id]}).length/optional.length:1e-6},type:"URLMATCHER"};return extend(new BaseUrlRule(function(url){var params=urlMatcher.exec(url.path,url.search,url.hash);return urlMatcher.validates(params)&&params},_handler),details)},UrlRuleFactory.prototype.fromState=function(state,router){var details={state:state,type:"STATE"};return extend(this.fromUrlMatcher(state.url,function(match){var $state=router.stateService,globals=router.globals;$state.href(state,match)!==$state.href(globals.current,globals.params)&&$state.transitionTo(state,match,{inherit:!0,source:"url"})}),details)},UrlRuleFactory.prototype.fromRegExp=function(regexp,handler){if(regexp.global||regexp.sticky)throw new Error("Rule RegExp must not be global or sticky");var _handler=isString(handler)?function(match){return handler.replace(/\$(\$|\d{1,2})/,function(m,what){return match["$"===what?0:Number(what)]})}:handler,details={regexp:regexp,type:"REGEXP"};return extend(new BaseUrlRule(function(url){return regexp.exec(url.path)},_handler),details)},UrlRuleFactory.isUrlRule=function(obj){return obj&&["type","match","handler"].every(function(key){return isDefined(obj[key])})},UrlRuleFactory}(),BaseUrlRule=function(){return function(match,handler){var _this=this;this.match=match,this.type="RAW",this.matchPriority=function(match){return 0-_this.$id},this.handler=handler||identity}}(),UrlRouter=function(){function UrlRouter(router){var _this=this;this.router=router,this.sync=function(evt){return _this.router.urlService.sync(evt)},this.listen=function(enabled){return _this.router.urlService.listen(enabled)},this.deferIntercept=function(defer){return _this.router.urlService.deferIntercept(defer)},this.match=function(urlParts){return _this.router.urlService.match(urlParts)},this.initial=function(handler){return _this.router.urlService.rules.initial(handler)},this.otherwise=function(handler){return _this.router.urlService.rules.otherwise(handler)},this.removeRule=function(rule){return _this.router.urlService.rules.removeRule(rule)},this.rule=function(rule){return _this.router.urlService.rules.rule(rule)},this.rules=function(){return _this.router.urlService.rules.rules()},this.sort=function(compareFn){return _this.router.urlService.rules.sort(compareFn)},this.when=function(matcher,handler,options){return _this.router.urlService.rules.when(matcher,handler,options)},this.urlRuleFactory=new UrlRuleFactory(router)}return UrlRouter.prototype.update=function(read){var $url=this.router.locationService;read?this.location=$url.url():$url.url()!==this.location&&$url.url(this.location,!0)},UrlRouter.prototype.push=function(urlMatcher,params,options){var replace=options&&!!options.replace;this.router.urlService.url(urlMatcher.format(params||{}),replace)},UrlRouter.prototype.href=function(urlMatcher,params,options){var url=urlMatcher.format(params);if(null==url)return null;options=options||{absolute:!1};var cfg=this.router.urlService.config,isHtml5=cfg.html5Mode();if(isHtml5||null===url||(url="#"+cfg.hashPrefix()+url),url=function(url,isHtml5,absolute,baseHref){return"/"===baseHref?url:isHtml5?stripLastPathElement(baseHref)+url:absolute?baseHref.slice(1)+url:url}(url,isHtml5,options.absolute,cfg.baseHref()),!options.absolute||!url)return url;var slash=!isHtml5&&url?"/":"",cfgPort=cfg.port(),port=80===cfgPort||443===cfgPort?"":":"+cfgPort;return[cfg.protocol(),"://",cfg.host(),port,slash,url].join("")},Object.defineProperty(UrlRouter.prototype,"interceptDeferred",{get:function(){return this.router.urlService.interceptDeferred},enumerable:!0,configurable:!0}),UrlRouter}(),ViewService=function(){function ViewService(router){var _this=this;this.router=router,this._uiViews=[],this._viewConfigs=[],this._viewConfigFactories={},this._listeners=[],this._pluginapi={_rootViewContext:this._rootViewContext.bind(this),_viewConfigFactory:this._viewConfigFactory.bind(this),_registeredUIView:function(id){return find(_this._uiViews,function(view){return _this.router.$id+"."+view.id===id})},_registeredUIViews:function(){return _this._uiViews},_activeViewConfigs:function(){return _this._viewConfigs},_onSync:function(listener){return _this._listeners.push(listener),function(){return removeFrom(_this._listeners,listener)}}}}return ViewService.normalizeUIViewTarget=function(context,rawViewName){void 0===rawViewName&&(rawViewName="");var viewAtContext=rawViewName.split("@"),uiViewName=viewAtContext[0]||"$default",uiViewContextAnchor=isString(viewAtContext[1])?viewAtContext[1]:"^",relativeViewNameSugar=/^(\^(?:\.\^)*)\.(.*$)/.exec(uiViewName);relativeViewNameSugar&&(uiViewContextAnchor=relativeViewNameSugar[1],uiViewName=relativeViewNameSugar[2]),"!"===uiViewName.charAt(0)&&(uiViewName=uiViewName.substr(1),uiViewContextAnchor="");if(/^(\^(?:\.\^)*)$/.exec(uiViewContextAnchor)){uiViewContextAnchor=uiViewContextAnchor.split(".").reduce(function(anchor,x){return anchor.parent},context).name}else"."===uiViewContextAnchor&&(uiViewContextAnchor=context.name);return{uiViewName:uiViewName,uiViewContextAnchor:uiViewContextAnchor}},ViewService.prototype._rootViewContext=function(context){return this._rootContext=context||this._rootContext},ViewService.prototype._viewConfigFactory=function(viewType,factory){this._viewConfigFactories[viewType]=factory},ViewService.prototype.createViewConfig=function(path,decl){var cfgFactory=this._viewConfigFactories[decl.$type];if(!cfgFactory)throw new Error("ViewService: No view config factory registered for type "+decl.$type);var cfgs=cfgFactory(path,decl);return isArray(cfgs)?cfgs:[cfgs]},ViewService.prototype.deactivateViewConfig=function(viewConfig){trace.traceViewServiceEvent("<- Removing",viewConfig),removeFrom(this._viewConfigs,viewConfig)},ViewService.prototype.activateViewConfig=function(viewConfig){trace.traceViewServiceEvent("-> Registering",viewConfig),this._viewConfigs.push(viewConfig)},ViewService.prototype.sync=function(){var _this=this,uiViewsByFqn=this._uiViews.map(function(uiv){return[uiv.fqn,uiv]}).reduce(applyPairs,{}),depthCompare=curry(function(depthFn,posNeg,left,right){return posNeg*(depthFn(left)-depthFn(right))}),uiViewTuples=this._uiViews.sort(depthCompare(function(uiView){var stateDepth=function(context){return context&&context.parent?stateDepth(context.parent)+1:1};return 1e4*uiView.fqn.split(".").length+stateDepth(uiView.creationContext)},1)).map(function(uiView){var matchingConfigs=_this._viewConfigs.filter(ViewService.matches(uiViewsByFqn,uiView));return matchingConfigs.length>1&&matchingConfigs.sort(depthCompare(function(config){for(var context=config.viewDecl.$context,count=0;++count&&context.parent;)context=context.parent;return count},-1)),{uiView:uiView,viewConfig:matchingConfigs[0]}}),matchedViewConfigs=uiViewTuples.map(function(tuple){return tuple.viewConfig}),unmatchedConfigTuples=this._viewConfigs.filter(function(config){return!inArray(matchedViewConfigs,config)}).map(function(viewConfig){return{uiView:void 0,viewConfig:viewConfig}});uiViewTuples.forEach(function(tuple){-1!==_this._uiViews.indexOf(tuple.uiView)&&tuple.uiView.configUpdated(tuple.viewConfig)});var allTuples=uiViewTuples.concat(unmatchedConfigTuples);this._listeners.forEach(function(cb){return cb(allTuples)}),trace.traceViewSync(allTuples)},ViewService.prototype.registerUIView=function(uiView){trace.traceViewServiceUIViewEvent("-> Registering",uiView);var uiViews=this._uiViews;return uiViews.filter(function(uiv){return uiv.fqn===uiView.fqn&&uiv.$type===uiView.$type}).length&&trace.traceViewServiceUIViewEvent("!!!! duplicate uiView named:",uiView),uiViews.push(uiView),this.sync(),function(){-1!==uiViews.indexOf(uiView)?(trace.traceViewServiceUIViewEvent("<- Deregistering",uiView),removeFrom(uiViews)(uiView)):trace.traceViewServiceUIViewEvent("Tried removing non-registered uiView",uiView)}},ViewService.prototype.available=function(){return this._uiViews.map(prop("fqn"))},ViewService.prototype.active=function(){return this._uiViews.filter(prop("$config")).map(prop("name"))},ViewService.matches=function(uiViewsByFqn,uiView){return function(viewConfig){if(uiView.$type!==viewConfig.viewDecl.$type)return!1;var vc=viewConfig.viewDecl,vcSegments=vc.$uiViewName.split("."),uivSegments=uiView.fqn.split(".");if(!equals(vcSegments,uivSegments.slice(0-vcSegments.length)))return!1;var negOffset=1-vcSegments.length||void 0,fqnToFirstSegment=uivSegments.slice(0,negOffset).join("."),uiViewContext=uiViewsByFqn[fqnToFirstSegment].creationContext;return vc.$uiViewContextAnchor===(uiViewContext&&uiViewContext.name)}},ViewService}(),UIRouterGlobals=function(){function UIRouterGlobals(){this.params=new StateParams,this.lastStartedTransitionId=-1,this.transitionHistory=new Queue([],1),this.successfulTransitions=new Queue([],1)}return UIRouterGlobals.prototype.dispose=function(){this.transitionHistory.clear(),this.successfulTransitions.clear(),this.transition=null},UIRouterGlobals}();defaultRuleSortFn=function(a,b){var cmp=function(a,b){return(b.priority||0)-(a.priority||0)}(a,b);return 0!==cmp?cmp:0!==(cmp=function(a,b){var weights={STATE:4,URLMATCHER:4,REGEXP:3,RAW:2,OTHER:1};return(weights[a.type]||0)-(weights[b.type]||0)}(a,b))?cmp:0!==(cmp=function(a,b){return a.urlMatcher&&b.urlMatcher?UrlMatcher.compare(a.urlMatcher,b.urlMatcher):0}(a,b))?cmp:function(a,b){var useMatchPriority={STATE:!0,URLMATCHER:!0};return useMatchPriority[a.type]&&useMatchPriority[b.type]?0:(a.$id||0)-(b.$id||0)}(a,b)};var UrlRules=function(){function UrlRules(router){this.router=router,this._sortFn=defaultRuleSortFn,this._rules=[],this._id=0,this.urlRuleFactory=new UrlRuleFactory(router)}return UrlRules.prototype.dispose=function(router){this._rules=[],delete this._otherwiseFn},UrlRules.prototype.initial=function(handler){var handlerFn=getHandlerFn(handler);this.rule(this.urlRuleFactory.create(function(urlParts,router){return 0===router.globals.transitionHistory.size()&&!!/^\/?$/.exec(urlParts.path)},handlerFn))},UrlRules.prototype.otherwise=function(handler){var handlerFn=getHandlerFn(handler);this._otherwiseFn=this.urlRuleFactory.create(val(!0),handlerFn),this._sorted=!1},UrlRules.prototype.removeRule=function(rule){removeFrom(this._rules,rule)},UrlRules.prototype.rule=function(rule){var _this=this;if(!UrlRuleFactory.isUrlRule(rule))throw new Error("invalid rule");return rule.$id=this._id++,rule.priority=rule.priority||0,this._rules.push(rule),this._sorted=!1,function(){return _this.removeRule(rule)}},UrlRules.prototype.rules=function(){return this.ensureSorted(),this._rules.concat(this._otherwiseFn?[this._otherwiseFn]:[])},UrlRules.prototype.sort=function(compareFn){for(var sorted=this.stableSort(this._rules,this._sortFn=compareFn||this._sortFn),group=0,i=0;i<sorted.length;i++)sorted[i]._group=group,i<sorted.length-1&&0!==this._sortFn(sorted[i],sorted[i+1])&&group++;this._rules=sorted,this._sorted=!0},UrlRules.prototype.ensureSorted=function(){this._sorted||this.sort()},UrlRules.prototype.stableSort=function(arr,compareFn){var arrOfWrapper=arr.map(function(elem,idx){return{elem:elem,idx:idx}});return arrOfWrapper.sort(function(wrapperA,wrapperB){var cmpDiff=compareFn(wrapperA.elem,wrapperB.elem);return 0===cmpDiff?wrapperA.idx-wrapperB.idx:cmpDiff}),arrOfWrapper.map(function(wrapper){return wrapper.elem})},UrlRules.prototype.when=function(matcher,handler,options){var rule=this.urlRuleFactory.create(matcher,handler);return isDefined(options&&options.priority)&&(rule.priority=options.priority),this.rule(rule),rule},UrlRules}(),UrlConfig=function(){function UrlConfig(router){var _this=this;this.router=router,this.paramTypes=new ParamTypes,this._isCaseInsensitive=!1,this._isStrictMode=!0,this._defaultSquashPolicy=!1,this.dispose=function(){return _this.paramTypes.dispose()},this.baseHref=function(){return _this.router.locationConfig.baseHref()},this.hashPrefix=function(newprefix){return _this.router.locationConfig.hashPrefix(newprefix)},this.host=function(){return _this.router.locationConfig.host()},this.html5Mode=function(){return _this.router.locationConfig.html5Mode()},this.port=function(){return _this.router.locationConfig.port()},this.protocol=function(){return _this.router.locationConfig.protocol()}}return UrlConfig.prototype.caseInsensitive=function(value){return this._isCaseInsensitive=isDefined(value)?value:this._isCaseInsensitive},UrlConfig.prototype.defaultSquashPolicy=function(value){if(isDefined(value)&&!0!==value&&!1!==value&&!isString(value))throw new Error("Invalid squash policy: "+value+". Valid policies: false, true, arbitrary-string");return this._defaultSquashPolicy=isDefined(value)?value:this._defaultSquashPolicy},UrlConfig.prototype.strictMode=function(value){return this._isStrictMode=isDefined(value)?value:this._isStrictMode},UrlConfig.prototype.type=function(name,definition,definitionFn){var type=this.paramTypes.type(name,definition,definitionFn);return isDefined(definition)?this:type},UrlConfig}(),UrlService=function(){function UrlService(router){var _this=this;this.router=router,this.interceptDeferred=!1,this.rules=new UrlRules(this.router),this.config=new UrlConfig(this.router),this.url=function(newurl,replace,state){return _this.router.locationService.url(newurl,replace,state)},this.path=function(){return _this.router.locationService.path()},this.search=function(){return _this.router.locationService.search()},this.hash=function(){return _this.router.locationService.hash()},this.onChange=function(callback){return _this.router.locationService.onChange(callback)}}return UrlService.prototype.dispose=function(){this.listen(!1),this.rules.dispose()},UrlService.prototype.parts=function(){return{path:this.path(),search:this.search(),hash:this.hash()}},UrlService.prototype.sync=function(evt){if(!evt||!evt.defaultPrevented){var _a=this.router,urlService=_a.urlService,stateService=_a.stateService,url={path:urlService.path(),search:urlService.search(),hash:urlService.hash()},best=this.match(url);pattern([[isString,function(newurl){return urlService.url(newurl,!0)}],[TargetState.isDef,function(def){return stateService.go(def.state,def.params,def.options)}],[is(TargetState),function(target){return stateService.go(target.state(),target.params(),target.options())}]])(best&&best.rule.handler(best.match,url,this.router))}},UrlService.prototype.listen=function(enabled){var _this=this;if(!1!==enabled)return this._stopListeningFn=this._stopListeningFn||this.router.urlService.onChange(function(evt){return _this.sync(evt)});this._stopListeningFn&&this._stopListeningFn(),delete this._stopListeningFn},UrlService.prototype.deferIntercept=function(defer){void 0===defer&&(defer=!0),this.interceptDeferred=defer},UrlService.prototype.match=function(url){var _this=this;url=extend({path:"",search:{},hash:""},url);for(var best,rules=this.rules.rules(),i=0;i<rules.length&&(!best||best.rule._group===rules[i]._group);i++){var current=function(rule){var match=rule.match(url,_this.router);return match&&{match:match,rule:rule,weight:rule.matchPriority(match)}}(rules[i]);best=!best||current&&current.weight>best.weight?current:best}return best},UrlService}(),_routerInstance=0,locationServiceStub=makeStub("LocationServices",["url","path","search","hash","onChange"]),locationConfigStub=makeStub("LocationConfig",["port","protocol","host","baseHref","html5Mode","hashPrefix"]),UIRouter=function(){function UIRouter(locationService,locationConfig){void 0===locationService&&(locationService=locationServiceStub),void 0===locationConfig&&(locationConfig=locationConfigStub),this.locationService=locationService,this.locationConfig=locationConfig,this.$id=_routerInstance++,this._disposed=!1,this._disposables=[],this.trace=trace,this.viewService=new ViewService(this),this.globals=new UIRouterGlobals,this.transitionService=new TransitionService(this),this.urlMatcherFactory=new UrlMatcherFactory(this),this.urlRouter=new UrlRouter(this),this.urlService=new UrlService(this),this.stateRegistry=new StateRegistry(this),this.stateService=new StateService(this),this._plugins={},this.viewService._pluginapi._rootViewContext(this.stateRegistry.root()),this.globals.$current=this.stateRegistry.root(),this.globals.current=this.globals.$current.self,this.disposable(this.globals),this.disposable(this.stateService),this.disposable(this.stateRegistry),this.disposable(this.transitionService),this.disposable(this.urlService),this.disposable(locationService),this.disposable(locationConfig)}return UIRouter.prototype.disposable=function(disposable){this._disposables.push(disposable)},UIRouter.prototype.dispose=function(disposable){var _this=this;disposable&&isFunction(disposable.dispose)?disposable.dispose(this):(this._disposed=!0,this._disposables.slice().forEach(function(d){try{"function"==typeof d.dispose&&d.dispose(_this),removeFrom(_this._disposables,d)}catch(ignored){}}))},UIRouter.prototype.plugin=function(plugin,options){void 0===options&&(options={});var pluginInstance=new plugin(this,options);if(!pluginInstance.name)throw new Error("Required property `name` missing on plugin: "+pluginInstance);return this._disposables.push(pluginInstance),this._plugins[pluginInstance.name]=pluginInstance},UIRouter.prototype.getPlugin=function(pluginName){return pluginName?this._plugins[pluginName]:values(this._plugins)},UIRouter}(),isTransition=inArray(["$transition$",Transition]),treeChangesCleanup=function(trans){values(trans.treeChanges()).reduce(unnestR,[]).reduce(uniqR,[]).forEach(function(node){node.resolvables=node.resolvables.map(function(r){return isTransition(r.token)?Resolvable.fromData(r.token,null):r})})},onExitHook=makeEnterExitRetainHook("onExit"),onRetainHook=makeEnterExitRetainHook("onRetain"),onEnterHook=makeEnterExitRetainHook("onEnter"),TransitionEventType=function(){return function(name,hookPhase,hookOrder,criteriaMatchPath,reverseSort,getResultHandler,getErrorHandler,synchronous){void 0===reverseSort&&(reverseSort=!1),void 0===getResultHandler&&(getResultHandler=TransitionHook.HANDLE_RESULT),void 0===getErrorHandler&&(getErrorHandler=TransitionHook.REJECT_ERROR),void 0===synchronous&&(synchronous=!1),this.name=name,this.hookPhase=hookPhase,this.hookOrder=hookOrder,this.criteriaMatchPath=criteriaMatchPath,this.reverseSort=reverseSort,this.getResultHandler=getResultHandler,this.getErrorHandler=getErrorHandler,this.synchronous=synchronous}}(),defaultTransOpts={location:!0,relative:null,inherit:!1,notify:!0,reload:!1,custom:{},current:function(){return null},source:"unknown"},TransitionService=function(){function TransitionService(_router){this._transitionCount=0,this._eventTypes=[],this._registeredHooks={},this._criteriaPaths={},this._router=_router,this.$view=_router.viewService,this._deregisterHookFns={},this._pluginapi=createProxyFunctions(val(this),{},val(this),["_definePathType","_defineEvent","_getPathTypes","_getEvents","getHooks"]),this._defineCorePaths(),this._defineCoreEvents(),this._registerCoreTransitionHooks(),_router.globals.successfulTransitions.onEvict(treeChangesCleanup)}return TransitionService.prototype.onCreate=function(criteria,callback,options){},TransitionService.prototype.onBefore=function(criteria,callback,options){},TransitionService.prototype.onStart=function(criteria,callback,options){},TransitionService.prototype.onExit=function(criteria,callback,options){},TransitionService.prototype.onRetain=function(criteria,callback,options){},TransitionService.prototype.onEnter=function(criteria,callback,options){},TransitionService.prototype.onFinish=function(criteria,callback,options){},TransitionService.prototype.onSuccess=function(criteria,callback,options){},TransitionService.prototype.onError=function(criteria,callback,options){},TransitionService.prototype.dispose=function(router){values(this._registeredHooks).forEach(function(hooksArray){return hooksArray.forEach(function(hook){hook._deregistered=!0,removeFrom(hooksArray,hook)})})},TransitionService.prototype.create=function(fromPath,targetState){return new Transition(fromPath,targetState,this._router)},TransitionService.prototype._defineCoreEvents=function(){var Phase=exports.TransitionHookPhase,TH=TransitionHook,paths=this._criteriaPaths;this._defineEvent("onCreate",Phase.CREATE,0,paths.to,!1,TH.LOG_REJECTED_RESULT,TH.THROW_ERROR,!0),this._defineEvent("onBefore",Phase.BEFORE,0,paths.to),this._defineEvent("onStart",Phase.RUN,0,paths.to),this._defineEvent("onExit",Phase.RUN,100,paths.exiting,!0),this._defineEvent("onRetain",Phase.RUN,200,paths.retained),this._defineEvent("onEnter",Phase.RUN,300,paths.entering),this._defineEvent("onFinish",Phase.RUN,400,paths.to),this._defineEvent("onSuccess",Phase.SUCCESS,0,paths.to,!1,TH.LOG_REJECTED_RESULT,TH.LOG_ERROR,!0),this._defineEvent("onError",Phase.ERROR,0,paths.to,!1,TH.LOG_REJECTED_RESULT,TH.LOG_ERROR,!0)},TransitionService.prototype._defineCorePaths=function(){var STATE=exports.TransitionHookScope.STATE,TRANSITION=exports.TransitionHookScope.TRANSITION;this._definePathType("to",TRANSITION),this._definePathType("from",TRANSITION),this._definePathType("exiting",STATE),this._definePathType("retained",STATE),this._definePathType("entering",STATE)},TransitionService.prototype._defineEvent=function(name,hookPhase,hookOrder,criteriaMatchPath,reverseSort,getResultHandler,getErrorHandler,synchronous){void 0===reverseSort&&(reverseSort=!1),void 0===getResultHandler&&(getResultHandler=TransitionHook.HANDLE_RESULT),void 0===getErrorHandler&&(getErrorHandler=TransitionHook.REJECT_ERROR),void 0===synchronous&&(synchronous=!1);var eventType=new TransitionEventType(name,hookPhase,hookOrder,criteriaMatchPath,reverseSort,getResultHandler,getErrorHandler,synchronous);this._eventTypes.push(eventType),makeEvent(this,this,eventType)},TransitionService.prototype._getEvents=function(phase){return(isDefined(phase)?this._eventTypes.filter(function(type){return type.hookPhase===phase}):this._eventTypes.slice()).sort(function(l,r){var cmpByPhase=l.hookPhase-r.hookPhase;return 0===cmpByPhase?l.hookOrder-r.hookOrder:cmpByPhase})},TransitionService.prototype._definePathType=function(name,hookScope){this._criteriaPaths[name]={name:name,scope:hookScope}},TransitionService.prototype._getPathTypes=function(){return this._criteriaPaths},TransitionService.prototype.getHooks=function(hookName){return this._registeredHooks[hookName]},TransitionService.prototype._registerCoreTransitionHooks=function(){var fns=this._deregisterHookFns;fns.addCoreResolves=function(transitionService){return transitionService.onCreate({},function(trans){trans.addResolvable(Resolvable.fromData(UIRouter,trans.router),""),trans.addResolvable(Resolvable.fromData(Transition,trans),""),trans.addResolvable(Resolvable.fromData("$transition$",trans),""),trans.addResolvable(Resolvable.fromData("$stateParams",trans.params()),""),trans.entering().forEach(function(state){trans.addResolvable(Resolvable.fromData("$state$",state),state)})})}(this),fns.ignored=function(transitionService){return transitionService.onBefore({},function(trans){var ignoredReason=trans._ignoredReason();if(ignoredReason){trace.traceTransitionIgnored(trans);var pending=trans.router.globals.transition;return"SameAsCurrent"===ignoredReason&&pending&&pending.abort(),Rejection.ignored().toPromise()}},{priority:-9999})}(this),fns.invalid=function(transitionService){return transitionService.onBefore({},function(trans){if(!trans.valid())throw new Error(trans.error().toString())},{priority:-1e4})}(this),fns.redirectTo=function(transitionService){return transitionService.onStart({to:function(state){return!!state.redirectTo}},function(trans){function handleResult(result){if(result)return result instanceof TargetState?result:isString(result)?$state.target(result,trans.params(),trans.options()):result.state||result.params?$state.target(result.state||trans.to(),result.params||trans.params(),trans.options()):void 0}var redirect=trans.to().redirectTo;if(redirect){var $state=trans.router.stateService;return isFunction(redirect)?services.$q.when(redirect(trans)).then(handleResult):handleResult(redirect)}})}(this),fns.onExit=function(transitionService){return transitionService.onExit({exiting:function(state){return!!state.onExit}},onExitHook)}(this),fns.onRetain=function(transitionService){return transitionService.onRetain({retained:function(state){return!!state.onRetain}},onRetainHook)}(this),fns.onEnter=function(transitionService){return transitionService.onEnter({entering:function(state){return!!state.onEnter}},onEnterHook)}(this),fns.eagerResolve=function(transitionService){return transitionService.onStart({},function(trans){return new ResolveContext(trans.treeChanges().to).resolvePath("EAGER",trans).then(noop)},{priority:1e3})}(this),fns.lazyResolve=function(transitionService){return transitionService.onEnter({entering:val(!0)},function(trans,state){return new ResolveContext(trans.treeChanges().to).subContext(state.$$state()).resolvePath("LAZY",trans).then(noop)},{priority:1e3})}(this),fns.resolveAll=function(transitionService){return transitionService.onFinish({},function(trans){return new ResolveContext(trans.treeChanges().to).resolvePath("LAZY",trans).then(noop)},{priority:1e3})}(this),fns.loadViews=function(transitionService){return transitionService.onFinish({},function(transition){var $q=services.$q,enteringViews=transition.views("entering");if(enteringViews.length)return $q.all(enteringViews.map(function(view){return $q.when(view.load())})).then(noop)})}(this),fns.activateViews=function(transitionService){return transitionService.onSuccess({},function(transition){var enteringViews=transition.views("entering"),exitingViews=transition.views("exiting");if(enteringViews.length||exitingViews.length){var $view=transition.router.viewService;exitingViews.forEach(function(vc){return $view.deactivateViewConfig(vc)}),enteringViews.forEach(function(vc){return $view.activateViewConfig(vc)}),$view.sync()}})}(this),fns.updateGlobals=function(transitionService){return transitionService.onCreate({},function(trans){var globals=trans.router.globals,clearCurrentTransition=function(){globals.transition===trans&&(globals.transition=null)};trans.onSuccess({},function(){globals.successfulTransitions.enqueue(trans),globals.$current=trans.$to(),globals.current=globals.$current.self,copy(trans.params(),globals.params)},{priority:1e4}),trans.promise.then(clearCurrentTransition,clearCurrentTransition)})}(this),fns.updateUrl=function(transitionService){return transitionService.onSuccess({},function(transition){var options=transition.options(),$state=transition.router.stateService,$urlRouter=transition.router.urlRouter;if("url"!==options.source&&options.location&&$state.$current.navigable){var urlOptions={replace:"replace"===options.location};$urlRouter.push($state.$current.navigable.url,$state.params,urlOptions)}$urlRouter.update(!0)},{priority:9999})}(this),fns.lazyLoad=function(transitionService){return transitionService.onBefore({entering:function(state){return!!state.lazyLoad}},function(transition){var router=transition.router,promises=transition.entering().filter(function(state){return!!state.$$state().lazyLoad}).map(function(state){return lazyLoadState(transition,state)});return services.$q.all(promises).then(function(){if("url"!==transition.originalTransition().options().source){var orig=transition.targetState();return router.stateService.target(orig.identifier(),orig.params(),orig.options())}var $url=router.urlService,result=$url.match($url.parts()),rule=result&&result.rule;if(rule&&"STATE"===rule.type){var state=rule.state,params=result.match;return router.stateService.target(state,params,transition.options())}router.urlService.sync()})})}(this)},TransitionService}(),StateService=function(){function StateService(router){this.router=router,this.invalidCallbacks=[],this._defaultErrorHandler=function($error$){$error$ instanceof Error&&$error$.stack?(console.error($error$),console.error($error$.stack)):$error$ instanceof Rejection?(console.error($error$.toString()),$error$.detail&&$error$.detail.stack&&console.error($error$.detail.stack)):console.error($error$)};var boundFns=Object.keys(StateService.prototype).filter(not(inArray(["current","$current","params","transition"])));createProxyFunctions(val(StateService.prototype),this,val(this),boundFns)}return Object.defineProperty(StateService.prototype,"transition",{get:function(){return this.router.globals.transition},enumerable:!0,configurable:!0}),Object.defineProperty(StateService.prototype,"params",{get:function(){return this.router.globals.params},enumerable:!0,configurable:!0}),Object.defineProperty(StateService.prototype,"current",{get:function(){return this.router.globals.current},enumerable:!0,configurable:!0}),Object.defineProperty(StateService.prototype,"$current",{get:function(){return this.router.globals.$current},enumerable:!0,configurable:!0}),StateService.prototype.dispose=function(){this.defaultErrorHandler(noop),this.invalidCallbacks=[]},StateService.prototype._handleInvalidTargetState=function(fromPath,toState){function invokeNextCallback(){var nextCallback=callbackQueue.dequeue();if(void 0===nextCallback)return Rejection.invalid(toState.error()).toPromise();return services.$q.when(nextCallback(toState,fromState,injector)).then(checkForRedirect).then(function(result){return result||invokeNextCallback()})}var _this=this,fromState=PathUtils.makeTargetState(this.router.stateRegistry,fromPath),globals=this.router.globals,latestThing=function(){return globals.transitionHistory.peekTail()},latest=latestThing(),callbackQueue=new Queue(this.invalidCallbacks.slice()),injector=new ResolveContext(fromPath).injector(),checkForRedirect=function(result){if(result instanceof TargetState){var target=result;return(target=_this.target(target.identifier(),target.params(),target.options())).valid()?latestThing()!==latest?Rejection.superseded().toPromise():_this.transitionTo(target.identifier(),target.params(),target.options()):Rejection.invalid(target.error()).toPromise()}};return invokeNextCallback()},StateService.prototype.onInvalid=function(callback){return this.invalidCallbacks.push(callback),function(){removeFrom(this.invalidCallbacks)(callback)}.bind(this)},StateService.prototype.reload=function(reloadState){return this.transitionTo(this.current,this.params,{reload:!isDefined(reloadState)||reloadState,inherit:!1,notify:!1})},StateService.prototype.go=function(to,params,options){var transOpts=defaults(options,{relative:this.$current,inherit:!0},defaultTransOpts);return this.transitionTo(to,params,transOpts)},StateService.prototype.target=function(identifier,params,options){if(void 0===options&&(options={}),isObject(options.reload)&&!options.reload.name)throw new Error("Invalid reload state object");var reg=this.router.stateRegistry;if(options.reloadState=!0===options.reload?reg.root():reg.matcher.find(options.reload,options.relative),options.reload&&!options.reloadState)throw new Error("No such reload state '"+(isString(options.reload)?options.reload:options.reload.name)+"'");return new TargetState(this.router.stateRegistry,identifier,params,options)},StateService.prototype.getCurrentPath=function(){var _this=this,latestSuccess=this.router.globals.successfulTransitions.peekTail();return latestSuccess?latestSuccess.treeChanges().to:[new PathNode(_this.router.stateRegistry.root())]},StateService.prototype.transitionTo=function(to,toParams,options){var _this=this;void 0===toParams&&(toParams={}),void 0===options&&(options={});var router=this.router,globals=router.globals;options=defaults(options,defaultTransOpts);options=extend(options,{current:function(){return globals.transition}});var ref=this.target(to,toParams,options),currentPath=this.getCurrentPath();if(!ref.exists())return this._handleInvalidTargetState(currentPath,ref);if(!ref.valid())return silentRejection(ref.error());var rejectedTransitionHandler=function(trans){return function(error){if(error instanceof Rejection){var isLatest=router.globals.lastStartedTransitionId===trans.$id;if(error.type===exports.RejectType.IGNORED)return isLatest&&router.urlRouter.update(),services.$q.when(globals.current);var detail=error.detail;if(error.type===exports.RejectType.SUPERSEDED&&error.redirected&&detail instanceof TargetState){var redirect=trans.redirect(detail);return redirect.run().catch(rejectedTransitionHandler(redirect))}if(error.type===exports.RejectType.ABORTED)return isLatest&&router.urlRouter.update(),services.$q.reject(error)}return _this.defaultErrorHandler()(error),services.$q.reject(error)}},transition=this.router.transitionService.create(currentPath,ref),transitionToPromise=transition.run().catch(rejectedTransitionHandler(transition));return silenceUncaughtInPromise(transitionToPromise),extend(transitionToPromise,{transition:transition})},StateService.prototype.is=function(stateOrName,params,options){options=defaults(options,{relative:this.$current});var state=this.router.stateRegistry.matcher.find(stateOrName,options.relative);if(isDefined(state)){if(this.$current!==state)return!1;if(!params)return!0;var schema=state.parameters({inherit:!0,matchingKeys:params});return Param.equals(schema,Param.values(schema,params),this.params)}},StateService.prototype.includes=function(stateOrName,params,options){options=defaults(options,{relative:this.$current});var glob=isString(stateOrName)&&Glob.fromString(stateOrName);if(glob){if(!glob.matches(this.$current.name))return!1;stateOrName=this.$current.name}var state=this.router.stateRegistry.matcher.find(stateOrName,options.relative),include=this.$current.includes;if(isDefined(state)){if(!isDefined(include[state.name]))return!1;if(!params)return!0;var schema=state.parameters({inherit:!0,matchingKeys:params});return Param.equals(schema,Param.values(schema,params),this.params)}},StateService.prototype.href=function(stateOrName,params,options){options=defaults(options,{lossy:!0,inherit:!0,absolute:!1,relative:this.$current}),params=params||{};var state=this.router.stateRegistry.matcher.find(stateOrName,options.relative);if(!isDefined(state))return null;options.inherit&&(params=this.params.$inherit(params,this.$current,state));var nav=state&&options.lossy?state.navigable:state;return nav&&void 0!==nav.url&&null!==nav.url?this.router.urlRouter.href(nav.url,params,{absolute:options.absolute}):null},StateService.prototype.defaultErrorHandler=function(handler){return this._defaultErrorHandler=handler||this._defaultErrorHandler},StateService.prototype.get=function(stateOrName,base){var reg=this.router.stateRegistry;return 0===arguments.length?reg.get():reg.get(stateOrName,base||this.$current)},StateService.prototype.lazyLoad=function(stateOrName,transition){var state=this.get(stateOrName);if(!state||!state.lazyLoad)throw new Error("Can not lazy load "+stateOrName);var currentPath=this.getCurrentPath(),target=PathUtils.makeTargetState(this.router.stateRegistry,currentPath);return transition=transition||this.router.transitionService.create(currentPath,target),lazyLoadState(transition,state)},StateService}(),$q={when:function(val$$1){return new Promise(function(resolve,reject){return resolve(val$$1)})},reject:function(val$$1){return new Promise(function(resolve,reject){reject(val$$1)})},defer:function(){var deferred={};return deferred.promise=new Promise(function(resolve,reject){deferred.resolve=resolve,deferred.reject=reject}),deferred},all:function(promises){if(isArray(promises))return Promise.all(promises);if(isObject(promises)){var chain=Object.keys(promises).map(function(key){return promises[key].then(function(val$$1){return{key:key,val:val$$1}})});return $q.all(chain).then(function(values$$1){return values$$1.reduce(function(acc,tuple){return acc[tuple.key]=tuple.val,acc},{})})}}},globals={},STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,ARGUMENT_NAMES=/([^\s,]+)/g,$injector={get:function(name){return globals[name]},has:function(name){return null!=$injector.get(name)},invoke:function(fn,context,locals){var all$$1=extend({},globals,locals||{}),params=$injector.annotate(fn),ensureExist=assertPredicate(function(key){return all$$1.hasOwnProperty(key)},function(key){return"DI can't find injectable: '"+key+"'"}),args=params.filter(ensureExist).map(function(x){return all$$1[x]});return isFunction(fn)?fn.apply(context,args):fn.slice(-1)[0].apply(context,args)},annotate:function(fn){if(!isInjectable(fn))throw new Error("Not an injectable function: "+fn);if(fn&&fn.$inject)return fn.$inject;if(isArray(fn))return fn.slice(0,-1);var fnStr=fn.toString().replace(STRIP_COMMENTS,"");return fnStr.slice(fnStr.indexOf("(")+1,fnStr.indexOf(")")).match(ARGUMENT_NAMES)||[]}},keyValsToObjectR=function(accum,_a){var key=_a[0],val$$1=_a[1];return accum.hasOwnProperty(key)?isArray(accum[key])?accum[key].push(val$$1):accum[key]=[accum[key],val$$1]:accum[key]=val$$1,accum},getParams=function(queryString){return queryString.split("&").filter(identity).map(splitEqual).reduce(keyValsToObjectR,{})},buildUrl=function(loc){var path=loc.path(),searchObject=loc.search(),hash=loc.hash(),search=Object.keys(searchObject).map(function(key){var param=searchObject[key];return(isArray(param)?param:[param]).map(function(val$$1){return key+"="+val$$1})}).reduce(unnestR,[]).join("&");return path+(search?"?"+search:"")+(hash?"#"+hash:"")},BaseLocationServices=function(){function BaseLocationServices(router,fireAfterUpdate){var _this=this;this.fireAfterUpdate=fireAfterUpdate,this._listeners=[],this._listener=function(evt){return _this._listeners.forEach(function(cb){return cb(evt)})},this.hash=function(){return parseUrl$1(_this._get()).hash},this.path=function(){return parseUrl$1(_this._get()).path},this.search=function(){return getParams(parseUrl$1(_this._get()).search)},this._location=root.location,this._history=root.history}return BaseLocationServices.prototype.url=function(url,replace){return void 0===replace&&(replace=!0),isDefined(url)&&url!==this._get()&&(this._set(null,null,url,replace),this.fireAfterUpdate&&this._listeners.forEach(function(cb){return cb({url:url})})),buildUrl(this)},BaseLocationServices.prototype.onChange=function(cb){var _this=this;return this._listeners.push(cb),function(){return removeFrom(_this._listeners,cb)}},BaseLocationServices.prototype.dispose=function(router){deregAll(this._listeners)},BaseLocationServices}(),__extends=function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),HashLocationService=function(_super){function HashLocationService(router){var _this=_super.call(this,router,!1)||this;return root.addEventListener("hashchange",_this._listener,!1),_this}return __extends(HashLocationService,_super),HashLocationService.prototype._get=function(){return trimHashVal(this._location.hash)},HashLocationService.prototype._set=function(state,title,url,replace){this._location.hash=url},HashLocationService.prototype.dispose=function(router){_super.prototype.dispose.call(this,router),root.removeEventListener("hashchange",this._listener)},HashLocationService}(BaseLocationServices),__extends$1=function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),MemoryLocationService=function(_super){function MemoryLocationService(router){return _super.call(this,router,!0)||this}return __extends$1(MemoryLocationService,_super),MemoryLocationService.prototype._get=function(){return this._url},MemoryLocationService.prototype._set=function(state,title,url,replace){this._url=url},MemoryLocationService}(BaseLocationServices),__extends$2=function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),PushStateLocationService=function(_super){function PushStateLocationService(router){var _this=_super.call(this,router,!0)||this;return _this._config=router.urlService.config,root.addEventListener("popstate",_this._listener,!1),_this}return __extends$2(PushStateLocationService,_super),PushStateLocationService.prototype._getBasePrefix=function(){return stripLastPathElement(this._config.baseHref())},PushStateLocationService.prototype._get=function(){var _a=this._location,pathname=_a.pathname,hash=_a.hash,search=_a.search;search=splitQuery(search)[1],hash=splitHash(hash)[1];var basePrefix=this._getBasePrefix(),exactBaseHrefMatch=pathname===this._config.baseHref(),startsWithBase=pathname.substr(0,basePrefix.length)===basePrefix;return(pathname=exactBaseHrefMatch?"/":startsWithBase?pathname.substring(basePrefix.length):pathname)+(search?"?"+search:"")+(hash?"#"+hash:"")},PushStateLocationService.prototype._set=function(state,title,url,replace){var basePrefix=this._getBasePrefix(),slash=url&&"/"!==url[0]?"/":"",fullUrl=""===url||"/"===url?this._config.baseHref():basePrefix+slash+url;replace?this._history.replaceState(state,title,fullUrl):this._history.pushState(state,title,fullUrl)},PushStateLocationService.prototype.dispose=function(router){_super.prototype.dispose.call(this,router),root.removeEventListener("popstate",this._listener)},PushStateLocationService}(BaseLocationServices),MemoryLocationConfig=function(){return function(){var _this=this;this.dispose=noop,this._baseHref="",this._port=80,this._protocol="http",this._host="localhost",this._hashPrefix="",this.port=function(){return _this._port},this.protocol=function(){return _this._protocol},this.host=function(){return _this._host},this.baseHref=function(){return _this._baseHref},this.html5Mode=function(){return!1},this.hashPrefix=function(newval){return isDefined(newval)?_this._hashPrefix=newval:_this._hashPrefix}}}(),BrowserLocationConfig=function(){function BrowserLocationConfig(router,_isHtml5){void 0===_isHtml5&&(_isHtml5=!1),this._isHtml5=_isHtml5,this._baseHref=void 0,this._hashPrefix=""}return BrowserLocationConfig.prototype.port=function(){return location.port?Number(location.port):"https"===this.protocol()?443:80},BrowserLocationConfig.prototype.protocol=function(){return location.protocol.replace(/:/g,"")},BrowserLocationConfig.prototype.host=function(){return location.hostname},BrowserLocationConfig.prototype.html5Mode=function(){return this._isHtml5},BrowserLocationConfig.prototype.hashPrefix=function(newprefix){return isDefined(newprefix)?this._hashPrefix=newprefix:this._hashPrefix},BrowserLocationConfig.prototype.baseHref=function(href){return isDefined(href)&&(this._baseHref=href),isUndefined(this._baseHref)&&(this._baseHref=this.getBaseHref()),this._baseHref},BrowserLocationConfig.prototype.getBaseHref=function(){var baseTag=document.getElementsByTagName("base")[0];return baseTag&&baseTag.href?baseTag.href.replace(/^(https?:)?\/\/[^/]*/,""):this._isHtml5?"/":location.pathname||"/"},BrowserLocationConfig.prototype.dispose=function(){},BrowserLocationConfig}(),hashLocationPlugin=locationPluginFactory("vanilla.hashBangLocation",!1,HashLocationService,BrowserLocationConfig),pushStateLocationPlugin=locationPluginFactory("vanilla.pushStateLocation",!0,PushStateLocationService,BrowserLocationConfig),memoryLocationPlugin=locationPluginFactory("vanilla.memoryLocation",!1,MemoryLocationService,MemoryLocationConfig),UIRouterPluginBase=function(){function UIRouterPluginBase(){}return UIRouterPluginBase.prototype.dispose=function(router){},UIRouterPluginBase}(),index=Object.freeze({root:root,fromJson:fromJson,toJson:toJson,forEach:forEach,extend:extend,equals:equals,identity:identity,noop:noop,createProxyFunctions:createProxyFunctions,inherit:inherit,inArray:inArray,_inArray:_inArray,removeFrom:removeFrom,_removeFrom:_removeFrom,pushTo:pushTo,_pushTo:_pushTo,deregAll:deregAll,defaults:defaults,mergeR:mergeR,ancestors:ancestors,pick:pick,omit:omit,pluck:pluck,filter:filter,find:find,mapObj:mapObj,map:map,values:values,allTrueR:allTrueR,anyTrueR:anyTrueR,unnestR:unnestR,flattenR:flattenR,pushR:pushR,uniqR:uniqR,unnest:unnest,flatten:flatten,assertPredicate:assertPredicate,assertMap:assertMap,assertFn:assertFn,pairs:pairs,arrayTuples:arrayTuples,applyPairs:applyPairs,tail:tail,copy:copy,_extend:_extend,silenceUncaughtInPromise:silenceUncaughtInPromise,silentRejection:silentRejection,makeStub:makeStub,services:services,Glob:Glob,curry:curry,compose:compose,pipe:pipe,prop:prop,propEq:propEq,parse:parse,not:not,and:and,or:or,all:all,any:any,is:is,eq:eq,val:val,invoke:invoke,pattern:pattern,isUndefined:isUndefined,isDefined:isDefined,isNull:isNull,isNullOrUndefined:isNullOrUndefined,isFunction:isFunction,isNumber:isNumber,isString:isString,isObject:isObject,isArray:isArray,isDate:isDate,isRegExp:isRegExp,isInjectable:isInjectable,isPromise:isPromise,Queue:Queue,maxLength:maxLength,padString:padString,kebobString:kebobString,functionToString:functionToString,fnToString:fnToString,stringify:stringify,beforeAfterSubstr:beforeAfterSubstr,hostRegex:hostRegex,stripLastPathElement:stripLastPathElement,splitHash:splitHash,splitQuery:splitQuery,splitEqual:splitEqual,trimHashVal:trimHashVal,splitOnDelim:splitOnDelim,joinNeighborsR:joinNeighborsR,get Category(){return exports.Category},Trace:Trace,trace:trace,get DefType(){return exports.DefType},Param:Param,ParamTypes:ParamTypes,StateParams:StateParams,ParamType:ParamType,PathNode:PathNode,PathUtils:PathUtils,resolvePolicies:resolvePolicies,defaultResolvePolicy:defaultResolvePolicy,Resolvable:Resolvable,NATIVE_INJECTOR_TOKEN:NATIVE_INJECTOR_TOKEN,ResolveContext:ResolveContext,resolvablesBuilder:resolvablesBuilder,StateBuilder:StateBuilder,StateObject:StateObject,StateMatcher:StateMatcher,StateQueueManager:StateQueueManager,StateRegistry:StateRegistry,StateService:StateService,TargetState:TargetState,get TransitionHookPhase(){return exports.TransitionHookPhase},get TransitionHookScope(){return exports.TransitionHookScope},HookBuilder:HookBuilder,matchState:matchState,RegisteredHook:RegisteredHook,makeEvent:makeEvent,get RejectType(){return exports.RejectType},Rejection:Rejection,Transition:Transition,TransitionHook:TransitionHook,TransitionEventType:TransitionEventType,defaultTransOpts:defaultTransOpts,TransitionService:TransitionService,UrlRules:UrlRules,UrlConfig:UrlConfig,UrlMatcher:UrlMatcher,ParamFactory:ParamFactory,UrlMatcherFactory:UrlMatcherFactory,UrlRouter:UrlRouter,UrlRuleFactory:UrlRuleFactory,BaseUrlRule:BaseUrlRule,UrlService:UrlService,ViewService:ViewService,UIRouterGlobals:UIRouterGlobals,UIRouter:UIRouter,$q:$q,$injector:$injector,BaseLocationServices:BaseLocationServices,HashLocationService:HashLocationService,MemoryLocationService:MemoryLocationService,PushStateLocationService:PushStateLocationService,MemoryLocationConfig:MemoryLocationConfig,BrowserLocationConfig:BrowserLocationConfig,keyValsToObjectR:keyValsToObjectR,getParams:getParams,parseUrl:parseUrl$1,buildUrl:buildUrl,locationPluginFactory:locationPluginFactory,servicesPlugin:servicesPlugin,hashLocationPlugin:hashLocationPlugin,pushStateLocationPlugin:pushStateLocationPlugin,memoryLocationPlugin:memoryLocationPlugin,UIRouterPluginBase:UIRouterPluginBase}),hasAnyKey=function(keys,obj){return keys.reduce(function(acc,key){return acc||isDefined(obj[key])},!1)},id$1=0,Ng1ViewConfig=function(){function Ng1ViewConfig(path,viewDecl,factory){var _this=this;this.path=path,this.viewDecl=viewDecl,this.factory=factory,this.$id=id$1++,this.loaded=!1,this.getTemplate=function(uiView,context){return _this.component?_this.factory.makeComponentTemplate(uiView,context,_this.component,_this.viewDecl.bindings):_this.template}}return Ng1ViewConfig.prototype.load=function(){var _this=this,$q$$1=services.$q,context=new ResolveContext(this.path),params=this.path.reduce(function(acc,node){return extend(acc,node.paramValues)},{}),promises={template:$q$$1.when(this.factory.fromConfig(this.viewDecl,params,context)),controller:$q$$1.when(this.getController(context))};return $q$$1.all(promises).then(function(results){return trace.traceViewServiceEvent("Loaded",_this),_this.controller=results.controller,extend(_this,results.template),_this})},Ng1ViewConfig.prototype.getController=function(context){var provider=this.viewDecl.controllerProvider;if(!isInjectable(provider))return this.viewDecl.controller;var deps=services.$injector.annotate(provider),providerFn=isArray(provider)?tail(provider):provider;return new Resolvable("",providerFn,deps).get(context)},Ng1ViewConfig}(),TemplateFactory=function(){function TemplateFactory(){var _this=this;this._useHttp=ng.version.minor<3,this.$get=["$http","$templateCache","$injector",function($http,$templateCache,$injector$$1){return _this.$templateRequest=$injector$$1.has&&$injector$$1.has("$templateRequest")&&$injector$$1.get("$templateRequest"),_this.$http=$http,_this.$templateCache=$templateCache,_this}]}return TemplateFactory.prototype.useHttpService=function(value){this._useHttp=value},TemplateFactory.prototype.fromConfig=function(config,params,context){var asTemplate=function(result){return services.$q.when(result).then(function(str){return{template:str}})},asComponent=function(result){return services.$q.when(result).then(function(str){return{component:str}})};return isDefined(config.template)?asTemplate(this.fromString(config.template,params)):isDefined(config.templateUrl)?asTemplate(this.fromUrl(config.templateUrl,params)):isDefined(config.templateProvider)?asTemplate(this.fromProvider(config.templateProvider,params,context)):isDefined(config.component)?asComponent(config.component):isDefined(config.componentProvider)?asComponent(this.fromComponentProvider(config.componentProvider,params,context)):asTemplate("<ui-view></ui-view>")},TemplateFactory.prototype.fromString=function(template,params){return isFunction(template)?template(params):template},TemplateFactory.prototype.fromUrl=function(url,params){return isFunction(url)&&(url=url(params)),null==url?null:this._useHttp?this.$http.get(url,{cache:this.$templateCache,headers:{Accept:"text/html"}}).then(function(response){return response.data}):this.$templateRequest(url)},TemplateFactory.prototype.fromProvider=function(provider,params,context){var deps=services.$injector.annotate(provider),providerFn=isArray(provider)?tail(provider):provider;return new Resolvable("",providerFn,deps).get(context)},TemplateFactory.prototype.fromComponentProvider=function(provider,params,context){var deps=services.$injector.annotate(provider),providerFn=isArray(provider)?tail(provider):provider;return new Resolvable("",providerFn,deps).get(context)},TemplateFactory.prototype.makeComponentTemplate=function(uiView,context,component,bindings){bindings=bindings||{};var prefix=ng.version.minor>=3?"::":"",kebob=function(camelCase){var kebobed=kebobString(camelCase);return/^(x|data)-/.exec(kebobed)?"x-"+kebobed:kebobed},attrs=function(name){var cmpDefs=services.$injector.get(name+"Directive");if(!cmpDefs||!cmpDefs.length)throw new Error("Unable to find component named '"+name+"'");return cmpDefs.map(getBindings).reduce(unnestR,[])}(component).map(function(input){var name=input.name,type=input.type,attrName=kebob(name);if(uiView.attr(attrName)&&!bindings[name])return attrName+"='"+uiView.attr(attrName)+"'";var resolveName=bindings[name]||name;if("@"===type)return attrName+"='{{"+prefix+"$resolve."+resolveName+"}}'";if("&"===type){var res=context.getResolvable(resolveName),fn=res&&res.data,args=fn&&services.$injector.annotate(fn)||[];return attrName+"='$resolve."+resolveName+(isArray(fn)?"["+(fn.length-1)+"]":"")+"("+args.join(",")+")'"}return attrName+"='"+prefix+"$resolve."+resolveName+"'"}).join(" "),kebobName=kebob(component);return"<"+kebobName+" "+attrs+"></"+kebobName+">"},TemplateFactory}(),getBindings=function(def){return scopeBindings(isObject(def.bindToController)?def.bindToController:def.scope)},scopeBindings=function(bindingsObj){return Object.keys(bindingsObj||{}).map(function(key){return[key,/^([=<@&])[?]?(.*)/.exec(bindingsObj[key])]}).filter(function(tuple){return isDefined(tuple)&&isArray(tuple[1])}).map(function(tuple){return{name:tuple[1][2]||tuple[0],type:tuple[1][1]}})},StateProvider=function(){function StateProvider(stateRegistry,stateService){this.stateRegistry=stateRegistry,this.stateService=stateService,createProxyFunctions(val(StateProvider.prototype),this,val(this))}return StateProvider.prototype.decorator=function(name,func){return this.stateRegistry.decorator(name,func)||this},StateProvider.prototype.state=function(name,definition){return isObject(name)?definition=name:definition.name=name,this.stateRegistry.register(definition),this},StateProvider.prototype.onInvalid=function(callback){return this.stateService.onInvalid(callback)},StateProvider}(),getStateHookBuilder=function(hookName){return function(stateObject,parentFn){var hook=stateObject[hookName],pathname="onExit"===hookName?"from":"to";return hook?function(trans,state){var subContext=new ResolveContext(trans.treeChanges(pathname)).subContext(state.$$state()),locals=extend(getLocals(subContext),{$state$:state,$transition$:trans});return services.$injector.invoke(hook,this,locals)}:void 0}},Ng1LocationServices=function(){function Ng1LocationServices($locationProvider){this._urlListeners=[],this.$locationProvider=$locationProvider;var _lp=val($locationProvider);createProxyFunctions(_lp,this,_lp,["hashPrefix"])}return Ng1LocationServices.monkeyPatchPathParameterType=function(router){var pathType=router.urlMatcherFactory.type("path");pathType.encode=function(x){return null!=x?x.toString().replace(/(~|\/)/g,function(m){return{"~":"~~","/":"~2F"}[m]}):x},pathType.decode=function(x){return null!=x?x.toString().replace(/(~~|~2F)/g,function(m){return{"~~":"~","~2F":"/"}[m]}):x}},Ng1LocationServices.prototype.dispose=function(){},Ng1LocationServices.prototype.onChange=function(callback){var _this=this;return this._urlListeners.push(callback),function(){return removeFrom(_this._urlListeners)(callback)}},Ng1LocationServices.prototype.html5Mode=function(){var html5Mode=this.$locationProvider.html5Mode();return(html5Mode=isObject(html5Mode)?html5Mode.enabled:html5Mode)&&this.$sniffer.history},Ng1LocationServices.prototype.baseHref=function(){return this._baseHref||(this._baseHref=this.$browser.baseHref()||this.$window.location.pathname)},Ng1LocationServices.prototype.url=function(newUrl,replace,state){return void 0===replace&&(replace=!1),isDefined(newUrl)&&this.$location.url(newUrl),replace&&this.$location.replace(),state&&this.$location.state(state),this.$location.url()},Ng1LocationServices.prototype._runtimeServices=function($rootScope,$location,$sniffer,$browser,$window){var _this=this;this.$location=$location,this.$sniffer=$sniffer,this.$browser=$browser,this.$window=$window,$rootScope.$on("$locationChangeSuccess",function(evt){return _this._urlListeners.forEach(function(fn){return fn(evt)})});var _loc=val($location);createProxyFunctions(_loc,this,_loc,["replace","path","search","hash"]),createProxyFunctions(_loc,this,_loc,["port","protocol","host"])},Ng1LocationServices}(),UrlRouterProvider=function(){function UrlRouterProvider(router){this.router=router}return UrlRouterProvider.injectableHandler=function(router,handler){return function(match){return services.$injector.invoke(handler,null,{$match:match,$stateParams:router.globals.params})}},UrlRouterProvider.prototype.$get=function(){var urlService=this.router.urlService;return this.router.urlRouter.update(!0),urlService.interceptDeferred||urlService.listen(),this.router.urlRouter},UrlRouterProvider.prototype.rule=function(ruleFn){var _this=this;if(!isFunction(ruleFn))throw new Error("'rule' must be a function");var rule=new BaseUrlRule(function(){return ruleFn(services.$injector,_this.router.locationService)},identity);return this.router.urlService.rules.rule(rule),this},UrlRouterProvider.prototype.otherwise=function(rule){var _this=this,urlRules=this.router.urlService.rules;if(isString(rule))urlRules.otherwise(rule);else{if(!isFunction(rule))throw new Error("'rule' must be a string or function");urlRules.otherwise(function(){return rule(services.$injector,_this.router.locationService)})}return this},UrlRouterProvider.prototype.when=function(what,handler){return(isArray(handler)||isFunction(handler))&&(handler=UrlRouterProvider.injectableHandler(this.router,handler)),this.router.urlService.rules.when(what,handler),this},UrlRouterProvider.prototype.deferIntercept=function(defer){this.router.urlService.deferIntercept(defer)},UrlRouterProvider}();ng.module("ui.router.angular1",[]);var mod_init=ng.module("ui.router.init",["ng"]),mod_util=ng.module("ui.router.util",["ui.router.init"]),mod_rtr=ng.module("ui.router.router",["ui.router.util"]),mod_state=ng.module("ui.router.state",["ui.router.router","ui.router.util","ui.router.angular1"]),mod_main=ng.module("ui.router",["ui.router.init","ui.router.state","ui.router.angular1"]),router=(ng.module("ui.router.compat",["ui.router"]),null);$uiRouterProvider.$inject=["$locationProvider"];var getProviderFor=function(serviceName){return["$uiRouterProvider",function($urp){var service=$urp.router[serviceName];return service.$get=function(){return service},service}]};runBlock.$inject=["$injector","$q","$uiRouter"];watchDigests.$inject=["$rootScope"],mod_init.provider("$uiRouter",$uiRouterProvider),mod_rtr.provider("$urlRouter",["$uiRouterProvider",function(uiRouter){return uiRouter.urlRouterProvider=new UrlRouterProvider(uiRouter)}]),mod_util.provider("$urlService",getProviderFor("urlService")),mod_util.provider("$urlMatcherFactory",["$uiRouterProvider",function(){return router.urlMatcherFactory}]),mod_util.provider("$templateFactory",function(){return new TemplateFactory}),mod_state.provider("$stateRegistry",getProviderFor("stateRegistry")),mod_state.provider("$uiRouterGlobals",getProviderFor("globals")),mod_state.provider("$transitions",getProviderFor("transitionService")),mod_state.provider("$state",["$uiRouterProvider",function(){return extend(router.stateProvider,{$get:function(){return router.stateService}})}]),mod_state.factory("$stateParams",["$uiRouter",function($uiRouter){return $uiRouter.globals.params}]),mod_main.factory("$view",function(){return router.viewService}),mod_main.service("$trace",function(){return trace}),mod_main.run(watchDigests),mod_util.run(["$urlMatcherFactory",function($urlMatcherFactory){}]),mod_state.run(["$state",function($state){}]),mod_rtr.run(["$urlRouter",function($urlRouter){}]),mod_init.run(runBlock);var uiSrefDirective,getLocals=function(ctx){return ctx.getTokens().filter(isString).map(function(key){var resolvable=ctx.getResolvable(key);return[key,"NOWAIT"===ctx.getPolicy(resolvable).async?resolvable.promise:resolvable.data]}).reduce(applyPairs,{})};uiSrefDirective=["$uiRouter","$timeout",function($uiRouter,$timeout){var $state=$uiRouter.stateService;return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(scope,element,attrs,uiSrefActive){function update(){var def=getDef();unlinkInfoFn&&unlinkInfoFn(),active&&(unlinkInfoFn=active.$$addStateInfo(def.uiState,def.uiStateParams)),null!=def.href&&attrs.$set(type.attr,def.href)}var hookFn,type=getTypeInfo(element),active=uiSrefActive[1]||uiSrefActive[0],unlinkInfoFn=null,rawDef={},getDef=function(){return processedDef($state,element,rawDef)},ref=parseStateRef(attrs.uiSref);rawDef.uiState=ref.state,rawDef.uiStateOpts=attrs.uiSrefOpts?scope.$eval(attrs.uiSrefOpts):{},ref.paramExpr&&(scope.$watch(ref.paramExpr,function(val$$1){rawDef.uiStateParams=extend({},val$$1),update()},!0),rawDef.uiStateParams=extend({},scope.$eval(ref.paramExpr))),update(),scope.$on("$destroy",$uiRouter.stateRegistry.onStatesChanged(update)),scope.$on("$destroy",$uiRouter.transitionService.onSuccess({},update)),type.clickable&&(hookFn=clickHook(element,$state,$timeout,type,getDef),bindEvents(element,scope,hookFn,rawDef.uiStateOpts))}}}];var uiStateDirective;uiStateDirective=["$uiRouter","$timeout",function($uiRouter,$timeout){var $state=$uiRouter.stateService;return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(scope,element,attrs,uiSrefActive){function update(){var def=getDef();unlinkInfoFn&&unlinkInfoFn(),active&&(unlinkInfoFn=active.$$addStateInfo(def.uiState,def.uiStateParams)),null!=def.href&&attrs.$set(type.attr,def.href)}var hookFn,type=getTypeInfo(element),active=uiSrefActive[1]||uiSrefActive[0],unlinkInfoFn=null,rawDef={},getDef=function(){return processedDef($state,element,rawDef)},inputAttrs=["uiState","uiStateParams","uiStateOpts"],watchDeregFns=inputAttrs.reduce(function(acc,attr){return acc[attr]=noop,acc},{});inputAttrs.forEach(function(field){rawDef[field]=attrs[field]?scope.$eval(attrs[field]):null,attrs.$observe(field,function(expr){watchDeregFns[field](),watchDeregFns[field]=scope.$watch(expr,function(newval){rawDef[field]=newval,update()},!0)})}),update(),scope.$on("$destroy",$uiRouter.stateRegistry.onStatesChanged(update)),scope.$on("$destroy",$uiRouter.transitionService.onSuccess({},update)),type.clickable&&(hookFn=clickHook(element,$state,$timeout,type,getDef),bindEvents(element,scope,hookFn,rawDef.uiStateOpts))}}}];var uiSrefActiveDirective;uiSrefActiveDirective=["$state","$stateParams","$interpolate","$uiRouter",function($state,$stateParams,$interpolate,$uiRouter){return{restrict:"A",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){function updateAfterTransition(trans){trans.promise.then(update,noop)}function setStatesFromDefinitionObject(statesDefinition){isObject(statesDefinition)&&(states=[],forEach(statesDefinition,function(stateOrName,activeClass){var addStateForClass=function(stateOrName,activeClass){var ref=parseStateRef(stateOrName);addState(ref.state,$scope.$eval(ref.paramExpr),activeClass)};isString(stateOrName)?addStateForClass(stateOrName,activeClass):isArray(stateOrName)&&forEach(stateOrName,function(stateOrName){addStateForClass(stateOrName,activeClass)})}))}function addState(stateName,stateParams,activeClass){var stateInfo={state:$state.get(stateName,stateContext($element))||{name:stateName},params:stateParams,activeClass:activeClass};return states.push(stateInfo),function(){removeFrom(states)(stateInfo)}}function update(){var splitClasses=function(str){return str.split(/\s/).filter(identity)},getClasses=function(stateList){return stateList.map(function(x){return x.activeClass}).map(splitClasses).reduce(unnestR,[])},allClasses=getClasses(states).concat(splitClasses(activeEqClass)).reduce(uniqR,[]),fuzzyClasses=getClasses(states.filter(function(x){return $state.includes(x.state.name,x.params)})),exactClasses=!!states.filter(function(x){return $state.is(x.state.name,x.params)}).length?splitClasses(activeEqClass):[],addClasses=fuzzyClasses.concat(exactClasses).reduce(uniqR,[]),removeClasses=allClasses.filter(function(cls){return!inArray(addClasses,cls)});$scope.$evalAsync(function(){addClasses.forEach(function(className){return $element.addClass(className)}),removeClasses.forEach(function(className){return $element.removeClass(className)})})}var activeEqClass,uiSrefActive,states=[];activeEqClass=$interpolate($attrs.uiSrefActiveEq||"",!1)($scope);try{uiSrefActive=$scope.$eval($attrs.uiSrefActive)}catch(e){}setStatesFromDefinitionObject(uiSrefActive=uiSrefActive||$interpolate($attrs.uiSrefActive||"",!1)($scope)),this.$$addStateInfo=function(newState,newParams){if(!(isObject(uiSrefActive)&&states.length>0)){var deregister=addState(newState,newParams,uiSrefActive);return update(),deregister}},$scope.$on("$destroy",function(){var deregisterStatesChangedListener=$uiRouter.stateRegistry.onStatesChanged(function(){setStatesFromDefinitionObject(uiSrefActive)}),deregisterOnStartListener=$uiRouter.transitionService.onStart({},updateAfterTransition),deregisterStateChangeSuccessListener=$scope.$on("$stateChangeSuccess",update);return function(){deregisterStatesChangedListener(),deregisterOnStartListener(),deregisterStateChangeSuccessListener()}}()),$uiRouter.globals.transition&&updateAfterTransition($uiRouter.globals.transition),update()}]}}],ng.module("ui.router.state").directive("uiSref",uiSrefDirective).directive("uiSrefActive",uiSrefActiveDirective).directive("uiSrefActiveEq",uiSrefActiveDirective).directive("uiState",uiStateDirective),$IsStateFilter.$inject=["$state"],$IncludedByStateFilter.$inject=["$state"],ng.module("ui.router.state").filter("isState",$IsStateFilter).filter("includedByState",$IncludedByStateFilter);var uiView;uiView=["$view","$animate","$uiViewScroll","$interpolate","$q",function($view,$animate,$uiViewScroll,$interpolate,$q$$1){var rootData={$cfg:{viewDecl:{$context:$view._pluginapi._rootViewContext()}},$uiView:{}},directive={count:0,restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(tElement,tAttrs,$transclude){return function(scope,$element,attrs){function updateView(config){var newScope=scope.$new(),animEnter=$q$$1.defer(),animLeave=$q$$1.defer(),$uiViewData={$cfg:config,$uiView:activeUIView},$uiViewAnim={$animEnter:animEnter.promise,$animLeave:animLeave.promise,$$animLeave:animLeave};newScope.$emit("$viewContentLoading",name);var cloned=$transclude(newScope,function(clone){clone.data("$uiViewAnim",$uiViewAnim),clone.data("$uiView",$uiViewData),renderer.enter(clone,$element,function(){animEnter.resolve(),currentScope&&currentScope.$emit("$viewContentAnimationEnded"),(isDefined(autoScrollExp)&&!autoScrollExp||scope.$eval(autoScrollExp))&&$uiViewScroll(clone)}),function(){if(previousEl&&(trace.traceUIViewEvent("Removing (previous) el",previousEl.data("$uiView")),previousEl.remove(),previousEl=null),currentScope&&(trace.traceUIViewEvent("Destroying scope",activeUIView),currentScope.$destroy(),currentScope=null),currentEl){var _viewData_1=currentEl.data("$uiViewAnim");trace.traceUIViewEvent("Animate out",_viewData_1),renderer.leave(currentEl,function(){_viewData_1.$$animLeave.resolve(),previousEl=null}),previousEl=currentEl,currentEl=null}}()});currentEl=cloned,(currentScope=newScope).$emit("$viewContentLoaded",config||viewConfig),currentScope.$eval(onloadExp)}var previousEl,currentEl,currentScope,viewConfig,unregister,onloadExp=attrs.onload||"",autoScrollExp=attrs.autoscroll,renderer={enter:function(element,target,cb){ng.version.minor>2?$animate.enter(element,null,target).then(cb):$animate.enter(element,null,target,cb)},leave:function(element,cb){ng.version.minor>2?$animate.leave(element).then(cb):$animate.leave(element,cb)}},inherited=$element.inheritedData("$uiView")||rootData,name=$interpolate(attrs.uiView||attrs.name||"")(scope)||"$default",activeUIView={$type:"ng1",id:directive.count++,name:name,fqn:inherited.$uiView.fqn?inherited.$uiView.fqn+"."+name:name,config:null,configUpdated:function(config){(!config||config instanceof Ng1ViewConfig)&&(viewConfig===config||(trace.traceUIViewConfigUpdated(activeUIView,config&&config.viewDecl&&config.viewDecl.$context),viewConfig=config,updateView(config)))},get creationContext(){var fromParentTagConfig=parse("$cfg.viewDecl.$context")(inherited),fromParentTag=parse("$uiView.creationContext")(inherited);return fromParentTagConfig||fromParentTag}};trace.traceUIViewEvent("Linking",activeUIView),$element.data("$uiView",{$uiView:activeUIView}),updateView(),unregister=$view.registerUIView(activeUIView),scope.$on("$destroy",function(){trace.traceUIViewEvent("Destroying/Unregistering",activeUIView),unregister()})}}};return directive}],$ViewDirectiveFill.$inject=["$compile","$controller","$transitions","$view","$q","$timeout"];var hasComponentImpl="function"==typeof ng.module("ui.router").component,_uiCanExitId=0;ng.module("ui.router.state").directive("uiView",uiView),ng.module("ui.router.state").directive("uiView",$ViewDirectiveFill),ng.module("ui.router.state").provider("$uiViewScroll",function(){var useAnchorScroll=!1;this.useAnchorScroll=function(){useAnchorScroll=!0},this.$get=["$anchorScroll","$timeout",function($anchorScroll,$timeout){return useAnchorScroll?$anchorScroll:function($element){return $timeout(function(){$element[0].scrollIntoView()},0,!1)}}]});exports.default="ui.router",exports.core=index,exports.watchDigests=watchDigests,exports.getLocals=getLocals,exports.getNg1ViewConfigFactory=getNg1ViewConfigFactory,exports.ng1ViewsBuilder=ng1ViewsBuilder,exports.Ng1ViewConfig=Ng1ViewConfig,exports.StateProvider=StateProvider,exports.UrlRouterProvider=UrlRouterProvider,exports.root=root,exports.fromJson=fromJson,exports.toJson=toJson,exports.forEach=forEach,exports.extend=extend,exports.equals=equals,exports.identity=identity,exports.noop=noop,exports.createProxyFunctions=createProxyFunctions,exports.inherit=inherit,exports.inArray=inArray,exports._inArray=_inArray,exports.removeFrom=removeFrom,exports._removeFrom=_removeFrom,exports.pushTo=pushTo,exports._pushTo=_pushTo,exports.deregAll=deregAll,exports.defaults=defaults,exports.mergeR=mergeR,exports.ancestors=ancestors,exports.pick=pick,exports.omit=omit,exports.pluck=pluck,exports.filter=filter,exports.find=find,exports.mapObj=mapObj,exports.map=map,exports.values=values,exports.allTrueR=allTrueR,exports.anyTrueR=anyTrueR,exports.unnestR=unnestR,exports.flattenR=flattenR,exports.pushR=pushR,exports.uniqR=uniqR,exports.unnest=unnest,exports.flatten=flatten,exports.assertPredicate=assertPredicate,exports.assertMap=assertMap,exports.assertFn=assertFn,exports.pairs=pairs,exports.arrayTuples=arrayTuples,exports.applyPairs=applyPairs,exports.tail=tail,exports.copy=copy,exports._extend=_extend,exports.silenceUncaughtInPromise=silenceUncaughtInPromise,exports.silentRejection=silentRejection,exports.makeStub=makeStub,exports.services=services,exports.Glob=Glob,exports.curry=curry,exports.compose=compose,exports.pipe=pipe,exports.prop=prop,exports.propEq=propEq,exports.parse=parse,exports.not=not,exports.and=and,exports.or=or,exports.all=all,exports.any=any,exports.is=is,exports.eq=eq,exports.val=val,exports.invoke=invoke,exports.pattern=pattern,exports.isUndefined=isUndefined,exports.isDefined=isDefined,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isFunction=isFunction,exports.isNumber=isNumber,exports.isString=isString,exports.isObject=isObject,exports.isArray=isArray,exports.isDate=isDate,exports.isRegExp=isRegExp,exports.isInjectable=isInjectable,exports.isPromise=isPromise,exports.Queue=Queue,exports.maxLength=maxLength,exports.padString=padString,exports.kebobString=kebobString,exports.functionToString=functionToString,exports.fnToString=fnToString,exports.stringify=stringify,exports.beforeAfterSubstr=beforeAfterSubstr,exports.hostRegex=hostRegex,exports.stripLastPathElement=stripLastPathElement,exports.splitHash=splitHash,exports.splitQuery=splitQuery,exports.splitEqual=splitEqual,exports.trimHashVal=trimHashVal,exports.splitOnDelim=splitOnDelim,exports.joinNeighborsR=joinNeighborsR,exports.Trace=Trace,exports.trace=trace,exports.Param=Param,exports.ParamTypes=ParamTypes,exports.StateParams=StateParams,exports.ParamType=ParamType,exports.PathNode=PathNode,exports.PathUtils=PathUtils,exports.resolvePolicies=resolvePolicies,exports.defaultResolvePolicy=defaultResolvePolicy,exports.Resolvable=Resolvable,exports.NATIVE_INJECTOR_TOKEN=NATIVE_INJECTOR_TOKEN,exports.ResolveContext=ResolveContext,exports.resolvablesBuilder=resolvablesBuilder,exports.StateBuilder=StateBuilder,exports.StateObject=StateObject,exports.StateMatcher=StateMatcher,exports.StateQueueManager=StateQueueManager,exports.StateRegistry=StateRegistry,exports.StateService=StateService,exports.TargetState=TargetState,exports.HookBuilder=HookBuilder,exports.matchState=matchState,exports.RegisteredHook=RegisteredHook,exports.makeEvent=makeEvent,exports.Rejection=Rejection,exports.Transition=Transition,exports.TransitionHook=TransitionHook,exports.TransitionEventType=TransitionEventType,exports.defaultTransOpts=defaultTransOpts,exports.TransitionService=TransitionService,exports.UrlRules=UrlRules,exports.UrlConfig=UrlConfig,exports.UrlMatcher=UrlMatcher,exports.ParamFactory=ParamFactory,exports.UrlMatcherFactory=UrlMatcherFactory,exports.UrlRouter=UrlRouter,exports.UrlRuleFactory=UrlRuleFactory,exports.BaseUrlRule=BaseUrlRule,exports.UrlService=UrlService,exports.ViewService=ViewService,exports.UIRouterGlobals=UIRouterGlobals,exports.UIRouter=UIRouter,exports.$q=$q,exports.$injector=$injector,exports.BaseLocationServices=BaseLocationServices,exports.HashLocationService=HashLocationService,exports.MemoryLocationService=MemoryLocationService,exports.PushStateLocationService=PushStateLocationService,exports.MemoryLocationConfig=MemoryLocationConfig,exports.BrowserLocationConfig=BrowserLocationConfig,exports.keyValsToObjectR=keyValsToObjectR,exports.getParams=getParams,exports.parseUrl=parseUrl$1,exports.buildUrl=buildUrl,exports.locationPluginFactory=locationPluginFactory,exports.servicesPlugin=servicesPlugin,exports.hashLocationPlugin=hashLocationPlugin,exports.pushStateLocationPlugin=pushStateLocationPlugin,exports.memoryLocationPlugin=memoryLocationPlugin,exports.UIRouterPluginBase=UIRouterPluginBase,Object.defineProperty(exports,"__esModule",{value:!0})}),angular.module("afkl.lazyImage",[]),angular.module("afkl.lazyImage").service("afklSrcSetService",["$window",function($window){"use strict";function ImageInfo(options){this.src=options.src,this.w=options.w||1/0,this.h=options.h||1/0,this.x=options.x||1}var INT_REGEXP=/^[0-9]+$/,_getBestCandidateIf=function(images,criteriaFn){for(var bestCandidate=images[0],i=0,l=images.length;i<l;i++){var candidate=images[i];criteriaFn(candidate,bestCandidate)&&(bestCandidate=candidate)}return bestCandidate},_removeCandidatesIf=function(images,criteriaFn){for(var i=images.length-1;i>=0;i--){criteriaFn(images[i])&&images.splice(i,1)}return images},getBestImage=function(imageCandidates,view){if(imageCandidates){view||(view={w:$window.innerWidth||document.documentElement.clientWidth,h:$window.innerHeight||document.documentElement.clientHeight,x:$window.devicePixelRatio||1});var images=imageCandidates.slice(0),largestWidth=_getBestCandidateIf(images,function(a,b){return a.w>b.w});_removeCandidatesIf(images,function(a){return a.w<view.w}),0===images.length&&(images=[largestWidth]);var largestHeight=_getBestCandidateIf(images,function(a,b){return a.h>b.h});_removeCandidatesIf(images,function(a){return a.h<view.h}),0===images.length&&(images=[largestHeight]);var largestPxDensity=_getBestCandidateIf(images,function(a,b){return a.x>b.x});_removeCandidatesIf(images,function(a){return a.x<view.x}),0===images.length&&(images=[largestPxDensity]);var smallestWidth=_getBestCandidateIf(images,function(a,b){return a.w<b.w});_removeCandidatesIf(images,function(a){return a.w>smallestWidth.w});var smallestHeight=_getBestCandidateIf(images,function(a,b){return a.h<b.h});_removeCandidatesIf(images,function(a){return a.h>smallestHeight.h});var smallestPxDensity=_getBestCandidateIf(images,function(a,b){return a.x<b.x});return _removeCandidatesIf(images,function(a){return a.x>smallestPxDensity.x}),images[0]}};return{get:function(options){var imageCandidates=[],srcValue=options.src,srcsetValue=options.srcset;if(srcsetValue){var _addCandidate=function(img){for(var j=0,ln=imageCandidates.length;j<ln;j++){var existingCandidate=imageCandidates[j];if(existingCandidate.x===img.x&&existingCandidate.w===img.w&&existingCandidate.h===img.h)return}imageCandidates.push(img)};!function(){for(var url,descriptors,input=srcsetValue,position=0,rawCandidates=[];""!==input;){for(;" "===input.charAt(0);)input=input.slice(1);-1!==(position=input.indexOf(" "))?(url=input.slice(0,position),-1===(position=(input=input.slice(position+1)).indexOf(","))?(descriptors=input,input=""):(descriptors=input.slice(0,position),input=input.slice(position+1)),rawCandidates.push({url:url,descriptors:descriptors})):(rawCandidates.push({url:input,descriptors:""}),input="")}for(var i=0,l=rawCandidates.length;i<l;i++){var candidate=rawCandidates[i],desc=function(descString){for(var descriptors=candidate.descriptors.split(/\s/),out={},i=0,l=descriptors.length;i<l;i++){var desc=descriptors[i];if(desc.length>0){var lastChar=desc.slice(-1),value=desc.substring(0,desc.length-1),intVal=parseInt(value,10),floatVal=parseFloat(value);value.match(INT_REGEXP)&&"w"===lastChar?out[lastChar]=intVal:value.match(INT_REGEXP)&&"h"===lastChar?out[lastChar]=intVal:isNaN(floatVal)||"x"!==lastChar||(out[lastChar]=floatVal)}}return out}();_addCandidate(new ImageInfo({src:candidate.url,x:desc.x,w:desc.w,h:desc.h}))}srcValue&&_addCandidate(new ImageInfo({src:srcValue}))}();var object={best:getBestImage(imageCandidates),candidates:imageCandidates};return imageCandidates=null,object}},image:getBestImage,throttle:function(callback,delay){var wait=!1;return function(){wait||(callback.call(),wait=!0,setTimeout(function(){wait=!1},delay))}}}}]),angular.module("afkl.lazyImage").directive("afklImageContainer",function(){"use strict";return{restrict:"A",controller:["$scope","$element",function($scope,$element){$element.data("afklImageContainer",$element)}]}}).directive("afklLazyImage",["$rootScope","$window","$timeout","afklSrcSetService","$parse",function($rootScope,$window,$timeout,srcSetService,$parse){"use strict";var bestImage=function(images){var sourceUrl,image=srcSetService.get({srcset:images});return image&&(sourceUrl=image.best.src),sourceUrl};return{restrict:"A",link:function(scope,element,attrs){var $container=element.inheritedData("afklImageContainer");$container||($container=angular.element(attrs.afklLazyImageContainer||$window));var timeout,loaded=!1,images=attrs.afklLazyImage,options=attrs.afklLazyImageOptions?$parse(attrs.afklLazyImageOptions)(scope):{},img=null,currentImage=null,offset=options.offset?options.offset:50,imgAttrs=function(imgAttrs){var result=[],setClass=!1;return options.imgAttrs&&(result=Array.prototype.map.call(imgAttrs,function(item){for(var key in item)if(item.hasOwnProperty(key)){var value=item[key];return"class"===key&&(setClass=!0,value+=" afkl-lazy-image"),String.prototype.concat.call(key,'="',value,'"')}})),setClass||result.push('class="afkl-lazy-image"'),result.join(" ")}(options.imgAttrs),LOADING="afkl-lazy-image-loading";attrs.afklLazyImageLoaded=!1;var _containerScrollTop=function(){if($container.scrollTop){var scrollTopPosition=$container.scrollTop();if(scrollTopPosition)return scrollTopPosition}var c=$container[0];return void 0!==c.pageYOffset?c.pageYOffset:void 0!==c.scrollTop?c.scrollTop:document.documentElement.scrollTop||0},_placeImage=function(){loaded=!0;bestImage(images)&&(options.background||img||(element.addClass(LOADING),(img=angular.element("<img "+imgAttrs+" />")).one("load",_loaded),img.one("error",_error),element.append(img)),_checkIfNewImage()),$container.off("scroll",_onViewChange)},_checkIfNewImage=function(){if(loaded){var newImage=bestImage(images);newImage!==currentImage&&(currentImage=newImage,options.background?element[0].style.backgroundImage='url("'+currentImage+'")':img&&(img[0].src=currentImage))}};_checkIfNewImage();var _loaded=function(){attrs.$set("afklLazyImageLoaded","done"),element.removeClass(LOADING)},_error=function(){attrs.$set("afklLazyImageLoaded","fail")},_onViewChange=function(){if(!loaded){var height=function(){if($container.innerHeight)return $container.innerHeight();var c=$container[0];return void 0!==c.innerHeight?c.innerHeight:void 0!==c.clientHeight?c.clientHeight:document.documentElement.clientHeight||0}(),scroll=_containerScrollTop();($container[0]===$window?function(){if(element.offset)return element.offset().top;return element[0].getBoundingClientRect().top+_containerScrollTop()-document.documentElement.clientTop}():element.offset?element.offset().top-$container.offset().top:element[0].getBoundingClientRect().top-$container[0].getBoundingClientRect().top)-($container[0]===$window?height+scroll:height)<=offset&&_placeImage()}},_onViewChangeThrottled=srcSetService.throttle(_onViewChange,300),_onResize=function(){$timeout.cancel(timeout),timeout=$timeout(function(){_checkIfNewImage(),_onViewChange()},300)};return angular.element($window).on("resize",_onResize),angular.element($window).on("scroll",_onViewChangeThrottled),$container[0]!==$window&&($container.on("resize",_onResize),$container.on("scroll",_onViewChangeThrottled)),attrs.$observe("afklLazyImage",function(){images=attrs.afklLazyImage,loaded&&_placeImage()}),options.nolazy&&_placeImage(),scope.$on("afkl.lazyImage.destroyed",_onResize),scope.$on("$destroy",function(){return $rootScope.$broadcast("afkl.lazyImage.destroyed"),$timeout.cancel(timeout),angular.element($window).off("resize",_onResize),angular.element($window).off("scroll",_onViewChangeThrottled),$container[0]!==$window&&($container.off("resize",_onResize),$container.off("scroll",_onViewChangeThrottled)),img&&img.remove(),void(img=timeout=currentImage=void 0)}),_onViewChange()}}}]),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).io=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_("./socket"),module.exports.parser=_dereq_("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(_dereq_,module,exports){(function(global){function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{},uri&&"object"==typeof uri&&(opts=uri,uri=null),uri?(uri=parseuri(uri),opts.hostname=uri.host,opts.secure="https"==uri.protocol||"wss"==uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)):opts.host&&(opts.hostname=parseuri(opts.host).host),this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol,opts.hostname&&!opts.port&&(opts.port=this.secure?"443":"80"),this.agent=opts.agent||!1,this.hostname=opts.hostname||(global.location?location.hostname:"localhost"),this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=opts.query||{},"string"==typeof this.query&&(this.query=parseqs.decode(this.query)),this.upgrade=!1!==opts.upgrade,this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!opts.forceJSONP,this.jsonp=!1!==opts.jsonp,this.forceBase64=!!opts.forceBase64,this.enablesXDR=!!opts.enablesXDR,this.timestampParam=opts.timestampParam||"t",this.timestampRequests=opts.timestampRequests,this.transports=opts.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=opts.policyPort||843,this.rememberUpgrade=opts.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades,this.perMessageDeflate=!1!==opts.perMessageDeflate&&(opts.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=opts.pfx||null,this.key=opts.key||null,this.passphrase=opts.passphrase||null,this.cert=opts.cert||null,this.ca=opts.ca||null,this.ciphers=opts.ciphers||null,this.rejectUnauthorized=void 0===opts.rejectUnauthorized||opts.rejectUnauthorized;var freeGlobal="object"==typeof global&&global;freeGlobal.global===freeGlobal&&opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0&&(this.extraHeaders=opts.extraHeaders),this.open()}var transports=_dereq_("./transports"),Emitter=_dereq_("component-emitter"),debug=_dereq_("debug")("engine.io-client:socket"),index=_dereq_("indexof"),parser=_dereq_("engine.io-parser"),parseuri=_dereq_("parseuri"),parsejson=_dereq_("parsejson"),parseqs=_dereq_("parseqs");module.exports=Socket,Socket.priorWebsocketSuccess=!1,Emitter(Socket.prototype),Socket.protocol=parser.protocol,Socket.Socket=Socket,Socket.Transport=_dereq_("./transport"),Socket.transports=_dereq_("./transports"),Socket.parser=_dereq_("engine.io-parser"),Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=function(obj){var o={};for(var i in obj)obj.hasOwnProperty(i)&&(o[i]=obj[i]);return o}(this.query);query.EIO=parser.protocol,query.transport=name,this.id&&(query.sid=this.id);return new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))transport="websocket";else{if(0===this.transports.length){var self=this;return void setTimeout(function(){self.emit("error","No transports available")},0)}transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){return this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)},Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=transport,transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})},Socket.prototype.probe=function(name){function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}failed||(debug('probe transport "%s" opened',name),transport.send([{type:"ping",data:"probe"}]),transport.once("packet",function(msg){if(!failed)if("pong"==msg.type&&"probe"==msg.data){if(debug('probe transport "%s" pong',name),self.upgrading=!0,self.emit("upgrading",transport),!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name,debug('pausing current transport "%s"',self.transport.name),self.transport.pause(function(){failed||"closed"!=self.readyState&&(debug("changing transport and sending upgrade packet"),cleanup(),self.setTransport(transport),transport.send([{type:"upgrade"}]),self.emit("upgrade",transport),transport=null,self.upgrading=!1,self.flush())})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name,self.emit("upgradeError",err)}}))}function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),debug('probe transport "%s" failed because of error: %s',name,err),self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!=transport.name&&(debug('"%s" works - aborting "%s"',to.name,transport.name),freezeTransport())}function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),self.removeListener("close",onclose),self.removeListener("upgrading",onupgrade)}debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=!1,self=this;Socket.priorWebsocketSuccess=!1,transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()},Socket.prototype.onOpen=function(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++)this.probe(this.upgrades[i])}},Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState)switch(debug('socket receive: type "%s", data "%s"',packet.type,packet.data),this.emit("packet",packet),this.emit("heartbeat"),packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var err=new Error("server error");err.code=packet.data,this.onError(err);break;case"message":this.emit("data",packet.data),this.emit("message",packet.data)}else debug('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(data){this.emit("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){"closed"!=self.readyState&&self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)},Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer),self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout),self.ping(),self.onHeartbeat(self.pingTimeout)},self.pingInterval)},Socket.prototype.ping=function(){var self=this;this.sendPacket("ping",function(){self.emit("ping")})},Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){return this.sendPacket("message",msg,options,fn),this},Socket.prototype.sendPacket=function(type,data,options,fn){if("function"==typeof data&&(fn=data,data=void 0),"function"==typeof options&&(fn=options,options=null),"closing"!=this.readyState&&"closed"!=this.readyState){(options=options||{}).compress=!1!==options.compress;var packet={type:type,data:data,options:options};this.emit("packetCreate",packet),this.writeBuffer.push(packet),fn&&this.once("flush",fn),this.flush()}},Socket.prototype.close=function(){function close(){self.onClose("forced close"),debug("socket closing - telling transport to close"),self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose),self.removeListener("upgradeError",cleanupAndClose),close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose),self.once("upgradeError",cleanupAndClose)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()}return this},Socket.prototype.onError=function(err){debug("socket error %j",err),Socket.priorWebsocketSuccess=!1,this.emit("error",err),this.onClose("transport error",err)},Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",reason,desc),this.writeBuffer=[],this.prevBufferLen=0}},Socket.prototype.filterUpgrades=function(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;i<j;i++)~index(this.transports,upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){function Transport(opts){this.path=opts.path,this.hostname=opts.hostname,this.port=opts.port,this.secure=opts.secure,this.query=opts.query,this.timestampParam=opts.timestampParam,this.timestampRequests=opts.timestampRequests,this.readyState="",this.agent=opts.agent||!1,this.socket=opts.socket,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized,this.extraHeaders=opts.extraHeaders}var parser=_dereq_("engine.io-parser"),Emitter=_dereq_("component-emitter");module.exports=Transport,Emitter(Transport.prototype),Transport.prototype.onError=function(msg,desc){var err=new Error(msg);return err.type="TransportError",err.description=desc,this.emit("error",err),this},Transport.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},Transport.prototype.send=function(packets){if("open"!=this.readyState)throw new Error("Transport not open");this.write(packets)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)},Transport.prototype.onPacket=function(packet){this.emit("packet",packet)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest-ssl"),XHR=_dereq_("./polling-xhr"),JSONP=_dereq_("./polling-jsonp"),websocket=_dereq_("./websocket");exports.polling=function(opts){var xd=!1,xs=!1,jsonp=!1!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),xd=opts.hostname!=location.hostname||port!=opts.port,xs=opts.secure!=isSSL}if(opts.xdomain=xd,opts.xscheme=xs,"open"in new XMLHttpRequest(opts)&&!opts.forceJSONP)return new XHR(opts);if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)},exports.websocket=websocket}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(_dereq_,module,exports){(function(global){function JSONPPolling(opts){Polling.call(this,opts),this.query=this.query||{},callbacks||(global.___eio||(global.___eio=[]),callbacks=global.___eio),this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){self.script&&(self.script.onerror=function(){})},!1)}var Polling=_dereq_("./polling"),inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var callbacks,rNewline=/\n/g,rEscapedNewline=/\\n/g;inherit(JSONPPolling,Polling),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Polling.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var self=this,script=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.uri(),script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt?insertAt.parentNode.insertBefore(script,insertAt):(document.head||document.body).appendChild(script),this.script=script;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype.doWrite=function(data,fn){function complete(){initIframe(),fn()}function initIframe(){if(self.iframe)try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){(iframe=document.createElement("iframe")).name=self.iframeId,iframe.src="javascript:0"}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var self=this;if(!this.form){var iframe,form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="eio_iframe_"+this.index;form.className="socketio",form.style.position="absolute",form.style.top="-1000px",form.style.left="-1000px",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area}this.form.action=this.uri(),initIframe(),data=data.replace(rEscapedNewline,"\\\n"),this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==self.iframe.readyState&&complete()}:this.iframe.onload=complete}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-inherit":16}],7:[function(_dereq_,module,exports){(function(global){function empty(){}function XHR(opts){if(Polling.call(this,opts),global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),this.xd=opts.hostname!=global.location.hostname||port!=opts.port,this.xs=opts.secure!=isSSL}else this.extraHeaders=opts.extraHeaders}function Request(opts){this.method=opts.method||"GET",this.uri=opts.uri,this.xd=!!opts.xd,this.xs=!!opts.xs,this.async=!1!==opts.async,this.data=void 0!=opts.data?opts.data:null,this.agent=opts.agent,this.isBinary=opts.isBinary,this.supportsBinary=opts.supportsBinary,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized,this.extraHeaders=opts.extraHeaders,this.create()}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}var XMLHttpRequest=_dereq_("xmlhttprequest-ssl"),Polling=_dereq_("./polling"),Emitter=_dereq_("component-emitter"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR,module.exports.Request=Request,inherit(XHR,Polling),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(opts){return opts=opts||{},opts.uri=this.uri(),opts.xd=this.xd,opts.xs=this.xs,opts.agent=this.agent||!1,opts.supportsBinary=this.supportsBinary,opts.enablesXDR=this.enablesXDR,opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,opts.extraHeaders=this.extraHeaders,new Request(opts)},XHR.prototype.doWrite=function(data,fn){var isBinary="string"!=typeof data&&void 0!==data,req=this.request({method:"POST",data:data,isBinary:isBinary}),self=this;req.on("success",fn),req.on("error",function(err){self.onError("xhr post error",err)}),this.sendXhr=req},XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request(),self=this;req.on("data",function(data){self.onData(data)}),req.on("error",function(err){self.onError("xhr poll error",err)}),this.pollXhr=req},Emitter(Request.prototype),Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts),self=this;try{debug("xhr open %s: %s",this.method,this.uri),xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(!0);for(var i in this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this.extraHeaders[i])}}catch(e){}if(this.supportsBinary&&(xhr.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?xhr.setRequestHeader("Content-type","application/octet-stream"):xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=!0),this.hasXDR()?(xhr.onload=function(){self.onLoad()},xhr.onerror=function(){self.onError(xhr.responseText)}):xhr.onreadystatechange=function(){4==xhr.readyState&&(200==xhr.status||1223==xhr.status?self.onLoad():setTimeout(function(){self.onError(xhr.status)},0))},debug("xhr data %s",this.data),xhr.send(this.data)}catch(e){return void setTimeout(function(){self.onError(e)},0)}global.document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(data){this.emit("data",data),this.onSuccess()},Request.prototype.onError=function(err){this.emit("error",err),this.cleanup(!0)},Request.prototype.cleanup=function(fromError){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=empty:this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}global.document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===contentType)data=this.xhr.response;else if(this.supportsBinary)try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){for(var ui8Arr=new Uint8Array(this.xhr.response),dataArray=[],idx=0,length=ui8Arr.length;idx<length;idx++)dataArray.push(ui8Arr[idx]);data=String.fromCharCode.apply(null,dataArray)}else data=this.xhr.responseText}catch(e){this.onError(e)}null!=data&&this.onData(data)},Request.prototype.hasXDR=function(){return void 0!==global.XDomainRequest&&!this.xs&&this.enablesXDR},Request.prototype.abort=function(){this.cleanup()},global.document&&(Request.requestsCount=0,Request.requests={},global.attachEvent?global.attachEvent("onunload",unloadHandler):global.addEventListener&&global.addEventListener("beforeunload",unloadHandler,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(_dereq_,module,exports){function Polling(opts){var forceBase64=opts&&opts.forceBase64;hasXHR2&&!forceBase64||(this.supportsBinary=!1),Transport.call(this,opts)}var Transport=_dereq_("../transport"),parseqs=_dereq_("parseqs"),parser=_dereq_("engine.io-parser"),inherit=_dereq_("component-inherit"),yeast=_dereq_("yeast"),debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=null!=new(_dereq_("xmlhttprequest-ssl"))({xdomain:!1}).responseType;inherit(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(onPause){function pause(){debug("paused"),self.readyState="paused",onPause()}var self=this;if(this.readyState="pausing",this.polling||!this.writable){var total=0;this.polling&&(debug("we are currently polling - waiting to pause"),total++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--total||pause()})),this.writable||(debug("we are currently writing - waiting to pause"),total++,this.once("drain",function(){debug("pre-pause writing complete"),--total||pause()}))}else pause()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);parser.decodePayload(data,this.socket.binaryType,function(packet,index,total){if("opening"==self.readyState&&self.onOpen(),"close"==packet.type)return self.onClose(),!1;self.onPacket(packet)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){function close(){debug("writing close packet"),self.write([{type:"close"}])}var self=this;"open"==this.readyState?(debug("transport open - closing"),close()):(debug("transport not open - deferring close"),this.once("open",close))},Polling.prototype.write=function(packets){self=this;this.writable=!1;var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,function(){self.writable=!0,self.emit("drain")})})},Polling.prototype.uri=function(){var query=this.query||{},schema=this.secure?"https":"http",port="";!1!==this.timestampRequests&&(query[this.timestampParam]=yeast()),this.supportsBinary||query.sid||(query.b64=1),query=parseqs.encode(query),this.port&&("https"==schema&&443!=this.port||"http"==schema&&80!=this.port)&&(port=":"+this.port),query.length&&(query="?"+query);return schema+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+port+this.path+query}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){function WS(opts){opts&&opts.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=opts.perMessageDeflate,Transport.call(this,opts)}var Transport=_dereq_("../transport"),parser=_dereq_("engine.io-parser"),parseqs=_dereq_("parseqs"),inherit=_dereq_("component-inherit"),yeast=_dereq_("yeast"),debug=_dereq_("debug")("engine.io-client:websocket"),BrowserWebSocket=global.WebSocket||global.MozWebSocket,WebSocket=BrowserWebSocket;if(!WebSocket&&"undefined"==typeof window)try{WebSocket=_dereq_("ws")}catch(e){}module.exports=WS,inherit(WS,Transport),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var uri=this.uri(),opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(opts.headers=this.extraHeaders),this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,void 0,opts),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()},this.ws.onclose=function(){self.onClose()},this.ws.onmessage=function(ev){self.onData(ev.data)},this.ws.onerror=function(e){self.onError("websocket error",e)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}),WS.prototype.write=function(packets){var self=this;this.writable=!1;for(var total=packets.length,i=0,l=total;i<l;i++)!function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options&&(opts.compress=packet.options.compress),self.perMessageDeflate){("string"==typeof data?global.Buffer.byteLength(data):data.length)<self.perMessageDeflate.threshold&&(opts.compress=!1)}}try{BrowserWebSocket?self.ws.send(data):self.ws.send(data,opts)}catch(e){debug("websocket closed before onclose event")}--total||(self.emit("flush"),setTimeout(function(){self.writable=!0,self.emit("drain")},0))})}(packets[i])},WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)},WS.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},WS.prototype.uri=function(){var query=this.query||{},schema=this.secure?"wss":"ws",port="";this.port&&("wss"==schema&&443!=this.port||"ws"==schema&&80!=this.port)&&(port=":"+this.port),this.timestampRequests&&(query[this.timestampParam]=yeast()),this.supportsBinary||(query.b64=1),(query=parseqs.encode(query)).length&&(query="?"+query);return schema+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+port+this.path+query},WS.prototype.check=function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===WS.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain,xscheme=opts.xscheme,enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR)return new XDomainRequest}catch(e){}if(!xdomain)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":22}],11:[function(_dereq_,module,exports){module.exports=function(count,callback,err_cb){function proxy(err,result){if(proxy.count<=0)throw new Error("after called too many times");--proxy.count,err?(bail=!0,callback(err),callback=err_cb):0!==proxy.count||bail||callback(null,result)}var bail=!1;return err_cb=err_cb||function(){},proxy.count=count,0===count?callback():proxy}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;if(start=start||0,end=end||bytes,arraybuffer.slice)return arraybuffer.slice(start,end);if(start<0&&(start+=bytes),end<0&&(end+=bytes),end>bytes&&(end=bytes),start>=bytes||start>=end||0===bytes)return new ArrayBuffer(0);for(var abv=new Uint8Array(arraybuffer),result=new Uint8Array(end-start),i=start,ii=0;i<end;i++,ii++)result[ii]=abv[i];return result.buffer}},{}],13:[function(_dereq_,module,exports){!function(chars){"use strict";exports.encode=function(arraybuffer){var i,bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="";for(i=0;i<len;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},exports.decode=function(base64){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=chars.indexOf(base64[i]),encoded2=chars.indexOf(base64[i+1]),encoded3=chars.indexOf(base64[i+2]),encoded4=chars.indexOf(base64[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(_dereq_,module,exports){(function(global){function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength)),buf=copy.buffer}ary[i]=buf}}}var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,blobSupported=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),blobSupportsArrayBufferView=blobSupported&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;module.exports=blobSupported?blobSupportsArrayBufferView?global.Blob:function(ary,options){return mapArrayBufferViews(ary),new Blob(ary,options||{})}:blobBuilderSupported?function(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++)bb.append(ary[i]);return options.type?bb.getBlob(options.type):bb.getBlob()}:void 0}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],15:[function(_dereq_,module,exports){function Emitter(obj){if(obj)return function(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}(obj)}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks[event]=this._callbacks[event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){self.off(event,on),fn.apply(this,arguments)}var self=this;return this._callbacks=this._callbacks||{},on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks[event],this;for(var cb,i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks)for(var i=0,len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args);return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks[event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype,a.prototype=new fn,a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){function load(){var r;try{r=exports.storage.debug}catch(e){}return r}(exports=module.exports=_dereq_("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},exports.formatArgs=function(){var args=arguments,useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return args;var c="color: "+this.color,index=0,lastC=0;return(args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1)))[0].replace(/%[a-z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c),args},exports.save=function(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}},exports.load=load,exports.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){return JSON.stringify(v)},exports.enable(load())},{"./debug":18}],18:[function(_dereq_,module,exports){(exports=module.exports=function(namespace){function disabled(){}function enabled(){var self=enabled,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,null==self.useColors&&(self.useColors=exports.useColors()),null==self.color&&self.useColors&&(self.color=exports.colors[prevColor++%exports.colors.length]);var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&(args=["%o"].concat(args));var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),"function"==typeof exports.formatArgs&&(args=exports.formatArgs.apply(self,args)),(enabled.log||exports.log||console.log.bind(console)).apply(self,args)}disabled.enabled=!1,enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;return fn.namespace=namespace,fn}).coerce=function(val){return val instanceof Error?val.stack||val.message:val},exports.disable=function(){exports.enable("")},exports.enable=function(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))},exports.enabled=function(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1},exports.humanize=_dereq_("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime,prevColor=0},{ms:25}],19:[function(_dereq_,module,exports){(function(global){function map(ary,each,done){for(var result=new Array(ary.length),next=after(ary.length,done),i=0;i<ary.length;i++)!function(i,el,cb){each(el,function(error,msg){result[i]=msg,cb(error,result)})}(i,ary[i],next)}var keys=_dereq_("./keys"),hasBinary=_dereq_("has-binary"),sliceBuffer=_dereq_("arraybuffer.slice"),base64encoder=_dereq_("base64-arraybuffer"),after=_dereq_("after"),utf8=_dereq_("utf8"),isAndroid=navigator.userAgent.match(/Android/i),isPhantomJS=/PhantomJS/i.test(navigator.userAgent),dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},packetslist=keys(packets),err={type:"error",data:"parser error"},Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=!1),"function"==typeof utf8encode&&(callback=utf8encode,utf8encode=null);var data=void 0===packet.data?void 0:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer)return function(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var data=packet.data,contentArray=new Uint8Array(data),resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++)resultBuffer[i+1]=contentArray[i];return callback(resultBuffer.buffer)}(packet,supportsBinary,callback);if(Blob&&data instanceof global.Blob)return function(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);if(dontSendBlobs)return function(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var fr=new FileReader;return fr.onload=function(){packet.data=fr.result,exports.encodePacket(packet,supportsBinary,!0,callback)},fr.readAsArrayBuffer(packet.data)}(packet,supportsBinary,callback);var length=new Uint8Array(1);return length[0]=packets[packet.type],callback(new Blob([length.buffer,packet.data]))}(packet,supportsBinary,callback);if(data&&data.base64)return function(packet,callback){return callback("b"+exports.packets[packet.type]+packet.data.data)}(packet,callback);var encoded=packets[packet.type];return void 0!==packet.data&&(encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)),callback(""+encoded)},exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;return fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)},fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){for(var typed=new Uint8Array(packet.data),basic=new Array(typed.length),i=0;i<typed.length;i++)basic[i]=typed[i];b64data=String.fromCharCode.apply(null,basic)}return message+=global.btoa(b64data),callback(message)},exports.decodePacket=function(data,binaryType,utf8decode){if("string"==typeof data||void 0===data){if("b"==data.charAt(0))return exports.decodeBase64Packet(data.substr(1),binaryType);if(utf8decode)try{data=utf8.decode(data)}catch(e){return err}type=data.charAt(0);return Number(type)==type&&packetslist[type]?data.length>1?{type:packetslist[type],data:data.substring(1)}:{type:packetslist[type]}:err}var type=new Uint8Array(data)[0],rest=sliceBuffer(data,1);return Blob&&"blob"===binaryType&&(rest=new Blob([rest])),{type:packetslist[type],data:rest}},exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer)return{type:type,data:{base64:!0,data:msg.substr(1)}};var data=base64encoder.decode(msg.substr(1));return"blob"===binaryType&&Blob&&(data=new Blob([data])),{type:type,data:data}},exports.encodePayload=function(packets,supportsBinary,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=null);var isBinary=hasBinary(packets);return supportsBinary&&isBinary?Blob&&!dontSendBlobs?exports.encodePayloadAsBlob(packets,callback):exports.encodePayloadAsArrayBuffer(packets,callback):packets.length?void map(packets,function(packet,doneCallback){exports.encodePacket(packet,!!isBinary&&supportsBinary,!0,function(message){doneCallback(null,function(message){return message.length+":"+message}(message))})},function(err,results){return callback(results.join(""))}):callback("0:")},exports.decodePayload=function(data,binaryType,callback){if("string"!=typeof data)return exports.decodePayloadAsBinary(data,binaryType,callback);"function"==typeof binaryType&&(callback=binaryType,binaryType=null);var packet;if(""==data)return callback(err,0,1);for(var n,msg,length="",i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"!=chr)length+=chr;else{if(""==length||length!=(n=Number(length)))return callback(err,0,1);if(msg=data.substr(i+1,n),length!=msg.length)return callback(err,0,1);if(msg.length){if(packet=exports.decodePacket(msg,binaryType,!0),err.type==packet.type&&err.data==packet.data)return callback(err,0,1);if(!1===callback(packet,i+n,l))return}i+=n,length=""}}return""!=length?callback(err,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length)return callback(new ArrayBuffer(0));map(packets,function(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(data){return doneCallback(null,data)})},function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;return len="string"==typeof p?p.length:p.byteLength,acc+len.toString().length+len+2},0),resultArray=new Uint8Array(totalLength),bufferIndex=0;return encodedPackets.forEach(function(p){var isString="string"==typeof p,ab=p;if(isString){for(var view=new Uint8Array(p.length),i=0;i<p.length;i++)view[i]=p.charCodeAt(i);ab=view.buffer}resultArray[bufferIndex++]=isString?0:1;for(var lenStr=ab.byteLength.toString(),i=0;i<lenStr.length;i++)resultArray[bufferIndex++]=parseInt(lenStr[i]);resultArray[bufferIndex++]=255;for(var view=new Uint8Array(ab),i=0;i<view.length;i++)resultArray[bufferIndex++]=view[i]}),callback(resultArray.buffer)})},exports.encodePayloadAsBlob=function(packets,callback){map(packets,function(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(encoded){var binaryIdentifier=new Uint8Array(1);if(binaryIdentifier[0]=1,"string"==typeof encoded){for(var view=new Uint8Array(encoded.length),i=0;i<encoded.length;i++)view[i]=encoded.charCodeAt(i);encoded=view.buffer,binaryIdentifier[0]=0}for(var lenStr=(encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size).toString(),lengthAry=new Uint8Array(lenStr.length+1),i=0;i<lenStr.length;i++)lengthAry[i]=parseInt(lenStr[i]);if(lengthAry[lenStr.length]=255,Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})},function(err,results){return callback(new Blob(results))})},exports.decodePayloadAsBinary=function(data,binaryType,callback){"function"==typeof binaryType&&(callback=binaryType,binaryType=null);for(var bufferTail=data,buffers=[],numberTooLong=!1;bufferTail.byteLength>0;){for(var tailArray=new Uint8Array(bufferTail),isString=0===tailArray[0],msgLength="",i=1;255!=tailArray[i];i++){if(msgLength.length>310){numberTooLong=!0;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length),msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString)try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(i=0;i<typed.length;i++)msg+=String.fromCharCode(typed[i])}buffers.push(msg),bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,!0),i,total)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function(obj){var arr=[],has=Object.prototype.hasOwnProperty;for(var i in obj)has.call(obj,i)&&arr.push(i);return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=function(data){function _hasBinary(obj){if(!obj)return!1;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File)return!0;if(isArray(obj)){for(var i=0;i<obj.length;i++)if(_hasBinary(obj[i]))return!0}else if(obj&&"object"==typeof obj){obj.toJSON&&(obj=obj.toJSON());for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key]))return!0}return!1}return _hasBinary(data)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(err){module.exports=!1}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],25:[function(_dereq_,module,exports){function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){return options=options||{},"string"==typeof val?function(str){if(!((str=""+str).length>1e4)){var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}(val):options.long?function(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}(val):function(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}(val)}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rtrimLeft=/^\s+/,rtrimRight=/\s+$/;module.exports=function(data){return"string"==typeof data&&data?(data=data.replace(rtrimLeft,"").replace(rtrimRight,""),global.JSON&&JSON.parse?JSON.parse(data):rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+data)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str},exports.decode=function(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri}},{}],29:[function(_dereq_,module,exports){(function(global){!function(root){function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343)throw Error("Lone surrogate U+"+codePoint.toString(16).toUpperCase()+" is not a scalar value")}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function readContinuationByte(){if(byteIndex>=byteCount)throw Error("Invalid byte index");var continuationByte=255&byteArray[byteIndex];if(byteIndex++,128==(192&continuationByte))return 63&continuationByte;throw Error("Invalid continuation byte")}var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var byteArray,byteCount,byteIndex,stringFromCharCode=String.fromCharCode,utf8={version:"2.0.0",encode:function(string){for(var codePoints=ucs2decode(string),length=codePoints.length,index=-1,byteString="";++index<length;)byteString+=function(codePoint){if(0==(4294967168&codePoint))return stringFromCharCode(codePoint);var symbol="";return 0==(4294965248&codePoint)?symbol=stringFromCharCode(codePoint>>6&31|192):0==(4294901760&codePoint)?(checkScalarValue(codePoint),symbol=stringFromCharCode(codePoint>>12&15|224),symbol+=createByte(codePoint,6)):0==(4292870144&codePoint)&&(symbol=stringFromCharCode(codePoint>>18&7|240),symbol+=createByte(codePoint,12),symbol+=createByte(codePoint,6)),symbol+=stringFromCharCode(63&codePoint|128)}(codePoints[index]);return byteString},decode:function(byteString){byteArray=ucs2decode(byteString),byteCount=byteArray.length,byteIndex=0;for(var tmp,codePoints=[];!1!==(tmp=function(){var byte1,byte3,byte4,codePoint;if(byteIndex>byteCount)throw Error("Invalid byte index");if(byteIndex==byteCount)return!1;if(byte1=255&byteArray[byteIndex],byteIndex++,0==(128&byte1))return byte1;if(192==(224&byte1)){var byte2;if((codePoint=(31&byte1)<<6|(byte2=readContinuationByte()))>=128)return codePoint;throw Error("Invalid continuation byte")}if(224==(240&byte1)){if(byte2=readContinuationByte(),byte3=readContinuationByte(),(codePoint=(15&byte1)<<12|byte2<<6|byte3)>=2048)return checkScalarValue(codePoint),codePoint;throw Error("Invalid continuation byte")}if(240==(248&byte1)&&(byte2=readContinuationByte(),byte3=readContinuationByte(),byte4=readContinuationByte(),(codePoint=(15&byte1)<<18|byte2<<12|byte3<<6|byte4)>=65536&&codePoint<=1114111))return codePoint;throw Error("Invalid UTF-8 detected")}());)codePoints.push(tmp);return function(array){for(var value,length=array.length,index=-1,output="";++index<length;)(value=array[index])>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value);return output}(codePoints)}};if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=utf8;else{var hasOwnProperty={}.hasOwnProperty;for(var key in utf8)hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}else root.utf8=utf8}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],30:[function(_dereq_,module,exports){"use strict";function encode(num){var encoded="";do{encoded=alphabet[num%length]+encoded,num=Math.floor(num/length)}while(num>0);return encoded}function yeast(){var now=encode(+new Date);return now!==prev?(seed=0,prev=now):now+"."+encode(seed++)}for(var prev,alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=function(str){var decoded=0;for(i=0;i<str.length;i++)decoded=decoded*length+map[str.charAt(i)];return decoded},module.exports=yeast},{}],31:[function(_dereq_,module,exports){function lookup(uri,opts){"object"==typeof uri&&(opts=uri,uri=void 0),opts=opts||{};var io,parsed=url(uri),source=parsed.source,id=parsed.id,path=parsed.path,sameNamespace=cache[id]&&path in cache[id].nsps;return opts.forceNew||opts["force new connection"]||!1===opts.multiplex||sameNamespace?(debug("ignoring socket cache for %s",source),io=Manager(source,opts)):(cache[id]||(debug("new io instance for %s",source),cache[id]=Manager(source,opts)),io=cache[id]),io.socket(parsed.path)}var url=_dereq_("./url"),parser=_dereq_("socket.io-parser"),Manager=_dereq_("./manager"),debug=_dereq_("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};exports.protocol=parser.protocol,exports.connect=lookup,exports.Manager=_dereq_("./manager"),exports.Socket=_dereq_("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(_dereq_,module,exports){function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);uri&&"object"==typeof uri&&(opts=uri,uri=void 0),(opts=opts||{}).path=opts.path||"/socket.io",this.nsps={},this.subs=[],this.opts=opts,this.reconnection(!1!==opts.reconnection),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.randomizationFactor(opts.randomizationFactor||.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==opts.timeout?2e4:opts.timeout),this.readyState="closed",this.uri=uri,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new parser.Encoder,this.decoder=new parser.Decoder,this.autoConnect=!1!==opts.autoConnect,this.autoConnect&&this.open()}var eio=_dereq_("engine.io-client"),Socket=_dereq_("./socket"),Emitter=_dereq_("component-emitter"),parser=_dereq_("socket.io-parser"),on=_dereq_("./on"),bind=_dereq_("component-bind"),debug=_dereq_("debug")("socket.io-client:manager"),indexOf=_dereq_("indexof"),Backoff=_dereq_("backo2"),has=Object.prototype.hasOwnProperty;module.exports=Manager,Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps)has.call(this.nsps,nsp)&&this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)},Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps)has.call(this.nsps,nsp)&&(this.nsps[nsp].id=this.engine.id)},Emitter(Manager.prototype),Manager.prototype.reconnection=function(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection},Manager.prototype.reconnectionAttempts=function(v){return arguments.length?(this._reconnectionAttempts=v,this):this._reconnectionAttempts},Manager.prototype.reconnectionDelay=function(v){return arguments.length?(this._reconnectionDelay=v,this.backoff&&this.backoff.setMin(v),this):this._reconnectionDelay},Manager.prototype.randomizationFactor=function(v){return arguments.length?(this._randomizationFactor=v,this.backoff&&this.backoff.setJitter(v),this):this._randomizationFactor},Manager.prototype.reconnectionDelayMax=function(v){return arguments.length?(this._reconnectionDelayMax=v,this.backoff&&this.backoff.setMax(v),this):this._reconnectionDelayMax},Manager.prototype.timeout=function(v){return arguments.length?(this._timeout=v,this):this._timeout},Manager.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Manager.prototype.open=Manager.prototype.connect=function(fn){if(debug("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri),this.engine=eio(this.uri,this.opts);var socket=this.engine,self=this;this.readyState="opening",this.skipReconnect=!1;var openSub=on(socket,"open",function(){self.onopen(),fn&&fn()}),errorSub=on(socket,"error",function(data){if(debug("connect_error"),self.cleanup(),self.readyState="closed",self.emitAll("connect_error",data),fn){var err=new Error("Connection error");err.data=data,fn(err)}else self.maybeReconnectOnOpen()});if(!1!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout),openSub.destroy(),socket.close(),socket.emit("error","timeout"),self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}return this.subs.push(openSub),this.subs.push(errorSub),this},Manager.prototype.onopen=function(){debug("open"),this.cleanup(),this.readyState="open",this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata"))),this.subs.push(on(socket,"ping",bind(this,"onping"))),this.subs.push(on(socket,"pong",bind(this,"onpong"))),this.subs.push(on(socket,"error",bind(this,"onerror"))),this.subs.push(on(socket,"close",bind(this,"onclose"))),this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")))},Manager.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Manager.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Manager.prototype.ondata=function(data){this.decoder.add(data)},Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)},Manager.prototype.onerror=function(err){debug("error",err),this.emitAll("error",err)},Manager.prototype.socket=function(nsp){function onConnecting(){~indexOf(self.connecting,socket)||self.connecting.push(socket)}var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp),this.nsps[nsp]=socket;var self=this;socket.on("connecting",onConnecting),socket.on("connect",function(){socket.id=self.engine.id}),this.autoConnect&&onConnecting()}return socket},Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);~index&&this.connecting.splice(index,1),this.connecting.length||this.close()},Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;self.encoding?self.packetBuffer.push(packet):(self.encoding=!0,this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++)self.engine.write(encodedPackets[i],packet.options);self.encoding=!1,self.processPacketQueue()}))},Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}},Manager.prototype.cleanup=function(){debug("cleanup");for(var sub;sub=this.subs.shift();)sub.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Manager.prototype.close=Manager.prototype.disconnect=function(){debug("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Manager.prototype.onclose=function(reason){debug("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",reason),this._reconnection&&!this.skipReconnect&&this.reconnect()},Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts)debug("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay),this.reconnecting=!0;var timer=setTimeout(function(){self.skipReconnect||(debug("attempting reconnect"),self.emitAll("reconnect_attempt",self.backoff.attempts),self.emitAll("reconnecting",self.backoff.attempts),self.skipReconnect||self.open(function(err){err?(debug("reconnect attempt error"),self.reconnecting=!1,self.reconnect(),self.emitAll("reconnect_error",err.data)):(debug("reconnect success"),self.onreconnect())}))},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}},Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",attempt)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(_dereq_,module,exports){module.exports=function(obj,ev,fn){return obj.on(ev,fn),{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){function Socket(io,nsp){this.io=io,this.nsp=nsp,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var parser=_dereq_("socket.io-parser"),Emitter=_dereq_("component-emitter"),toArray=_dereq_("to-array"),on=_dereq_("./on"),bind=_dereq_("component-bind"),debug=_dereq_("debug")("socket.io-client:socket"),hasBin=_dereq_("has-binary");module.exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},emit=Emitter.prototype.emit;Emitter(Socket.prototype),Socket.prototype.subEvents=function(){if(!this.subs){var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]}},Socket.prototype.open=Socket.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},Socket.prototype.send=function(){var args=toArray(arguments);return args.unshift("message"),this.emit.apply(this,args),this},Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev))return emit.apply(this,arguments),this;var args=toArray(arguments),parserType=parser.EVENT;hasBin(args)&&(parserType=parser.BINARY_EVENT);var packet={type:parserType,data:args};return packet.options={},packet.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof args[args.length-1]&&(debug("emitting packet with ack id %d",this.ids),this.acks[this.ids]=args.pop(),packet.id=this.ids++),this.connected?this.packet(packet):this.sendBuffer.push(packet),delete this.flags,this},Socket.prototype.packet=function(packet){packet.nsp=this.nsp,this.io.packet(packet)},Socket.prototype.onopen=function(){debug("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:parser.CONNECT})},Socket.prototype.onclose=function(reason){debug("close (%s)",reason),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",reason)},Socket.prototype.onpacket=function(packet){if(packet.nsp==this.nsp)switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data)}},Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args),null!=packet.id&&(debug("attaching ack callback to event"),args.push(this.ack(packet.id))),this.connected?emit.apply(this,args):this.receiveBuffer.push(args)},Socket.prototype.ack=function(id){var self=this,sent=!1;return function(){if(!sent){sent=!0;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}}},Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];"function"==typeof ack?(debug("calling ack %s with %j",packet.id,packet.data),ack.apply(this,packet.data),delete this.acks[packet.id]):debug("bad ack %s",packet.id)},Socket.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++)emit.apply(this,this.receiveBuffer[i]);for(this.receiveBuffer=[],i=0;i<this.sendBuffer.length;i++)this.packet(this.sendBuffer[i]);this.sendBuffer=[]},Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++)this.subs[i].destroy();this.subs=null}this.io.destroy(this)},Socket.prototype.close=Socket.prototype.disconnect=function(){return this.connected&&(debug("performing disconnect (%s)",this.nsp),this.packet({type:parser.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},Socket.prototype.compress=function(compress){return this.flags=this.flags||{},this.flags.compress=compress,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_("parseuri"),debug=_dereq_("debug")("socket.io-client:url");module.exports=function(uri,loc){var obj=uri,loc=loc||global.location;null==uri&&(uri=loc.protocol+"//"+loc.host),"string"==typeof uri&&("/"==uri.charAt(0)&&(uri="/"==uri.charAt(1)?loc.protocol+uri:loc.host+uri),/^(https?|wss?):\/\//.test(uri)||(debug("protocol-less url %s",uri),uri=void 0!==loc?loc.protocol+"//"+uri:"https://"+uri),debug("parse %s",uri),obj=parseuri(uri)),obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443")),obj.path=obj.path||"/";var host=-1!==obj.host.indexOf(":")?"["+obj.host+"]":obj.host;return obj.id=obj.protocol+"://"+host+":"+obj.port,obj.href=obj.protocol+"://"+host+(loc&&loc.port==obj.port?"":":"+obj.port),obj}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){function Backoff(opts){opts=opts||{},this.ms=opts.min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0,this.attempts=0}module.exports=Backoff,Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms);ms=0==(1&Math.floor(10*rand))?ms-deviation:ms+deviation}return 0|Math.min(ms,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn&&(fn=obj[fn]),"function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){function Emitter(obj){if(obj)return function(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}(obj)}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var cb,i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks)for(var i=0,len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args);return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{"./debug":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=function(data){function _hasBinary(obj){if(!obj)return!1;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File)return!0;if(isArray(obj)){for(var i=0;i<obj.length;i++)if(_hasBinary(obj[i]))return!0}else if(obj&&"object"==typeof obj){obj.toJSON&&"function"==typeof obj.toJSON&&(obj=obj.toJSON());for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key]))return!0}return!1}return _hasBinary(data)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray"),isBuf=_dereq_("./is-buffer");exports.deconstructPacket=function(packet){function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(isArray(data)){for(var newData=new Array(data.length),i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i]);return newData}if("object"==typeof data&&!(data instanceof Date)){newData={};for(var key in data)newData[key]=_deconstructPacket(data[key]);return newData}return data}var buffers=[],packetData=packet.data,pack=packet;return pack.data=_deconstructPacket(packetData),pack.attachments=buffers.length,{packet:pack,buffers:buffers}},exports.reconstructPacket=function(packet,buffers){function _reconstructPacket(data){if(data&&data._placeholder){return buffers[data.num]}if(isArray(data)){for(var i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i]);return data}if(data&&"object"==typeof data){for(var key in data)data[key]=_reconstructPacket(data[key]);return data}return data}return packet.data=_reconstructPacket(packet.data),packet.attachments=void 0,packet},exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){containingObject?containingObject[curKey]=this.result:bloblessData=this.result,--pendingBlobs||callback(bloblessData)},fileReader.readAsArrayBuffer(obj)}else if(isArray(obj))for(var i=0;i<obj.length;i++)_removeBlobs(obj[i],i,obj);else if(obj&&"object"==typeof obj&&!isBuf(obj))for(var key in obj)_removeBlobs(obj[key],key,obj)}var pendingBlobs=0,bloblessData=data;_removeBlobs(bloblessData),pendingBlobs||callback(bloblessData)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":48,isarray:43}],47:[function(_dereq_,module,exports){function Encoder(){}function encodeAsString(obj){var str="",nsp=!1;return str+=obj.type,exports.BINARY_EVENT!=obj.type&&exports.BINARY_ACK!=obj.type||(str+=obj.attachments,str+="-"),obj.nsp&&"/"!=obj.nsp&&(nsp=!0,str+=obj.nsp),null!=obj.id&&(nsp&&(str+=",",nsp=!1),str+=obj.id),null!=obj.data&&(nsp&&(str+=","),str+=json.stringify(obj.data)),debug("encoded %j as %s",obj,str),str}function Decoder(){this.reconstructor=null}function BinaryReconstructor(packet){this.reconPack=packet,this.buffers=[]}function error(data){return{type:exports.ERROR,data:"parser error"}}var debug=_dereq_("debug")("socket.io-parser"),json=_dereq_("json3"),Emitter=(_dereq_("isarray"),_dereq_("component-emitter")),binary=_dereq_("./binary"),isBuf=_dereq_("./is-buffer");exports.protocol=4,exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],exports.CONNECT=0,exports.DISCONNECT=1,exports.EVENT=2,exports.ACK=3,exports.ERROR=4,exports.BINARY_EVENT=5,exports.BINARY_ACK=6,exports.Encoder=Encoder,exports.Decoder=Decoder,Encoder.prototype.encode=function(obj,callback){if(debug("encoding packet %j",obj),exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type)!function(obj,callback){binary.removeBlobs(obj,function(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData),pack=encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;buffers.unshift(pack),callback(buffers)})}(obj,callback);else{callback([encodeAsString(obj)])}},Emitter(Decoder.prototype),Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj)packet=function(str){var p={},i=0;if(p.type=Number(str.charAt(0)),null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){for(var buf="";"-"!=str.charAt(++i)&&(buf+=str.charAt(i),i!=str.length););if(buf!=Number(buf)||"-"!=str.charAt(i))throw new Error("Illegal attachments");p.attachments=Number(buf)}if("/"==str.charAt(i+1))for(p.nsp="";++i&&","!=(c=str.charAt(i))&&(p.nsp+=c,i!=str.length););else p.nsp="/";var next=str.charAt(i+1);if(""!==next&&Number(next)==next){for(p.id="";++i;){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(p.id+=str.charAt(i),i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i))try{p.data=json.parse(str.substr(i))}catch(e){return error()}return debug("decoded %s as %j",str,p),p}(obj),exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type?(this.reconstructor=new BinaryReconstructor(packet),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",packet)):this.emit("decoded",packet);else{if(!isBuf(obj)&&!obj.base64)throw new Error("Unknown type: "+obj);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(packet=this.reconstructor.takeBinaryData(obj))&&(this.reconstructor=null,this.emit("decoded",packet))}},Decoder.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},BinaryReconstructor.prototype.takeBinaryData=function(binData){if(this.buffers.push(binData),this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}return null},BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=function(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){function runInContext(context,exports){function has(name){if(has[name]!==undef)return has[name];var isSupported;if("bug-string-char-index"==name)isSupported="a"!="a"[0];else if("json"==name)isSupported=has("json-stringify")&&has("json-parse");else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==name){var stringify=exports.stringify,stringifySupported="function"==typeof stringify&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported="0"===stringify(0)&&"0"===stringify(new Number)&&'""'==stringify(new String)&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&"1"===stringify(value)&&"[1]"==stringify([value])&&"[null]"==stringify([undef])&&"null"==stringify(null)&&"[null,null,null]"==stringify([undef,getClass,null])&&stringify({a:[value,!0,!1,null,"\0\b\n\f\r\t"]})==serialized&&"1"===stringify(null,value)&&"[\n 1,\n 2\n]"==stringify([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==stringify(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==stringify(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==stringify(new Date(-1))}catch(exception){stringifySupported=!1}}isSupported=stringifySupported}if("json-parse"==name){var parse=exports.parse;if("function"==typeof parse)try{if(0===parse("0")&&!parse(!1)){var parseSupported=5==(value=parse(serialized)).a.length&&1===value.a[0];if(parseSupported){try{parseSupported=!parse('"\t"')}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("01")}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("1.")}catch(exception){}}}}catch(exception){parseSupported=!1}isSupported=parseSupported}}return has[name]=!!isSupported}context||(context=root.Object()),exports||(exports=root.Object());var Number=context.Number||root.Number,String=context.String||root.String,Object=context.Object||root.Object,Date=context.Date||root.Date,SyntaxError=context.SyntaxError||root.SyntaxError,TypeError=context.TypeError||root.TypeError,Math=context.Math||root.Math,nativeJSON=context.JSON||root.JSON;"object"==typeof nativeJSON&&nativeJSON&&(exports.stringify=nativeJSON.stringify,exports.parse=nativeJSON.parse);var isProperty,forEach,undef,objectProto=Object.prototype,getClass=objectProto.toString,isExtended=new Date(-0xc782b5b800cec);try{isExtended=-109252==isExtended.getUTCFullYear()&&0===isExtended.getUTCMonth()&&1===isExtended.getUTCDate()&&10==isExtended.getUTCHours()&&37==isExtended.getUTCMinutes()&&6==isExtended.getUTCSeconds()&&708==isExtended.getUTCMilliseconds()}catch(exception){}if(!has("json")){var charIndexBuggy=has("bug-string-char-index");if(!isExtended)var floor=Math.floor,Months=[0,31,59,90,120,151,181,212,243,273,304,334],getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)};if((isProperty=objectProto.hasOwnProperty)||(isProperty=function(property){var constructor,members={};return(members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass?isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);return this.__proto__=original,result}:(constructor=members.constructor,isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}),members=null,isProperty.call(this,property)}),forEach=function(object,callback){var Properties,members,property,size=0;(Properties=function(){this.valueOf=0}).prototype.valueOf=0,members=new Properties;for(property in members)isProperty.call(members,property)&&size++;return Properties=members=null,size?forEach=2==size?function(object,callback){var property,members={},isFunction="[object Function]"==getClass.call(object);for(property in object)isFunction&&"prototype"==property||isProperty.call(members,property)||!(members[property]=1)||!isProperty.call(object,property)||callback(property)}:function(object,callback){var property,isConstructor,isFunction="[object Function]"==getClass.call(object);for(property in object)isFunction&&"prototype"==property||!isProperty.call(object,property)||(isConstructor="constructor"===property)||callback(property);(isConstructor||isProperty.call(object,property="constructor"))&&callback(property)}:(members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],forEach=function(object,callback){var property,length,isFunction="[object Function]"==getClass.call(object),hasProperty=!isFunction&&"function"!=typeof object.constructor&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object)isFunction&&"prototype"==property||!hasProperty.call(object,property)||callback(property);for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}),forEach(object,callback)},!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},toPaddedString=function(width,value){return("000000"+(value||0)).slice(-width)},quote=function(value){for(var result='"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10,symbols=useCharIndex&&(charIndexBuggy?value.split(""):value);index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+="\\u00"+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'"'},serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if("object"==typeof value&&value)if("[object Date]"!=(className=getClass.call(value))||isProperty.call(value,"toJSON"))"function"==typeof value.toJSON&&("[object Number]"!=className&&"[object String]"!=className&&"[object Array]"!=className||isProperty.call(value,"toJSON"))&&(value=value.toJSON(property));else if(value>-1/0&&value<1/0){if(getDay){for(date=floor(value/864e5),year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month),hours=floor((time=(value%864e5+864e5)%864e5)/36e5)%24,minutes=floor(time/6e4)%60,seconds=floor(time/1e3)%60,milliseconds=time%1e3}else year=value.getUTCFullYear(),month=value.getUTCMonth(),date=value.getUTCDate(),hours=value.getUTCHours(),minutes=value.getUTCMinutes(),seconds=value.getUTCSeconds(),milliseconds=value.getUTCMilliseconds();value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else value=null;if(callback&&(value=callback.call(object,property,value)),null===value)return"null";if("[object Boolean]"==(className=getClass.call(value)))return""+value;if("[object Number]"==className)return value>-1/0&&value<1/0?""+value:"null";if("[object String]"==className)return quote(""+value);if("object"==typeof value){for(length=stack.length;length--;)if(stack[length]===value)throw TypeError();if(stack.push(value),results=[],prefix=indentation,indentation+=whitespace,"[object Array]"==className){for(index=0,length=value.length;index<length;index++)element=serialize(index,value,callback,properties,whitespace,indentation,stack),results.push(element===undef?"null":element);result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);element!==undef&&results.push(quote(property)+":"+(whitespace?" ":"")+element)}),result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}";return stack.pop(),result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter)if("[object Function]"==(className=getClass.call(filter)))callback=filter;else if("[object Array]"==className){properties={};for(var value,index=0,length=filter.length;index<length;value=filter[index++],("[object String]"==(className=getClass.call(value))||"[object Number]"==className)&&(properties[value]=1));}if(width)if("[object Number]"==(className=getClass.call(width))){if((width-=width%1)>0)for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}else"[object String]"==className&&(whitespace=width.length<=10?width:width.slice(0,10));return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var Index,Source,fromCharCode=String.fromCharCode,Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},abort=function(){throw Index=Source=null,SyntaxError()},lex=function(){for(var value,begin,position,isSigned,charCode,source=Source,length=source.length;Index<length;)switch(charCode=source.charCodeAt(Index)){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:return value=charIndexBuggy?source.charAt(Index):source[Index],Index++,value;case 34:for(value="@",Index++;Index<length;)if((charCode=source.charCodeAt(Index))<32)abort();else if(92==charCode)switch(charCode=source.charCodeAt(++Index)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode],Index++;break;case 117:for(begin=++Index,position=Index+4;Index<position;Index++)(charCode=source.charCodeAt(Index))>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70||abort();value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}else{if(34==charCode)break;for(charCode=source.charCodeAt(Index),begin=Index;charCode>=32&&92!=charCode&&34!=charCode;)charCode=source.charCodeAt(++Index);value+=source.slice(begin,Index)}if(34==source.charCodeAt(Index))return Index++,value;abort();default:if(begin=Index,45==charCode&&(isSigned=!0,charCode=source.charCodeAt(++Index)),charCode>=48&&charCode<=57){for(48==charCode&&(charCode=source.charCodeAt(Index+1))>=48&&charCode<=57&&abort(),isSigned=!1;Index<length&&(charCode=source.charCodeAt(Index))>=48&&charCode<=57;Index++);if(46==source.charCodeAt(Index)){for(position=++Index;position<length&&(charCode=source.charCodeAt(position))>=48&&charCode<=57;position++);position==Index&&abort(),Index=position}if(101==(charCode=source.charCodeAt(Index))||69==charCode){for(43!=(charCode=source.charCodeAt(++Index))&&45!=charCode||Index++,position=Index;position<length&&(charCode=source.charCodeAt(position))>=48&&charCode<=57;position++);position==Index&&abort(),Index=position}return+source.slice(begin,Index)}if(isSigned&&abort(),"true"==source.slice(Index,Index+4))return Index+=4,!0;if("false"==source.slice(Index,Index+5))return Index+=5,!1;if("null"==source.slice(Index,Index+4))return Index+=4,null;abort()}return"$"},get=function(value){var results,hasMembers;if("$"==value&&abort(),"string"==typeof value){if("@"==(charIndexBuggy?value.charAt(0):value[0]))return value.slice(1);if("["==value){for(results=[];"]"!=(value=lex());hasMembers||(hasMembers=!0))hasMembers&&(","==value?"]"==(value=lex())&&abort():abort()),","==value&&abort(),results.push(get(value));return results}if("{"==value){for(results={};"}"!=(value=lex());hasMembers||(hasMembers=!0))hasMembers&&(","==value?"}"==(value=lex())&&abort():abort()),","!=value&&"string"==typeof value&&"@"==(charIndexBuggy?value.charAt(0):value[0])&&":"==lex()||abort(),results[value.slice(1)]=get(lex());return results}abort()}return value},update=function(source,property,callback){var element=walk(source,property,callback);element===undef?delete source[property]:source[property]=element},walk=function(source,property,callback){var length,value=source[property];if("object"==typeof value&&value)if("[object Array]"==getClass.call(value))for(length=value.length;length--;)update(value,length,callback);else forEach(value,function(property){update(value,property,callback)});return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;return Index=0,Source=""+source,result=get(lex()),"$"!=lex()&&abort(),Index=Source=null,callback&&"[object Function]"==getClass.call(callback)?walk((value={},value[""]=result,value),"",callback):result}}}return exports.runInContext=runInContext,exports}var objectTypes={function:!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal),freeExports)runInContext(root,freeExports);else{var nativeJSON=root.JSON,previousJSON=root.JSON3,isRestored=!1,JSON3=runInContext(root,root.JSON3={noConflict:function(){return isRestored||(isRestored=!0,root.JSON=nativeJSON,root.JSON3=previousJSON,nativeJSON=previousJSON=null),JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=function(list,index){for(var array=[],i=(index=index||0)||0;i<list.length;i++)array[i-index]=list[i];return array}},{}]},{},[31])(31)});